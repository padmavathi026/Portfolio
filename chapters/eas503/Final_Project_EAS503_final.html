
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>1.1. Cleanup Tasks: &#8212; My Jupyter Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/eas503/Final_Project_EAS503_final';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="1. EAS503" href="eas503.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">My Jupyter Book</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    PADMAVATHI MOORTHY
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="eas503.html">1. EAS503</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">1.1. Cleanup Tasks:</a></li>






</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/eas503/Final_Project_EAS503_final.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Cleanup Tasks:</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">1.1. Cleanup Tasks:</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#remove-duplicates">1.2. Remove Duplicates:</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#correct-data-types">1.3. Correct Data Types:</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#outlier-detection-and-handling">1.4. Outlier Detection and Handling:</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#categorical-variable-encoding">1.5. Categorical Variable Encoding:</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#normalization-scaling">1.6. Normalization/Scaling:</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#document-changes">1.7. Document Changes:</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;diabetes_012_health_indicators_BRFSS2021.csv&quot;</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;diabetes_012_health_indicators_BRFSS2021.csv&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">df</span>

<span class="nn">File /opt/anaconda3/lib/python3.12/site-packages/pandas/io/parsers/readers.py:1026,</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, date_format, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options, dtype_backend)</span>
<span class="g g-Whitespace">   </span><span class="mi">1013</span> <span class="n">kwds_defaults</span> <span class="o">=</span> <span class="n">_refine_defaults_read</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1014</span>     <span class="n">dialect</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1015</span>     <span class="n">delimiter</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1022</span>     <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1023</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1024</span> <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1026</span> <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

<span class="nn">File /opt/anaconda3/lib/python3.12/site-packages/pandas/io/parsers/readers.py:620,</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">617</span> <span class="n">_validate_names</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;names&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">619</span> <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">620</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">622</span> <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">623</span>     <span class="k">return</span> <span class="n">parser</span>

<span class="nn">File /opt/anaconda3/lib/python3.12/site-packages/pandas/io/parsers/readers.py:1620,</span> in <span class="ni">TextFileReader.__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">   </span><span class="mi">1617</span>     <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">1619</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span> <span class="n">IOHandles</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">-&gt; </span><span class="mi">1620</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>

<span class="nn">File /opt/anaconda3/lib/python3.12/site-packages/pandas/io/parsers/readers.py:1880,</span> in <span class="ni">TextFileReader._make_engine</span><span class="nt">(self, f, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1878</span>     <span class="k">if</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1879</span>         <span class="n">mode</span> <span class="o">+=</span> <span class="s2">&quot;b&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1880</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="o">=</span> <span class="n">get_handle</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1881</span>     <span class="n">f</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1882</span>     <span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1883</span>     <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1884</span>     <span class="n">compression</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1885</span>     <span class="n">memory_map</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_map&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1886</span>     <span class="n">is_text</span><span class="o">=</span><span class="n">is_text</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1887</span>     <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1888</span>     <span class="n">storage_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storage_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1889</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1890</span> <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">   </span><span class="mi">1891</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="o">.</span><span class="n">handle</span>

<span class="nn">File /opt/anaconda3/lib/python3.12/site-packages/pandas/io/common.py:873,</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">868</span> <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">869</span>     <span class="c1"># Check whether the filename is to be opened in binary mode.</span>
<span class="g g-Whitespace">    </span><span class="mi">870</span>     <span class="c1"># Binary mode does not support &#39;encoding&#39; and &#39;newline&#39;.</span>
<span class="g g-Whitespace">    </span><span class="mi">871</span>     <span class="k">if</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">and</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">872</span>         <span class="c1"># Encoding</span>
<span class="ne">--&gt; </span><span class="mi">873</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">874</span>             <span class="n">handle</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">875</span>             <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">876</span>             <span class="n">encoding</span><span class="o">=</span><span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">877</span>             <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">878</span>             <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">879</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">880</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">881</span>         <span class="c1"># Binary mode</span>
<span class="g g-Whitespace">    </span><span class="mi">882</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;diabetes_012_health_indicators_BRFSS2021.csv&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="c1"># Step 1: Load the original dataset</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;diabetes_012_health_indicators_BRFSS2021.csv&#39;</span><span class="p">)</span>

<span class="c1"># Step 2: Normalize into 3NF</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite:///diabetes_normalized_updated.db&#39;</span><span class="p">)</span>

<span class="c1"># Create &#39;demographics&#39; table</span>
<span class="n">demographics</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">,</span> <span class="s1">&#39;Education&#39;</span><span class="p">,</span> <span class="s1">&#39;Income&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">demographics</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">demographics</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Create &#39;health_indicators&#39; table</span>
<span class="n">health_indicators</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;BMI&#39;</span><span class="p">,</span> <span class="s1">&#39;PhysActivity&#39;</span><span class="p">,</span> <span class="s1">&#39;Smoker&#39;</span><span class="p">,</span> <span class="s1">&#39;MentHlth&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;HighBP&#39;</span><span class="p">,</span> <span class="s1">&#39;HighChol&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">health_indicators</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">demographics</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>

<span class="c1"># Create &#39;other_features&#39; table (remaining features if any)</span>
<span class="n">other_features</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">,</span> <span class="s1">&#39;Education&#39;</span><span class="p">,</span> <span class="s1">&#39;Income&#39;</span><span class="p">,</span> 
                                  <span class="s1">&#39;BMI&#39;</span><span class="p">,</span> <span class="s1">&#39;PhysActivity&#39;</span><span class="p">,</span> <span class="s1">&#39;Smoker&#39;</span><span class="p">,</span> <span class="s1">&#39;MentHlth&#39;</span><span class="p">,</span> 
                                  <span class="s1">&#39;PhysHlth&#39;</span><span class="p">,</span> <span class="s1">&#39;HighBP&#39;</span><span class="p">,</span> <span class="s1">&#39;HighChol&#39;</span><span class="p">,</span> <span class="s1">&#39;Diabetes_012&#39;</span><span class="p">])</span>
<span class="n">other_features</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">demographics</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>

<span class="c1"># Create &#39;diabetes_status&#39; table</span>
<span class="n">diabetes_status</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Diabetes_012&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">diabetes_status</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">demographics</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>

<span class="c1"># Populate Normalized Tables</span>
<span class="n">demographics</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;demographics&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">health_indicators</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;health_indicators&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">other_features</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;other_features&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">diabetes_status</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;diabetes_status&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tables successfully created and populated.&quot;</span><span class="p">)</span>

<span class="c1"># Step 3: Retrieve Combined Data Back Using SQL JOIN</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT d.id, d.Age, d.Sex, d.Education, d.Income,</span>
<span class="s2">       h.BMI, h.PhysActivity, h.Smoker, h.MentHlth, h.PhysHlth, h.HighBP, h.HighChol,</span>
<span class="s2">       o.*, ds.Diabetes_012</span>
<span class="s2">FROM demographics d</span>
<span class="s2">JOIN health_indicators h ON d.id = h.id</span>
<span class="s2">JOIN other_features o ON d.id = o.id</span>
<span class="s2">JOIN diabetes_status ds ON d.id = ds.id</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Retrieve Combined DataFrame</span>
<span class="n">combined_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span>

<span class="c1"># Drop &#39;id&#39; to match the original DataFrame structure</span>
<span class="n">combined_df</span> <span class="o">=</span> <span class="n">combined_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>

<span class="c1"># Verify the result</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Combined DataFrame Shape:&quot;</span><span class="p">,</span> <span class="n">combined_df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">combined_df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="c1"># Step 4: Split into Features and Target for ML Pipeline</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">combined_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Diabetes_012&#39;</span><span class="p">])</span>  <span class="c1"># Features</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">combined_df</span><span class="p">[</span><span class="s1">&#39;Diabetes_012&#39;</span><span class="p">]</span>                <span class="c1"># Target</span>

<span class="c1"># Train-Test Split</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data Ready for Machine Learning Pipeline.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;X_train shape:&quot;</span><span class="p">,</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;y_train shape:&quot;</span><span class="p">,</span> <span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;X_test shape:&quot;</span><span class="p">,</span> <span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;y_test shape:&quot;</span><span class="p">,</span> <span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tables successfully created and populated.
Combined DataFrame Shape: (236378, 22)
   Age  Sex  Education  Income   BMI  PhysActivity  Smoker  MentHlth  \
0   11    0        4.0     5.0  15.0             0     1.0      10.0   
1   11    0        4.0     3.0  28.0             0     0.0       0.0   
2    9    0        4.0     7.0  33.0             1     0.0      10.0   
3   12    1        3.0     4.0  29.0             1     0.0       0.0   
4   13    1        5.0     6.0  24.0             0     1.0       0.0   

   PhysHlth  HighBP  ...  Stroke  HeartDiseaseorAttack  Fruits  Veggies  \
0      20.0       0  ...     0.0                   0.0       1        1   
1       0.0       1  ...     0.0                   1.0       1        0   
2       0.0       1  ...     0.0                   0.0       1        1   
3      30.0       0  ...     1.0                   1.0       1        1   
4       0.0       0  ...     0.0                   0.0       0        0   

   HvyAlcoholConsump  AnyHealthcare  NoDocbcCost  GenHlth  DiffWalk  \
0                  0              1          0.0      5.0       0.0   
1                  0              1          0.0      2.0       0.0   
2                  0              1          0.0      2.0       0.0   
3                  0              1          0.0      5.0       1.0   
4                  0              1          0.0      3.0       1.0   

   Diabetes_012  
0           0.0  
1           2.0  
2           2.0  
3           2.0  
4           0.0  

[5 rows x 22 columns]
Data Ready for Machine Learning Pipeline.
X_train shape: (189102, 21) y_train shape: (189102,)
X_test shape: (47276, 21) y_test shape: (47276,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Diabetes_012            0
HighBP                  0
HighChol                0
CholCheck               0
BMI                     0
Smoker                  0
Stroke                  0
HeartDiseaseorAttack    0
PhysActivity            0
Fruits                  0
Veggies                 0
HvyAlcoholConsump       0
AnyHealthcare           0
NoDocbcCost             0
GenHlth                 0
MentHlth                0
PhysHlth                0
DiffWalk                0
Sex                     0
Age                     0
Education               0
Income                  0
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>ydata-profiling
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: ydata-profiling in /opt/anaconda3/lib/python3.12/site-packages (4.12.1)
Requirement already satisfied: scipy&lt;1.14,&gt;=1.4.1 in /opt/anaconda3/lib/python3.12/site-packages (from ydata-profiling) (1.13.1)
Requirement already satisfied: pandas!=1.4.0,&lt;3,&gt;1.1 in /opt/anaconda3/lib/python3.12/site-packages (from ydata-profiling) (2.2.2)
Requirement already satisfied: matplotlib&lt;3.10,&gt;=3.5 in /opt/anaconda3/lib/python3.12/site-packages (from ydata-profiling) (3.8.4)
Requirement already satisfied: pydantic&gt;=2 in /opt/anaconda3/lib/python3.12/site-packages (from ydata-profiling) (2.5.3)
Requirement already satisfied: PyYAML&lt;6.1,&gt;=5.0.0 in /opt/anaconda3/lib/python3.12/site-packages (from ydata-profiling) (6.0.1)
Requirement already satisfied: jinja2&lt;3.2,&gt;=2.11.1 in /opt/anaconda3/lib/python3.12/site-packages (from ydata-profiling) (3.1.4)
Requirement already satisfied: visions&lt;0.7.7,&gt;=0.7.5 in /opt/anaconda3/lib/python3.12/site-packages (from visions[type_image_path]&lt;0.7.7,&gt;=0.7.5-&gt;ydata-profiling) (0.7.6)
Requirement already satisfied: numpy&lt;2.2,&gt;=1.16.0 in /opt/anaconda3/lib/python3.12/site-packages (from ydata-profiling) (1.26.4)
Requirement already satisfied: htmlmin==0.1.12 in /opt/anaconda3/lib/python3.12/site-packages (from ydata-profiling) (0.1.12)
Requirement already satisfied: phik&lt;0.13,&gt;=0.11.1 in /opt/anaconda3/lib/python3.12/site-packages (from ydata-profiling) (0.12.4)
Requirement already satisfied: requests&lt;3,&gt;=2.24.0 in /opt/anaconda3/lib/python3.12/site-packages (from ydata-profiling) (2.32.2)
Requirement already satisfied: tqdm&lt;5,&gt;=4.48.2 in /opt/anaconda3/lib/python3.12/site-packages (from ydata-profiling) (4.66.4)
Requirement already satisfied: seaborn&lt;0.14,&gt;=0.10.1 in /opt/anaconda3/lib/python3.12/site-packages (from ydata-profiling) (0.13.2)
Requirement already satisfied: multimethod&lt;2,&gt;=1.4 in /opt/anaconda3/lib/python3.12/site-packages (from ydata-profiling) (1.12)
Requirement already satisfied: statsmodels&lt;1,&gt;=0.13.2 in /opt/anaconda3/lib/python3.12/site-packages (from ydata-profiling) (0.14.2)
Requirement already satisfied: typeguard&lt;5,&gt;=3 in /opt/anaconda3/lib/python3.12/site-packages (from ydata-profiling) (4.4.1)
Requirement already satisfied: imagehash==4.3.1 in /opt/anaconda3/lib/python3.12/site-packages (from ydata-profiling) (4.3.1)
Requirement already satisfied: wordcloud&gt;=1.9.3 in /opt/anaconda3/lib/python3.12/site-packages (from ydata-profiling) (1.9.4)
Requirement already satisfied: dacite&gt;=1.8 in /opt/anaconda3/lib/python3.12/site-packages (from ydata-profiling) (1.8.1)
Requirement already satisfied: numba&lt;1,&gt;=0.56.0 in /opt/anaconda3/lib/python3.12/site-packages (from ydata-profiling) (0.59.1)
Requirement already satisfied: PyWavelets in /opt/anaconda3/lib/python3.12/site-packages (from imagehash==4.3.1-&gt;ydata-profiling) (1.5.0)
Requirement already satisfied: pillow in /opt/anaconda3/lib/python3.12/site-packages (from imagehash==4.3.1-&gt;ydata-profiling) (10.3.0)
Requirement already satisfied: MarkupSafe&gt;=2.0 in /opt/anaconda3/lib/python3.12/site-packages (from jinja2&lt;3.2,&gt;=2.11.1-&gt;ydata-profiling) (2.1.3)
Requirement already satisfied: contourpy&gt;=1.0.1 in /opt/anaconda3/lib/python3.12/site-packages (from matplotlib&lt;3.10,&gt;=3.5-&gt;ydata-profiling) (1.2.0)
Requirement already satisfied: cycler&gt;=0.10 in /opt/anaconda3/lib/python3.12/site-packages (from matplotlib&lt;3.10,&gt;=3.5-&gt;ydata-profiling) (0.11.0)
Requirement already satisfied: fonttools&gt;=4.22.0 in /opt/anaconda3/lib/python3.12/site-packages (from matplotlib&lt;3.10,&gt;=3.5-&gt;ydata-profiling) (4.51.0)
Requirement already satisfied: kiwisolver&gt;=1.3.1 in /opt/anaconda3/lib/python3.12/site-packages (from matplotlib&lt;3.10,&gt;=3.5-&gt;ydata-profiling) (1.4.4)
Requirement already satisfied: packaging&gt;=20.0 in /opt/anaconda3/lib/python3.12/site-packages (from matplotlib&lt;3.10,&gt;=3.5-&gt;ydata-profiling) (23.2)
Requirement already satisfied: pyparsing&gt;=2.3.1 in /opt/anaconda3/lib/python3.12/site-packages (from matplotlib&lt;3.10,&gt;=3.5-&gt;ydata-profiling) (3.0.9)
Requirement already satisfied: python-dateutil&gt;=2.7 in /opt/anaconda3/lib/python3.12/site-packages (from matplotlib&lt;3.10,&gt;=3.5-&gt;ydata-profiling) (2.9.0.post0)
Requirement already satisfied: llvmlite&lt;0.43,&gt;=0.42.0dev0 in /opt/anaconda3/lib/python3.12/site-packages (from numba&lt;1,&gt;=0.56.0-&gt;ydata-profiling) (0.42.0)
Requirement already satisfied: pytz&gt;=2020.1 in /opt/anaconda3/lib/python3.12/site-packages (from pandas!=1.4.0,&lt;3,&gt;1.1-&gt;ydata-profiling) (2024.1)
Requirement already satisfied: tzdata&gt;=2022.7 in /opt/anaconda3/lib/python3.12/site-packages (from pandas!=1.4.0,&lt;3,&gt;1.1-&gt;ydata-profiling) (2023.3)
Requirement already satisfied: joblib&gt;=0.14.1 in /opt/anaconda3/lib/python3.12/site-packages (from phik&lt;0.13,&gt;=0.11.1-&gt;ydata-profiling) (1.4.2)
Requirement already satisfied: annotated-types&gt;=0.4.0 in /opt/anaconda3/lib/python3.12/site-packages (from pydantic&gt;=2-&gt;ydata-profiling) (0.6.0)
Requirement already satisfied: pydantic-core==2.14.6 in /opt/anaconda3/lib/python3.12/site-packages (from pydantic&gt;=2-&gt;ydata-profiling) (2.14.6)
Requirement already satisfied: typing-extensions&gt;=4.6.1 in /opt/anaconda3/lib/python3.12/site-packages (from pydantic&gt;=2-&gt;ydata-profiling) (4.11.0)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in /opt/anaconda3/lib/python3.12/site-packages (from requests&lt;3,&gt;=2.24.0-&gt;ydata-profiling) (2.0.4)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /opt/anaconda3/lib/python3.12/site-packages (from requests&lt;3,&gt;=2.24.0-&gt;ydata-profiling) (3.7)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /opt/anaconda3/lib/python3.12/site-packages (from requests&lt;3,&gt;=2.24.0-&gt;ydata-profiling) (2.2.2)
Requirement already satisfied: certifi&gt;=2017.4.17 in /opt/anaconda3/lib/python3.12/site-packages (from requests&lt;3,&gt;=2.24.0-&gt;ydata-profiling) (2024.7.4)
Requirement already satisfied: patsy&gt;=0.5.6 in /opt/anaconda3/lib/python3.12/site-packages (from statsmodels&lt;1,&gt;=0.13.2-&gt;ydata-profiling) (0.5.6)
Requirement already satisfied: attrs&gt;=19.3.0 in /opt/anaconda3/lib/python3.12/site-packages (from visions&lt;0.7.7,&gt;=0.7.5-&gt;visions[type_image_path]&lt;0.7.7,&gt;=0.7.5-&gt;ydata-profiling) (23.1.0)
Requirement already satisfied: networkx&gt;=2.4 in /opt/anaconda3/lib/python3.12/site-packages (from visions&lt;0.7.7,&gt;=0.7.5-&gt;visions[type_image_path]&lt;0.7.7,&gt;=0.7.5-&gt;ydata-profiling) (3.2.1)
Requirement already satisfied: six in /opt/anaconda3/lib/python3.12/site-packages (from patsy&gt;=0.5.6-&gt;statsmodels&lt;1,&gt;=0.13.2-&gt;ydata-profiling) (1.16.0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">ydata_profiling</span> <span class="kn">import</span> <span class="n">ProfileReport</span>
<span class="n">profile</span> <span class="o">=</span> <span class="n">ProfileReport</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot; Pandas Profiling Report&quot;</span><span class="p">)</span>
<span class="n">profile</span>
<span class="n">profile</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="s2">&quot;profiling_report.html&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Profiling report saved as &#39;profiling_report.html&#39;. Open it in your browser.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "6eaf0f317c824eaf8352ce8ab76e1d02", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "3fc5139b2bdf4ec7a2974072a34e9c1b", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "83e7ea1a48444094afdb53df6b95eec2", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "5851d515fdb4486f8853e475c330c5b7", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Profiling report saved as &#39;profiling_report.html&#39;. Open it in your browser.
</pre></div>
</div>
</div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="cleanup-tasks">
<h1><span class="section-number">1.1. </span>Cleanup Tasks:<a class="headerlink" href="#cleanup-tasks" title="Link to this heading">#</a></h1>
<p>#Handle Missing Values:</p>
<p>Identify columns with missing values. There are no missing values.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="remove-duplicates">
<h1><span class="section-number">1.2. </span>Remove Duplicates:<a class="headerlink" href="#remove-duplicates" title="Link to this heading">#</a></h1>
<p>Check for and remove duplicate rows. No duplicate columns</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="correct-data-types">
<h1><span class="section-number">1.3. </span>Correct Data Types:<a class="headerlink" href="#correct-data-types" title="Link to this heading">#</a></h1>
<p>Ensure each column has the correct data type (e.g., numerical, categorical, datetime). All data are numerical(float).</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="outlier-detection-and-handling">
<h1><span class="section-number">1.4. </span>Outlier Detection and Handling:<a class="headerlink" href="#outlier-detection-and-handling" title="Link to this heading">#</a></h1>
<p>Detect and analyze outliers to decide whether to keep, transform, or remove them.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="categorical-variable-encoding">
<h1><span class="section-number">1.5. </span>Categorical Variable Encoding:<a class="headerlink" href="#categorical-variable-encoding" title="Link to this heading">#</a></h1>
<p>Encode categorical variables appropriately for downstream processes (e.g., label encoding, one-hot encoding). The data is itself encoded.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="normalization-scaling">
<h1><span class="section-number">1.6. </span>Normalization/Scaling:<a class="headerlink" href="#normalization-scaling" title="Link to this heading">#</a></h1>
<p>Normalize or scale numerical features if necessary.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="document-changes">
<h1><span class="section-number">1.7. </span>Document Changes:<a class="headerlink" href="#document-changes" title="Link to this heading">#</a></h1>
<p>Track all transformations and modifications for reproducibility.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Define the IQR method for detecting outliers</span>
<span class="k">def</span> <span class="nf">detect_outliers_iqr</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
    <span class="n">outliers</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
        <span class="n">Q1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
        <span class="n">Q3</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
        <span class="n">IQR</span> <span class="o">=</span> <span class="n">Q3</span> <span class="o">-</span> <span class="n">Q1</span>
        <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">Q1</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">IQR</span>
        <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">Q3</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">IQR</span>
        <span class="n">outliers</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lower_bound</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">upper_bound</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">outliers</span>

<span class="c1"># Example usage</span>
<span class="n">numerical_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;BMI&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Income&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PhysHlth&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Age&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GenHlth&quot;</span><span class="p">]</span>  <span class="c1"># Replace with your numerical columns</span>
<span class="n">outliers</span> <span class="o">=</span> <span class="n">detect_outliers_iqr</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">numerical_cols</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Detected Outliers:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">rows</span> <span class="ow">in</span> <span class="n">outliers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span><span class="si">}</span><span class="s2"> outliers&quot;</span><span class="p">)</span>
<span class="c1"># outliers have to be transformed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Detected Outliers:
BMI: 6314 outliers
Income: 0 outliers
PhysHlth: 38580 outliers
Age: 0 outliers
GenHlth: 8792 outliers
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 236378 entries, 0 to 236377
Data columns (total 22 columns):
 #   Column                Non-Null Count   Dtype  
---  ------                --------------   -----  
 0   Diabetes_012          236378 non-null  float64
 1   HighBP                236378 non-null  int64  
 2   HighChol              236378 non-null  float64
 3   CholCheck             236378 non-null  int64  
 4   BMI                   236378 non-null  float64
 5   Smoker                236378 non-null  float64
 6   Stroke                236378 non-null  float64
 7   HeartDiseaseorAttack  236378 non-null  float64
 8   PhysActivity          236378 non-null  int64  
 9   Fruits                236378 non-null  int64  
 10  Veggies               236378 non-null  int64  
 11  HvyAlcoholConsump     236378 non-null  int64  
 12  AnyHealthcare         236378 non-null  int64  
 13  NoDocbcCost           236378 non-null  float64
 14  GenHlth               236378 non-null  float64
 15  MentHlth              236378 non-null  float64
 16  PhysHlth              236378 non-null  float64
 17  DiffWalk              236378 non-null  float64
 18  Sex                   236378 non-null  int64  
 19  Age                   236378 non-null  int64  
 20  Education             236378 non-null  float64
 21  Income                236378 non-null  float64
dtypes: float64(13), int64(9)
memory usage: 39.7 MB
</pre></div>
</div>
</div>
</div>
<p>This suggest that there is no missing values as number of rows matches with the Non-Null count</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Diabetes_012&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Diabetes_012
0.0    197191
2.0     33568
1.0      5619
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Diabetes_012</th>
      <th>HighBP</th>
      <th>HighChol</th>
      <th>CholCheck</th>
      <th>BMI</th>
      <th>Smoker</th>
      <th>Stroke</th>
      <th>HeartDiseaseorAttack</th>
      <th>PhysActivity</th>
      <th>Fruits</th>
      <th>...</th>
      <th>AnyHealthcare</th>
      <th>NoDocbcCost</th>
      <th>GenHlth</th>
      <th>MentHlth</th>
      <th>PhysHlth</th>
      <th>DiffWalk</th>
      <th>Sex</th>
      <th>Age</th>
      <th>Education</th>
      <th>Income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>236378.000000</td>
      <td>236378.000000</td>
      <td>236378.000000</td>
      <td>236378.000000</td>
      <td>236378.000000</td>
      <td>236378.000000</td>
      <td>236378.000000</td>
      <td>236378.000000</td>
      <td>236378.000000</td>
      <td>236378.000000</td>
      <td>...</td>
      <td>236378.000000</td>
      <td>236378.000000</td>
      <td>236378.000000</td>
      <td>236378.000000</td>
      <td>236378.000000</td>
      <td>236378.000000</td>
      <td>236378.000000</td>
      <td>236378.000000</td>
      <td>236378.000000</td>
      <td>236378.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.307791</td>
      <td>0.418558</td>
      <td>0.402059</td>
      <td>0.963347</td>
      <td>28.953579</td>
      <td>0.411997</td>
      <td>0.038900</td>
      <td>0.086548</td>
      <td>0.779231</td>
      <td>0.621259</td>
      <td>...</td>
      <td>0.962573</td>
      <td>0.063737</td>
      <td>2.480717</td>
      <td>3.937710</td>
      <td>3.751297</td>
      <td>0.153948</td>
      <td>0.477824</td>
      <td>7.863930</td>
      <td>5.139099</td>
      <td>6.927451</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.705037</td>
      <td>0.493324</td>
      <td>0.490315</td>
      <td>0.187909</td>
      <td>6.552055</td>
      <td>0.492196</td>
      <td>0.193356</td>
      <td>0.281172</td>
      <td>0.414766</td>
      <td>0.485074</td>
      <td>...</td>
      <td>0.189807</td>
      <td>0.244284</td>
      <td>1.029134</td>
      <td>7.886506</td>
      <td>8.245907</td>
      <td>0.360900</td>
      <td>0.499509</td>
      <td>3.236997</td>
      <td>0.946185</td>
      <td>2.375450</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>12.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>24.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>2.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>5.000000</td>
      <td>4.000000</td>
      <td>5.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>28.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>...</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>2.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>8.000000</td>
      <td>5.000000</td>
      <td>7.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>32.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>...</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>3.000000</td>
      <td>4.000000</td>
      <td>2.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>10.000000</td>
      <td>6.000000</td>
      <td>9.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>99.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>...</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>5.000000</td>
      <td>30.000000</td>
      <td>30.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>13.000000</td>
      <td>6.000000</td>
      <td>11.000000</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 22 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">df</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">layout</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Feature Distributions&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 1500x1000 with 0 Axes&gt;
</pre></div>
</div>
<img alt="../../_images/cd017131d7ca09f89b9898d83d93e629b76e738facdec692961bd7832301d98d.png" src="../../_images/cd017131d7ca09f89b9898d83d93e629b76e738facdec692961bd7832301d98d.png" />
</div>
</div>
<p>OBSERVATION:
1.Uniform Distribution: All values appear with similar frequency. These features might not strongly influence the target variable.
2.Skewed Distribution: A feature’s values are concentrated toward one side. This could suggest:
3.Class imbalance in categorical variables.
4.its distribution can reveal:
1.Imbalance (e.g., most values are 0 ).
2.Its potential relationship to the target variable.
5.Age is right-skewed if the dataset primarily focuses on older individuals.
6.If 90% of the data has “0” for a feature (e.g., “Smoker”), the feature might have limited predictive power unless the remaining 10% correlates strongly with the target variable.
7.Physical Activity” is heavily concentrated at 1, this might indicate that the dataset primarily includes individuals with active lifestyles, which could be a strong predictor for diabetes.</p>
<p>Statistics Summary:
High Variance (Std):
A high standard deviation indicates a wide range of BMI values across individuals, suggesting that it could differentiate between classes (e.g., diabetic and non-diabetic).
Features with little variance are less likely to contribute meaningfully to the model.
Extreme Values (Max):
A high maximum BMI might signify outliers or unique patterns (e.g., extremely obese individuals might have a higher likelihood of diabetes).
These extreme cases can provide additional predictive value.
Mean Comparison:
If the mean BMI differs significantly across the target classes (Diabetes_012), it could indicate a correlation or influence of BMI on diabetes.</p>
<p>From this we could say “BMI” is more important feature. So split the data into training and testing, ensuring that both sets have same distribution of BMI.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="c1"># Step 2: Train/Test Split and Stratification</span>
<span class="n">important_feature</span> <span class="o">=</span> <span class="s1">&#39;BMI&#39;</span>  
<span class="n">median_value</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">important_feature</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>


<span class="c1"># Split data into two sets based on the important feature</span>
<span class="n">low_bmi_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">important_feature</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">median_value</span><span class="p">]</span>
<span class="n">high_bmi_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">important_feature</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">median_value</span><span class="p">]</span>

<span class="c1"># Ensure the important feature distributions are consistent</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Low BMI Median:&quot;</span><span class="p">,</span> <span class="n">low_bmi_data</span><span class="p">[</span><span class="n">important_feature</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;High BMI Median:&quot;</span><span class="p">,</span> <span class="n">high_bmi_data</span><span class="p">[</span><span class="n">important_feature</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">())</span>

<span class="c1"># Train/Test Split for each subset</span>
<span class="n">X_low</span> <span class="o">=</span> <span class="n">low_bmi_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Diabetes_012&#39;</span><span class="p">])</span>
<span class="n">y_low</span> <span class="o">=</span> <span class="n">low_bmi_data</span><span class="p">[</span><span class="s1">&#39;Diabetes_012&#39;</span><span class="p">]</span>
<span class="n">X_high</span> <span class="o">=</span> <span class="n">high_bmi_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Diabetes_012&#39;</span><span class="p">])</span>
<span class="n">y_high</span> <span class="o">=</span> <span class="n">high_bmi_data</span><span class="p">[</span><span class="s1">&#39;Diabetes_012&#39;</span><span class="p">]</span>

<span class="n">X_train_low</span> <span class="o">=</span> <span class="n">X_low</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;body_mass_index&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">X_train_high</span> <span class="o">=</span> <span class="n">X_high</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;body_mass_index&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">X_train_low</span><span class="p">,</span> <span class="n">X_test_low</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">,</span> <span class="n">y_test_low</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_low</span><span class="p">,</span> <span class="n">y_low</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y_low</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">X_train_high</span><span class="p">,</span> <span class="n">X_test_high</span><span class="p">,</span> <span class="n">y_train_high</span><span class="p">,</span> <span class="n">y_test_high</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_high</span><span class="p">,</span> <span class="n">y_high</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y_high</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>


<span class="c1"># After splitting the dataset</span>
<span class="n">X_train_low</span> <span class="o">=</span> <span class="n">X_train_low</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="n">col</span><span class="p">:</span> <span class="s1">&#39;float64&#39;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X_train_low</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">})</span>
<span class="n">X_test_low</span> <span class="o">=</span> <span class="n">X_test_low</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="n">col</span><span class="p">:</span> <span class="s1">&#39;float64&#39;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X_test_low</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">})</span>

<span class="n">X_train_high</span> <span class="o">=</span> <span class="n">X_train_high</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="n">col</span><span class="p">:</span> <span class="s1">&#39;float64&#39;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X_train_high</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">})</span>
<span class="n">X_test_high</span> <span class="o">=</span> <span class="n">X_test_high</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="n">col</span><span class="p">:</span> <span class="s1">&#39;float64&#39;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X_test_high</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">})</span>

<span class="n">X_test_low</span> <span class="o">=</span> <span class="n">X_test_low</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;diabetes_012&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">X_test_high</span> <span class="o">=</span> <span class="n">X_test_high</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;diabetes_012&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Low BMI Median: 25.0
High BMI Median: 33.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 3: Value Counts and Proportions</span>
<span class="n">low_train_counts</span> <span class="o">=</span> <span class="n">y_train_low</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_train_low</span><span class="p">)</span>
<span class="n">low_test_counts</span> <span class="o">=</span> <span class="n">y_test_low</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test_low</span><span class="p">)</span>
<span class="n">high_train_counts</span> <span class="o">=</span> <span class="n">y_train_high</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_train_high</span><span class="p">)</span>
<span class="n">high_test_counts</span> <span class="o">=</span> <span class="n">y_test_high</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test_high</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Low BMI Train Set Proportions:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">low_train_counts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Low BMI Test Set Proportions:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">low_test_counts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;High BMI Train Set Proportions:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">high_train_counts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;High BMI Test Set Proportions:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">high_test_counts</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Low BMI Train Set Proportions:
 Diabetes_012
0.0    0.895347
2.0    0.088120
1.0    0.016533
Name: count, dtype: float64
Low BMI Test Set Proportions:
 Diabetes_012
0.0    0.895339
2.0    0.088148
1.0    0.016513
Name: count, dtype: float64
High BMI Train Set Proportions:
 Diabetes_012
0.0    0.759658
2.0    0.207743
1.0    0.032599
Name: count, dtype: float64
High BMI Test Set Proportions:
 Diabetes_012
0.0    0.759638
2.0    0.207729
1.0    0.032634
Name: count, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> 
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="c1"># Step 4: Data Exploration</span>
<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Correlation Matrix&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/5a52615d5a35ba54b308b97658619c2e2bb6e2048f5ba497efcf4f68f6dd4ecb.png" src="../../_images/5a52615d5a35ba54b308b97658619c2e2bb6e2048f5ba497efcf4f68f6dd4ecb.png" />
</div>
</div>
<p>Key Observations:</p>
<p>BMI: Likely shows a moderate to strong positive correlation with Diabetes_012, supporting its selection as an important feature.
HighBP (High Blood Pressure): Often positively correlated with diabetes due to shared physiological risk factors.
HighChol (High Cholesterol): May show moderate correlation as high cholesterol is a common comorbidity of diabetes.
PhysActivity (Physical Activity): Could exhibit a weak negative correlation, as higher activity levels are protective against diabetes.
GenHlth (General Health): Expected to have a moderate positive correlation, as poorer health increases diabetes risk.</p>
<p>Interpreting Non-Target Relationships:
Features such as HighBP and HighChol might be strongly correlated with each other, indicating multicollinearity. This is useful for feature selection and modeling decisions.
PhysHlth (Physical Health Days) and MentHlth (Mental Health Days) may also have correlations, indicating shared behavioral or health-related patterns.</p>
<p>HighBP and GenHlth:</p>
<p>Expected Correlation: Positive</p>
<p>Reason: High blood pressure (HighBP) often indicates poor general health (GenHlth). Individuals with elevated blood pressure are more likely to report poorer health conditions.</p>
<p>HighBP and Age:</p>
<p>Expected Correlation: Positive</p>
<p>Reason: Blood pressure naturally increases with age due to changes in blood vessel elasticity and lifestyle factors.</p>
<p>HighChol and Age:</p>
<p>Expected Correlation: Positive</p>
<p>Reason: Cholesterol levels often rise with age, influenced by metabolism, diet, and reduced physical activity.</p>
<p>BMI and GenHlth:</p>
<p>Expected Correlation: Negative (inversely correlated)</p>
<p>Reason: Higher BMI is often associated with poor general health, including obesity-related conditions like diabetes and cardiovascular diseases.</p>
<p>HeartDisorder and GenHlth:</p>
<p>Expected Correlation: Positive</p>
<p>Reason: Heart disease significantly impacts an individual’s overall health and would likely correlate with poorer general health ratings.</p>
<p>HeartDisorder and Age:</p>
<p>Expected Correlation: Positive</p>
<p>Reason: The risk of heart diseases increases with age due to cumulative wear and tear on the cardiovascular system.</p>
<p>PhysHealth and Education:</p>
<p>Expected Correlation: Negative</p>
<p>Reason: Higher education levels are often associated with better awareness of health practices and access to healthcare, leading to fewer physical health issues.</p>
<p>PhysHealth and Income:</p>
<p>Expected Correlation: Negative</p>
<p>Reason: Higher income levels generally provide better access to healthcare, healthy food, and fitness opportunities, reducing physical health complaints.</p>
<p>Fruits and Veggies:</p>
<p>Expected Correlation: Positive</p>
<p>Reason: Consuming fruits and vegetables is indicative of a healthy diet, and these two features are likely to be positively correlated.</p>
<p>GenHlth and PhysHlth:</p>
<p>Expected Correlation: Positive</p>
<p>Reason: Poor general health often coincides with more days of poor physical health, as both capture overlapping health indicators.</p>
<p>GenHlth and DiffWalk:</p>
<p>Expected Correlation: Positive</p>
<p>Reason: Difficulty walking is a sign of declining health and is often linked to poor general health conditions.</p>
<p>Education and Income:</p>
<p>Expected Correlation: Positive</p>
<p>Reason: Higher education is strongly associated with higher income levels due to better job opportunities and earning potential.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">FunctionTransformer</span>
<span class="k">def</span> <span class="nf">correlation</span><span class="p">():</span>
    <span class="n">correlation_threshold</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">correlated_features</span> <span class="o">=</span> <span class="n">correlation_matrix</span><span class="p">[</span><span class="s2">&quot;Diabetes_012&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">correlation_threshold</span>
    <span class="n">selected_features_corr</span> <span class="o">=</span> <span class="n">correlation_matrix</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">correlated_features</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Selected Features after Correlation&quot;</span><span class="p">,</span><span class="n">selected_features_corr</span><span class="p">)</span>
<span class="n">correlation</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Selected Features after Correlation [&#39;Diabetes_012&#39;, &#39;HighBP&#39;, &#39;HighChol&#39;, &#39;BMI&#39;, &#39;Stroke&#39;, &#39;HeartDiseaseorAttack&#39;, &#39;PhysActivity&#39;, &#39;GenHlth&#39;, &#39;PhysHlth&#39;, &#39;DiffWalk&#39;, &#39;Age&#39;, &#39;Education&#39;, &#39;Income&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">VarianceThreshold</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span><span class="p">,</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">RidgeClassifier</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>

<span class="c1"># --- 1. Feature Selection Workflow ---</span>
<span class="k">def</span> <span class="nf">preprocess_features</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply VarianceThreshold and MinMaxScaler to features.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Applying VarianceThreshold...&quot;</span><span class="p">)</span>
    <span class="n">var_thresh</span> <span class="o">=</span> <span class="n">VarianceThreshold</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
    <span class="n">X_var</span> <span class="o">=</span> <span class="n">var_thresh</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shape after VarianceThreshold: </span><span class="si">{</span><span class="n">X_var</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scaling features with MinMaxScaler...&quot;</span><span class="p">)</span>
    <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
    <span class="n">X_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_var</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shape after Scaling: </span><span class="si">{</span><span class="n">X_scaled</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Feature_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X_scaled</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">feature_names</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">select_features_with_rf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Select important features using RandomForestRegressor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Training RandomForestRegressor for Feature Importance...&quot;</span><span class="p">)</span>
    <span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># Compute feature importances</span>
    <span class="n">importances</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">feature_importances_</span>
    <span class="n">important_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">imp</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">importances</span><span class="p">)</span> <span class="k">if</span> <span class="n">imp</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selected Features (importance &gt; </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">important_features</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">[</span><span class="n">important_features</span><span class="p">]</span> <span class="k">if</span> <span class="n">important_features</span> <span class="k">else</span> <span class="n">X</span>

<span class="k">def</span> <span class="nf">feature_selection_pipeline</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Full pipeline: VarianceThreshold -&gt; Scaling -&gt; Feature Importance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X_preprocessed</span> <span class="o">=</span> <span class="n">preprocess_features</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">X_selected</span> <span class="o">=</span> <span class="n">select_features_with_rf</span><span class="p">(</span><span class="n">X_preprocessed</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final Shape After Feature Selection: </span><span class="si">{</span><span class="n">X_selected</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X_selected</span>

<span class="c1"># --- 2. MLflow Setup ---</span>
<span class="n">MLFLOW_TRACKING_URI</span> <span class="o">=</span> <span class="s2">&quot;https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mpadmavathi026&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;9b42720fee5e34c7387ebe0714d3496686fb1d8a&quot;</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="n">MLFLOW_TRACKING_URI</span><span class="p">)</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;bmi_diabetes_prediction&quot;</span><span class="p">)</span>

<span class="c1"># --- 3. Train and Log Models ---</span>
<span class="k">def</span> <span class="nf">train_and_log_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">group_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Train the model using GridSearchCV, evaluate metrics, and log everything to MLflow.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Training </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2"> BMI...&quot;</span><span class="p">)</span>
    <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1_weighted&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

    <span class="c1"># Best Model and Metrics</span>
    <span class="n">best_model</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

    <span class="c1"># Extract confusion matrix components</span>
    <span class="k">if</span> <span class="n">cm</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>  <span class="c1"># Binary classification</span>
        <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Multiclass case (sum as needed)</span>
        <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>  <span class="c1"># Placeholders for multiclass confusion matrix</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1 Score: </span><span class="si">{</span><span class="n">f1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># MLflow Logging</span>
    <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;FS Tuned </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">_BMI&quot;</span><span class="p">):</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1 Score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Positives&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Negatives&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Positives&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Negatives&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>

        <span class="c1"># Log Model</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">best_model</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">_model&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> logged successfully for </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2"> BMI!&quot;</span><span class="p">)</span>

<span class="c1"># --- 4. Main Workflow ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Processing Low BMI Dataset ===&quot;</span><span class="p">)</span>
<span class="n">X_low_selected</span> <span class="o">=</span> <span class="n">feature_selection_pipeline</span><span class="p">(</span><span class="n">X_low</span><span class="p">,</span> <span class="n">y_low</span><span class="p">)</span>
<span class="n">X_train_low</span><span class="p">,</span> <span class="n">X_test_low</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">,</span> <span class="n">y_test_low</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_low_selected</span><span class="p">,</span> <span class="n">y_low</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Processing High BMI Dataset ===&quot;</span><span class="p">)</span>
<span class="n">X_high_selected</span> <span class="o">=</span> <span class="n">feature_selection_pipeline</span><span class="p">(</span><span class="n">X_high</span><span class="p">,</span> <span class="n">y_high</span><span class="p">)</span>
<span class="n">X_train_high</span><span class="p">,</span> <span class="n">X_test_high</span><span class="p">,</span> <span class="n">y_train_high</span><span class="p">,</span> <span class="n">y_test_high</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_high_selected</span><span class="p">,</span> <span class="n">y_high</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Define Models and Parameter Grids</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;logistic&quot;</span><span class="p">:</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;ridge&quot;</span><span class="p">:</span> <span class="n">RidgeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;rf&quot;</span><span class="p">:</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;xgb&quot;</span><span class="p">:</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;mlogloss&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">param_grids</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;logistic&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]},</span>
    <span class="s2">&quot;ridge&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]},</span>
    <span class="s2">&quot;rf&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">None</span><span class="p">]},</span>
    <span class="s2">&quot;xgb&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]}</span>
<span class="p">}</span>

<span class="c1"># Train and Log Models for Low and High BMI</span>
<span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">train_and_log_model</span><span class="p">(</span>
        <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
        <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grids</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span>
        <span class="n">X_train</span><span class="o">=</span><span class="n">X_train_low</span><span class="p">,</span>
        <span class="n">y_train</span><span class="o">=</span><span class="n">y_train_low</span><span class="p">,</span>
        <span class="n">X_test</span><span class="o">=</span><span class="n">X_test_low</span><span class="p">,</span>
        <span class="n">y_test</span><span class="o">=</span><span class="n">y_test_low</span><span class="p">,</span>
        <span class="n">group_name</span><span class="o">=</span><span class="s2">&quot;Low&quot;</span>
    <span class="p">)</span>
    <span class="n">train_and_log_model</span><span class="p">(</span>
        <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
        <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grids</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span>
        <span class="n">X_train</span><span class="o">=</span><span class="n">X_train_high</span><span class="p">,</span>
        <span class="n">y_train</span><span class="o">=</span><span class="n">y_train_high</span><span class="p">,</span>
        <span class="n">X_test</span><span class="o">=</span><span class="n">X_test_high</span><span class="p">,</span>
        <span class="n">y_test</span><span class="o">=</span><span class="n">y_test_high</span><span class="p">,</span>
        <span class="n">group_name</span><span class="o">=</span><span class="s2">&quot;High&quot;</span>
    <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Feature Selection and Model Training Complete. Results logged to MLflow.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Processing Low BMI Dataset ===

Applying VarianceThreshold...
Shape after VarianceThreshold: (129894, 21)
Scaling features with MinMaxScaler...
Shape after Scaling: (129894, 21)

Training RandomForestRegressor for Feature Importance...
Selected Features (importance &gt; 0.01): [&#39;Feature_0&#39;, &#39;Feature_1&#39;, &#39;Feature_2&#39;, &#39;Feature_3&#39;, &#39;Feature_4&#39;, &#39;Feature_6&#39;, &#39;Feature_7&#39;, &#39;Feature_8&#39;, &#39;Feature_9&#39;, &#39;Feature_10&#39;, &#39;Feature_12&#39;, &#39;Feature_13&#39;, &#39;Feature_14&#39;, &#39;Feature_15&#39;, &#39;Feature_16&#39;, &#39;Feature_17&#39;, &#39;Feature_18&#39;, &#39;Feature_19&#39;, &#39;Feature_20&#39;]
Final Shape After Feature Selection: (129894, 19)

=== Processing High BMI Dataset ===

Applying VarianceThreshold...
Shape after VarianceThreshold: (106484, 21)
Scaling features with MinMaxScaler...
Shape after Scaling: (106484, 21)

Training RandomForestRegressor for Feature Importance...
Selected Features (importance &gt; 0.01): [&#39;Feature_0&#39;, &#39;Feature_1&#39;, &#39;Feature_3&#39;, &#39;Feature_4&#39;, &#39;Feature_5&#39;, &#39;Feature_6&#39;, &#39;Feature_7&#39;, &#39;Feature_8&#39;, &#39;Feature_9&#39;, &#39;Feature_10&#39;, &#39;Feature_12&#39;, &#39;Feature_13&#39;, &#39;Feature_14&#39;, &#39;Feature_15&#39;, &#39;Feature_16&#39;, &#39;Feature_17&#39;, &#39;Feature_18&#39;, &#39;Feature_19&#39;, &#39;Feature_20&#39;]
Final Shape After Feature Selection: (106484, 19)

Training logistic for Low BMI...
Fitting 3 folds for each of 4 candidates, totalling 12 fits
F1 Score: 0.5145
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 01:13:31 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>logistic logged successfully for Low BMI!
🏃 View run FS Tuned logistic_Low_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/03377b3002454ef0baaf9e625ba76cb3
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training logistic for High BMI...
Fitting 3 folds for each of 4 candidates, totalling 12 fits
F1 Score: 0.5062
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 01:13:41 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>logistic logged successfully for High BMI!
🏃 View run FS Tuned logistic_High_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/499d6b803516464fa2a3cc7658d340ee
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training ridge for Low BMI...
Fitting 3 folds for each of 3 candidates, totalling 9 fits
F1 Score: 0.5145
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 01:13:57 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ridge logged successfully for Low BMI!
🏃 View run FS Tuned ridge_Low_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/558a7af96fdd433581fa1514d353dfe9
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training ridge for High BMI...
Fitting 3 folds for each of 3 candidates, totalling 9 fits
F1 Score: 0.5061
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 01:14:13 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ridge logged successfully for High BMI!
🏃 View run FS Tuned ridge_High_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/4c57a4c4b60844059e42c576c112cdf2
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training rf for Low BMI...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
F1 Score: 0.5127
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 01:14:58 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rf logged successfully for Low BMI!
🏃 View run FS Tuned rf_Low_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/05896f19e08a4e6a82541a538f740bab
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training rf for High BMI...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
F1 Score: 0.5104
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 01:15:43 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rf logged successfully for High BMI!
🏃 View run FS Tuned rf_High_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/3dd0679a9a074320bb01d2c0311e2c83
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training xgb for Low BMI...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
F1 Score: 0.5110
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 01:15:58 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>xgb logged successfully for Low BMI!
🏃 View run FS Tuned xgb_Low_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/d776132973db4f98bd8bfc27f36313cf
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training xgb for High BMI...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
F1 Score: 0.5084
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 01:16:10 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>xgb logged successfully for High BMI!
🏃 View run FS Tuned xgb_High_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/6bd60a844b1a4747b0be972bdaac54ed
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Feature Selection and Model Training Complete. Results logged to MLflow.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MLFLOW_TRACKING_URI</span> <span class="o">=</span> <span class="s2">&quot;https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mpadmavathi026&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;9b42720fee5e34c7387ebe0714d3496686fb1d8a&quot;</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="n">MLFLOW_TRACKING_URI</span><span class="p">)</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;bmi_diabetes_prediction&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;Feature Selection for Low and High BMI&quot;</span><span class="p">):</span>

    <span class="c1"># Log selected features</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Selected Features Low BMI&quot;</span><span class="p">,</span> <span class="n">selected_features_low</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Selected Features High BMI&quot;</span><span class="p">,</span> <span class="n">selected_features_high</span><span class="p">)</span>

    <span class="c1"># Save DataFrames to CSV</span>
    <span class="n">x_low_selected_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;x_low_selected.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">x_high_selected_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;x_high_selected.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Log CSV files as artifacts</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;x_low_selected.csv&quot;</span><span class="p">,</span> <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;data/low_bmi&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;x_high_selected.csv&quot;</span><span class="p">,</span> <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;data/high_bmi&quot;</span><span class="p">)</span>

    <span class="c1"># Log the pipelines</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">sk_model</span><span class="o">=</span><span class="n">pipeline_low</span><span class="p">,</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;pipeline_low&quot;</span><span class="p">,</span>
        <span class="n">registered_model_name</span><span class="o">=</span><span class="s2">&quot;pipeline_low&quot;</span>
    <span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">sk_model</span><span class="o">=</span><span class="n">pipeline_high</span><span class="p">,</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;pipeline_high&quot;</span><span class="p">,</span>
        <span class="n">registered_model_name</span><span class="o">=</span><span class="s2">&quot;pipeline_high&quot;</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Logged selected features and pipelines to MLflow.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/16 05:31:59 WARNING mlflow.sklearn: Model was missing function: predict. Not logging python_function flavor!
<span class=" -Color -Color-Red">2024/12/16 05:32:02 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
Successfully registered model &#39;pipeline_low&#39;.
2024/12/16 05:32:21 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: pipeline_low, version 1
Created version &#39;1&#39; of model &#39;pipeline_low&#39;.
2024/12/16 05:32:21 WARNING mlflow.sklearn: Model was missing function: predict. Not logging python_function flavor!
<span class=" -Color -Color-Red">2024/12/16 05:32:23 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
Successfully registered model &#39;pipeline_high&#39;.
2024/12/16 05:32:57 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: pipeline_high, version 1
Created version &#39;1&#39; of model &#39;pipeline_high&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Logged selected features and pipelines to MLflow.
🏃 View run Feature Selection for Low and High BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/fecd4640c0504d0886eb108650f81823
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example attribute combinations</span>
<span class="c1"># Step 7: Feature Engineering via Attribute Combinations</span>
        
<span class="k">class</span> <span class="nc">FeatureCreator</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;BMI&#39;</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;Age&#39;</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">X</span><span class="p">[</span><span class="s1">&#39;BMI_Age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s1">&#39;BMI&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;PhysHlth&#39;</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;MentHlth&#39;</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">X</span><span class="p">[</span><span class="s1">&#39;Phys_Ment_Health&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s1">&#39;PhysHlth&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s1">&#39;MentHlth&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;PhysActivity&#39;</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;DiffWalk&#39;</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">X</span><span class="p">[</span><span class="s1">&#39;Activity_DiffWalk&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s1">&#39;PhysActivity&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="s1">&#39;DiffWalk&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">X</span>
        <span class="c1"># Construct Correlation Matrix after Feature Engineering</span>
        <span class="n">correlation_matrix_engineered</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_matrix_engineered</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Correlation Matrix After Feature Engineering (Low BMI)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">transform</span><span class="p">(</span><span class="n">X_train_low</span><span class="p">,</span><span class="n">X_train_high</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>New Features in Low BMI Dataset:
 Index([&#39;HighBP&#39;, &#39;HighChol&#39;, &#39;CholCheck&#39;, &#39;BMI&#39;, &#39;Smoker&#39;, &#39;Stroke&#39;,
       &#39;HeartDiseaseorAttack&#39;, &#39;PhysActivity&#39;, &#39;Fruits&#39;, &#39;Veggies&#39;,
       &#39;HvyAlcoholConsump&#39;, &#39;AnyHealthcare&#39;, &#39;NoDocbcCost&#39;, &#39;GenHlth&#39;,
       &#39;MentHlth&#39;, &#39;PhysHlth&#39;, &#39;DiffWalk&#39;, &#39;Sex&#39;, &#39;Age&#39;, &#39;Education&#39;, &#39;Income&#39;,
       &#39;BMI_Age&#39;, &#39;Phys_Ment_Health&#39;, &#39;Activity_DiffWalk&#39;],
      dtype=&#39;object&#39;)
New Features in High BMI Dataset:
 Index([&#39;HighBP&#39;, &#39;HighChol&#39;, &#39;CholCheck&#39;, &#39;BMI&#39;, &#39;Smoker&#39;, &#39;Stroke&#39;,
       &#39;HeartDiseaseorAttack&#39;, &#39;PhysActivity&#39;, &#39;Fruits&#39;, &#39;Veggies&#39;,
       &#39;HvyAlcoholConsump&#39;, &#39;AnyHealthcare&#39;, &#39;NoDocbcCost&#39;, &#39;GenHlth&#39;,
       &#39;MentHlth&#39;, &#39;PhysHlth&#39;, &#39;DiffWalk&#39;, &#39;Sex&#39;, &#39;Age&#39;, &#39;Education&#39;, &#39;Income&#39;,
       &#39;BMI_Age&#39;, &#39;Phys_Ment_Health&#39;, &#39;Activity_DiffWalk&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b7bb85bb8ef04b6aba44ee237334b118", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "861aff99479d4ca3a54555f2e967aab9", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "c6ff297bbe264df6b7bf64b4db7fd159", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "a5f9c076d5b74f2fb937e01a188e50c8", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Profiling report saved as &#39;profiling_report.html&#39;. Open it in your browser.
</pre></div>
</div>
<img alt="../../_images/ebed7fa7696fc4378108df151a453920b5046545ff3c88bb5e7e6101a12dfe8b.png" src="../../_images/ebed7fa7696fc4378108df151a453920b5046545ff3c88bb5e7e6101a12dfe8b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Feature Scaling</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span><span class="p">,</span><span class="n">StandardScaler</span>
<span class="n">scaler_low</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
<span class="n">X_train_low_scaled</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaler_low</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train_low</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_train_low</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">X_test_low_scaled</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaler_low</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_low</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_test_low</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="n">scaler_high</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
<span class="n">X_train_high_scaled</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaler_high</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train_high</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_train_high</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">X_test_high_scaled</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaler_high</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_high</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_test_high</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="c1"># Step 6: Apply StandardScaler</span>
<span class="n">scaler_standard_low</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_train_low_scaled</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaler_standard_low</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train_low_scaled</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_train_low_scaled</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">X_test_low_scaled</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaler_standard_low</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_low_scaled</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_test_low_scaled</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="n">scaler_standard_high</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_train_high_scaled</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaler_standard_high</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train_high_scaled</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_train_high_scaled</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">X_test_high_scaled</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaler_standard_high</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_high_scaled</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_test_high_scaled</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 5: Apply FunctionTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">FunctionTransformer</span>

<span class="k">def</span> <span class="nf">add_bmi_age_ratio_log_transform</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-6</span>  <span class="c1"># Small constant to handle non-positive values</span>
    <span class="k">if</span> <span class="s1">&#39;bmi&#39;</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;age&#39;</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">X</span><span class="p">[</span><span class="s1">&#39;bmi_age_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s1">&#39;bmi&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Log transform numeric columns to handle skewness</span>
    <span class="n">numeric_cols</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;number&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
    <span class="n">X</span><span class="p">[</span><span class="n">numeric_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">numeric_cols</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="n">epsilon</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">X</span>

<span class="c1"># Define the FunctionTransformer</span>
<span class="n">transformer</span> <span class="o">=</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">add_bmi_age_ratio_log_transform</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Apply transformations to all scaled datasets</span>
<span class="n">X_train_low_scaled</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train_low_scaled</span><span class="p">)</span>
<span class="n">X_test_low_scaled</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_low_scaled</span><span class="p">)</span>
<span class="n">X_train_high_scaled</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train_high_scaled</span><span class="p">)</span>
<span class="n">X_test_high_scaled</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_high_scaled</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">rbf_kernel</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_blobs</span>
<span class="c1"># Step 1: Generate Sample Data using make_blobs</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">centers</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Visualize the Original Data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Original Data with make_blobs&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Feature 1&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Feature 2&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Step 2: Define the ClusterSimilarity Class</span>
<span class="k">class</span> <span class="nc">ClusterSimilarity</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_clusters</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_clusters</span> <span class="o">=</span> <span class="n">n_clusters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">random_state</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_clusters</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="s2">&quot;k-means++&quot;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kmeans</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">sample_weight</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rbf_kernel</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sample_weight</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Cluster </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> similarity&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_clusters</span><span class="p">)]</span>

<span class="c1"># Step 3: Instantiate ClusterSimilarity Transformer</span>
<span class="n">cluster_sim</span> <span class="o">=</span> <span class="n">ClusterSimilarity</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Step 4: Fit and Transform the Data</span>
<span class="n">similarity_matrix</span> <span class="o">=</span> <span class="n">cluster_sim</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Step 5: Print the Original Data and the Resulting Similarity Matrix</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Original Data:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>  <span class="c1"># Print the first 5 rows of the original data</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Resulting Similarity Matrix:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">similarity_matrix</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>  <span class="c1"># Print the first 5 rows of the similarity matrix</span>

<span class="c1"># Visualize the Similarity Matrix</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">similarity_matrix</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;hot&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Cluster Similarity Matrix&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Step 7: Visualize Cluster Similarity for Low BMI Data</span>
<span class="n">X_train_low_scaled</span><span class="p">[</span><span class="s1">&#39;Max cluster similarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_train_low</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Rename columns for visualization clarity</span>
<span class="n">X_train_low_scaled</span> <span class="o">=</span> <span class="n">X_train_low_scaled</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;bmi&#39;</span><span class="p">:</span> <span class="s1">&#39;BMI&#39;</span><span class="p">,</span>
    <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="s1">&#39;Age&#39;</span><span class="p">,</span>
    <span class="s1">&#39;highbp&#39;</span><span class="p">:</span> <span class="s1">&#39;High BP&#39;</span>
<span class="p">})</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_train_low_scaled</span><span class="p">[</span><span class="s1">&#39;BMI&#39;</span><span class="p">],</span> <span class="n">X_train_low_scaled</span><span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">],</span> 
            <span class="n">c</span><span class="o">=</span><span class="n">X_train_low_scaled</span><span class="p">[</span><span class="s1">&#39;Max cluster similarity&#39;</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Max Cluster Similarity&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cluster_sim</span><span class="o">.</span><span class="n">kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">cluster_sim</span><span class="o">.</span><span class="n">kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> 
            <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cluster Centers&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cluster Similarity&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;BMI&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Age&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Low BMI Data with Cluster Similarity&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/49adb3eb3b7dbc69e6cb1bc3f27ad65a89a5a941f0792b888ae39e61822feabe.png" src="../../_images/49adb3eb3b7dbc69e6cb1bc3f27ad65a89a5a941f0792b888ae39e61822feabe.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Original Data:
[[-7.33898809 -7.72995396]
 [-7.74004056 -7.26466514]
 [-1.68665271  7.79344248]
 [ 4.42219763  3.07194654]
 [-8.91775173 -7.8881959 ]]

Resulting Similarity Matrix:
[[1.24982024e-66 6.82630947e-01 4.76389931e-53]
 [3.84371561e-64 6.66374544e-01 2.87890379e-53]
 [2.92463339e-01 5.19596893e-54 5.62190861e-17]
 [2.79945912e-19 1.92472059e-50 5.40091784e-01]
 [1.48231810e-71 8.39836409e-02 1.49648619e-62]]
</pre></div>
</div>
<img alt="../../_images/5d36b20880eb754e99b3de50f1391e1ca4f218254fe19dd376766785af11999b.png" src="../../_images/5d36b20880eb754e99b3de50f1391e1ca4f218254fe19dd376766785af11999b.png" />
<img alt="../../_images/7315b855f716c1f410394f7adb8a392a871fe61d70d53e4d6ec2f2cb38d8ef28.png" src="../../_images/7315b855f716c1f410394f7adb8a392a871fe61d70d53e4d6ec2f2cb38d8ef28.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">similarity_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([3.84371561e-64, 6.66374544e-01, 2.87890379e-53])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span><span class="p">,</span> <span class="n">make_pipeline</span>
<span class="n">preprocessing_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;feature_creation&#39;</span><span class="p">,</span> <span class="n">FeatureCreator</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;log_transform&#39;</span><span class="p">,</span> <span class="n">transformer</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;cluster_similarity&#39;</span><span class="p">,</span> <span class="n">ClusterSimilarity</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Full pipeline including classifier</span>
<span class="n">pipeline_low</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessing_pipeline</span><span class="p">),</span>  <span class="c1"># Step 1: Preprocessing pipeline</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>  <span class="c1"># Step 2: Classifier</span>
<span class="p">])</span>

<span class="n">pipeline_high</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessing_pipeline</span><span class="p">),</span>  <span class="c1"># Step 1: Preprocessing pipeline</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>  <span class="c1"># Step 2: Classifier</span>
<span class="p">])</span>

<span class="c1"># Assuming X_train_low, X_train_high, y_train_low, y_train_high are already defined</span>
<span class="c1"># Fit the pipelines</span>
<span class="n">pipeline_low</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_low</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">)</span>
<span class="n">pipeline_high</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_high</span><span class="p">,</span> <span class="n">y_train_high</span><span class="p">)</span>

<span class="c1"># Preprocess the data using the pipelines</span>
<span class="n">X_train_low_preprocessed</span> <span class="o">=</span> <span class="n">pipeline_low</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train_low</span><span class="p">)</span>
<span class="n">X_train_high_preprocessed</span> <span class="o">=</span> <span class="n">pipeline_high</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train_high</span><span class="p">)</span>

<span class="c1"># Convert preprocessed data to DataFrame for inspection</span>
<span class="n">X_train_low_preprocessed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_train_low_preprocessed</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">pipeline_low</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;cluster_similarity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">())</span>
<span class="n">X_train_high_preprocessed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_train_high_preprocessed</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">pipeline_high</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;cluster_similarity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">())</span>

<span class="c1"># Print Results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Low BMI Dataset Preprocessed:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">X_train_low_preprocessed</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;High BMI Dataset Preprocessed:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">X_train_high_preprocessed</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Low BMI Dataset Preprocessed:
    Cluster_0_similarity  Cluster_1_similarity  Cluster_2_similarity  \
0              0.634453              0.209273              0.080371   
1              0.109682              0.156583              0.117738   
2              0.306072              0.269752              0.160224   
3              0.389703              0.165452              0.079101   
4              0.258752              0.078916              0.066671   

   Cluster_3_similarity  Cluster_4_similarity  
0              0.319013              0.096829  
1              0.185053              0.086177  
2              0.186565              0.136568  
3              0.546117              0.082732  
4              0.133097              0.281015  
High BMI Dataset Preprocessed:
    Cluster_0_similarity  Cluster_1_similarity  Cluster_2_similarity  \
0              0.340488              0.140530              0.202741   
1              0.517345              0.454005              0.124027   
2              0.202969              0.136598              0.143087   
3              0.334907              0.590174              0.163606   
4              0.219608              0.080113              0.034940   

   Cluster_3_similarity  Cluster_4_similarity  
0              0.220700              0.072816  
1              0.313435              0.145282  
2              0.389038              0.051744  
3              0.202485              0.164373  
4              0.154954              0.035641  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="c1"># Step 4: Define Pipelines and Parameter Grids</span>
<span class="n">pipelines</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;logistic&quot;</span><span class="p">:</span> <span class="n">Pipeline</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessing_pipeline</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
    <span class="p">]),</span>
    <span class="s2">&quot;ridge&quot;</span><span class="p">:</span> <span class="n">Pipeline</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessing_pipeline</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">RidgeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
    <span class="p">]),</span>
    <span class="s2">&quot;rf&quot;</span><span class="p">:</span> <span class="n">Pipeline</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessing_pipeline</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
    <span class="p">]),</span>
    <span class="s2">&quot;xgb&quot;</span><span class="p">:</span> <span class="n">Pipeline</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessing_pipeline</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;mlogloss&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
    <span class="p">])</span>
<span class="p">}</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="c1"># MLflow configuration</span>
<span class="n">MLFLOW_TRACKING_URI</span> <span class="o">=</span> <span class="s2">&quot;https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mpadmavathi026&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;9b42720fee5e34c7387ebe0714d3496686fb1d8a&quot;</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="n">MLFLOW_TRACKING_URI</span><span class="p">)</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;bmi_diabetes_prediction&quot;</span><span class="p">)</span>


<span class="c1"># Define models and hyperparameters</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>

<span class="n">param_grids</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;logistic&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;classifier__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="s1">&#39;classifier__solver&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="s1">&#39;lbfgs&#39;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;ridge&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;classifier__alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;rf&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;classifier__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="s1">&#39;classifier__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;xgb&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;classifier__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="s1">&#39;classifier__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">train_and_log_models</span><span class="p">(</span><span class="n">group_name</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training models for </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2"> BMI&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">pipeline</span> <span class="ow">in</span> <span class="n">pipelines</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        
        <span class="c1"># Perform GridSearchCV</span>
        <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grids</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1_weighted&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        
        <span class="c1"># Best Model</span>
        <span class="n">best_model</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
        <span class="n">best_params</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span>
        <span class="n">best_score</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span>
        
        <span class="c1"># Predictions and Metrics</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">if</span> <span class="n">cm</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
        <span class="c1"># Log to MLflow</span>
        <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;FE Tuned</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">_BMI&quot;</span><span class="p">):</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">best_params</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Best CV Score&quot;</span><span class="p">,</span> <span class="n">best_score</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1 Score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Positives&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Negatives&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Positives&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Negatives&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
            
            <span class="c1"># Log Model</span>
            <span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
                <span class="n">sk_model</span><span class="o">=</span><span class="n">best_model</span><span class="p">,</span>
                <span class="n">artifact_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">_bmi_model&quot;</span><span class="p">,</span>
                <span class="n">signature</span><span class="o">=</span><span class="n">signature</span><span class="p">,</span>
                <span class="n">input_example</span><span class="o">=</span><span class="n">X_test</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span>
                <span class="n">registered_model_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">_BMI_</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> logged successfully for </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2"> BMI.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Train and Log for Low and High BMI</span>
<span class="n">train_and_log_models</span><span class="p">(</span><span class="s2">&quot;Low&quot;</span><span class="p">,</span> <span class="n">X_train_low</span><span class="p">,</span> <span class="n">X_test_low</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">,</span> <span class="n">y_test_low</span><span class="p">)</span>
<span class="n">train_and_log_models</span><span class="p">(</span><span class="s2">&quot;High&quot;</span><span class="p">,</span> <span class="n">X_train_high</span><span class="p">,</span> <span class="n">X_test_high</span><span class="p">,</span> <span class="n">y_train_high</span><span class="p">,</span> <span class="n">y_test_high</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training models for Low BMI
Training logistic...
Fitting 3 folds for each of 8 candidates, totalling 24 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Registered model &#39;Low_BMI_logistic&#39; already exists. Creating a new version of this model...
2024/12/16 03:37:19 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: Low_BMI_logistic, version 6
Created version &#39;6&#39; of model &#39;Low_BMI_logistic&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run FE Tunedlogistic_Low_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/a666adc7e72c4639a39e2092abc4d6f7
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
Model logistic logged successfully for Low BMI.

Training ridge...
Fitting 3 folds for each of 3 candidates, totalling 9 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Registered model &#39;Low_BMI_ridge&#39; already exists. Creating a new version of this model...
2024/12/16 03:37:39 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: Low_BMI_ridge, version 6
Created version &#39;6&#39; of model &#39;Low_BMI_ridge&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run FE Tunedridge_Low_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/8adce46125b04889b92ba424f3949523
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
Model ridge logged successfully for Low BMI.

Training rf...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Registered model &#39;Low_BMI_rf&#39; already exists. Creating a new version of this model...
2024/12/16 03:42:00 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: Low_BMI_rf, version 6
Created version &#39;6&#39; of model &#39;Low_BMI_rf&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run FE Tunedrf_Low_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/1d8defc12dc6444f929daa284a3fc0f8
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
Model rf logged successfully for Low BMI.

Training xgb...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Registered model &#39;Low_BMI_xgb&#39; already exists. Creating a new version of this model...
2024/12/16 03:42:22 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: Low_BMI_xgb, version 6
Created version &#39;6&#39; of model &#39;Low_BMI_xgb&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run FE Tunedxgb_Low_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/15d2890d32c34da194724f3389214b4b
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
Model xgb logged successfully for Low BMI.

Training models for High BMI
Training logistic...
Fitting 3 folds for each of 8 candidates, totalling 24 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Registered model &#39;High_BMI_logistic&#39; already exists. Creating a new version of this model...
2024/12/16 03:42:44 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: High_BMI_logistic, version 6
Created version &#39;6&#39; of model &#39;High_BMI_logistic&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run FE Tunedlogistic_High_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/677b81ce7d6d42bdad15a12bd2def75e
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
Model logistic logged successfully for High BMI.

Training ridge...
Fitting 3 folds for each of 3 candidates, totalling 9 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Registered model &#39;High_BMI_ridge&#39; already exists. Creating a new version of this model...
2024/12/16 03:43:06 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: High_BMI_ridge, version 6
Created version &#39;6&#39; of model &#39;High_BMI_ridge&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run FE Tunedridge_High_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/003f2ac0f288490e831b15f316e1883a
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
Model ridge logged successfully for High BMI.

Training rf...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Registered model &#39;High_BMI_rf&#39; already exists. Creating a new version of this model...
2024/12/16 03:48:05 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: High_BMI_rf, version 6
Created version &#39;6&#39; of model &#39;High_BMI_rf&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run FE Tunedrf_High_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/263b2223923d4931a4db7aa4060ec80a
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
Model rf logged successfully for High BMI.

Training xgb...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Registered model &#39;High_BMI_xgb&#39; already exists. Creating a new version of this model...
2024/12/16 03:48:27 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: High_BMI_xgb, version 6
Created version &#39;6&#39; of model &#39;High_BMI_xgb&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run FE Tunedxgb_High_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/588e1803f86a462d972f265397d162eb
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
Model xgb logged successfully for High BMI.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">MLFLOW_TRACKING_URI</span> <span class="o">=</span> <span class="s2">&quot;https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mpadmavathi026&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;9b42720fee5e34c7387ebe0714d3496686fb1d8a&quot;</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="n">MLFLOW_TRACKING_URI</span><span class="p">)</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;bmi_diabetes_prediction&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;Pipeline with Feature Engineering&quot;</span><span class="p">):</span>
    <span class="c1"># Log parameters for feature engineering</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;n_clusters&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;gamma&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;random_state&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
    
    <span class="c1"># Log the preprocessing pipeline</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">preprocessing_pipeline</span><span class="p">,</span> <span class="s2">&quot;Preprocessing Pipeline&quot;</span><span class="p">)</span>
    
    <span class="c1"># Log datasets as artifacts</span>
    <span class="n">X_train_low_preprocessed</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;X_train_low_preprocessed.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">X_train_high_preprocessed</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;X_train_high_preprocessed.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;X_train_low_preprocessed.csv&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;X_train_high_preprocessed.csv&quot;</span><span class="p">)</span>
    
    <span class="c1"># Log the pipeline with classifier (low BMI)</span>
    <span class="n">pipeline_low</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessing_pipeline</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
    <span class="p">])</span>
    <span class="n">pipeline_low</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_low</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">pipeline_low</span><span class="p">,</span> <span class="s2">&quot;Pipeline Low BMI&quot;</span><span class="p">)</span>
    
    <span class="c1"># Log the pipeline with classifier (high BMI)</span>
    <span class="n">pipeline_high</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessing_pipeline</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
    <span class="p">])</span>
    <span class="n">pipeline_high</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_high</span><span class="p">,</span> <span class="n">y_train_high</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">pipeline_high</span><span class="p">,</span> <span class="s2">&quot;Pipeline High BMI&quot;</span><span class="p">)</span>
    
    <span class="c1"># Log metrics (example: number of features after preprocessing)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Low BMI Dataset Features&quot;</span><span class="p">,</span> <span class="n">X_train_low_preprocessed</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;High BMI Dataset Features&quot;</span><span class="p">,</span> <span class="n">X_train_high_preprocessed</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="n">input_example</span> <span class="o">=</span> <span class="n">X_train_low</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>  <span class="c1"># Use the first 5 rows as an example</span>

    <span class="c1"># Infer the signature of the model (input-output schema)</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">X_train_low</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>  <span class="c1"># Use matching X and y</span>

   
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
    <span class="n">sk_model</span><span class="o">=</span><span class="n">pipeline_low</span><span class="p">,</span>
    <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;Pipeline Low BMI&quot;</span><span class="p">,</span>
    <span class="n">input_example</span><span class="o">=</span><span class="n">input_example</span><span class="p">,</span>
    <span class="n">signature</span><span class="o">=</span><span class="n">signature</span><span class="p">,</span>
    <span class="n">registered_model_name</span><span class="o">=</span><span class="s2">&quot;Pipeline_Low_BMI&quot;</span>  <span class="c1"># Optional: Register the model in the MLflow Model Registry</span>
<span class="p">)</span>
    <span class="n">input_example_high</span> <span class="o">=</span> <span class="n">X_train_high</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>  <span class="c1"># Use the first 5 rows of X_train_high as an example</span>
    <span class="n">signature_high</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">X_train_high</span><span class="p">,</span> <span class="n">y_train_high</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span> 
    
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
    <span class="n">sk_model</span><span class="o">=</span><span class="n">pipeline_high</span><span class="p">,</span>
    <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;Pipeline High BMI&quot;</span><span class="p">,</span>
    <span class="n">input_example</span><span class="o">=</span><span class="n">input_example_high</span><span class="p">,</span>
    <span class="n">signature</span><span class="o">=</span><span class="n">signature_high</span><span class="p">,</span>
    <span class="n">registered_model_name</span><span class="o">=</span><span class="s2">&quot;Pipeline_High_BMI&quot;</span>  <span class="c1"># Optional: Register the model in the MLflow Model Registry</span>
<span class="p">)</span>
    
    <span class="c1"># Optional: Log a visualization (e.g., correlation matrix heatmap)</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
    
    <span class="n">correlation_matrix_low</span> <span class="o">=</span> <span class="n">X_train_low_preprocessed</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_matrix_low</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Correlation Matrix (Low BMI)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;correlation_matrix_low_bmi.png&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;correlation_matrix_low_bmi.png&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="n">correlation_matrix_high</span> <span class="o">=</span> <span class="n">X_train_high_preprocessed</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_matrix_high</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Correlation Matrix (High BMI)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;correlation_matrix_high_bmi.png&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;correlation_matrix_high_bmi.png&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># End the run</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pipeline and results successfully logged to MLflow!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/16 02:04:07 WARNING mlflow.sklearn: Model was missing function: predict. Not logging python_function flavor!
<span class=" -Color -Color-Red">2024/12/16 02:04:09 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
<span class=" -Color -Color-Red">2024/12/16 02:04:45 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
<span class=" -Color -Color-Red">2024/12/16 02:07:56 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
Successfully registered model &#39;Pipeline_Low_BMI&#39;.
2024/12/16 02:14:28 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: Pipeline_Low_BMI, version 1
Created version &#39;1&#39; of model &#39;Pipeline_Low_BMI&#39;.
Successfully registered model &#39;Pipeline_High_BMI&#39;.
2024/12/16 02:18:12 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: Pipeline_High_BMI, version 1
Created version &#39;1&#39; of model &#39;Pipeline_High_BMI&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Pipeline and results successfully logged to MLflow!
🏃 View run Pipeline with Feature Engineering at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/d3deb09106de40cea6dd4bc24ec23343
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">RidgeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>

<span class="c1"># --- 1. MLflow Setup ---</span>
<span class="n">MLFLOW_TRACKING_URI</span> <span class="o">=</span> <span class="s2">&quot;https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mpadmavathi026&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;9b42720fee5e34c7387ebe0714d3496686fb1d8a&quot;</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="n">MLFLOW_TRACKING_URI</span><span class="p">)</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;bmi_diabetes_prediction&quot;</span><span class="p">)</span>

<span class="c1"># --- 2. PCA Workflow ---</span>
<span class="k">def</span> <span class="nf">apply_pca</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Standardize features and apply PCA for dimensionality reduction.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Standardizing features...&quot;</span><span class="p">)</span>
    <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
    <span class="n">X_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Applying PCA...&quot;</span><span class="p">)</span>
    <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">)</span>
    <span class="n">X_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">)</span>

    <span class="c1"># Scree Plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Scree Plot&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Principal Components&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Explained Variance Ratio&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Explained Variance Ratio:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X_pca</span><span class="p">,</span> <span class="n">pca</span>

<span class="c1"># --- 3. Train and Log Models ---</span>
<span class="k">def</span> <span class="nf">train_and_log_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">pca</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Train the model using GridSearchCV, evaluate metrics, and log results in MLflow.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Training </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2"> BMI...&quot;</span><span class="p">)</span>
    <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1_weighted&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

    <span class="c1"># Best Model and Metrics</span>
    <span class="n">best_model</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

    <span class="c1"># Extract confusion matrix components</span>
    <span class="k">if</span> <span class="n">cm</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>  <span class="c1"># Binary classification</span>
        <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Multiclass case</span>
        <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>  <span class="c1"># Placeholder for multiclass case</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1 Score: </span><span class="si">{</span><span class="n">f1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># MLflow Logging</span>
    <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;PCA tuned </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">_BMI&quot;</span><span class="p">):</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;PCA Components&quot;</span><span class="p">,</span> <span class="n">pca</span><span class="o">.</span><span class="n">n_components_</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1 Score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Positives&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Negatives&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Positives&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Negatives&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>

        <span class="c1"># Log Model</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">best_model</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">_pca_model&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> logged successfully for </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2"> BMI!&quot;</span><span class="p">)</span>

<span class="c1"># --- 4. Main Workflow ---</span>
<span class="c1"># Simulated data placeholders: X_low, y_low, X_high, y_high</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Applying PCA for Low BMI Dataset ===&quot;</span><span class="p">)</span>
<span class="n">X_low_pca</span><span class="p">,</span> <span class="n">pca_low</span> <span class="o">=</span> <span class="n">apply_pca</span><span class="p">(</span><span class="n">X_low</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Adjust n_components as needed</span>
<span class="n">X_train_low</span><span class="p">,</span> <span class="n">X_test_low</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">,</span> <span class="n">y_test_low</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_low_pca</span><span class="p">,</span> <span class="n">y_low</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Applying PCA for High BMI Dataset ===&quot;</span><span class="p">)</span>
<span class="n">X_high_pca</span><span class="p">,</span> <span class="n">pca_high</span> <span class="o">=</span> <span class="n">apply_pca</span><span class="p">(</span><span class="n">X_high</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Adjust n_components as needed</span>
<span class="n">X_train_high</span><span class="p">,</span> <span class="n">X_test_high</span><span class="p">,</span> <span class="n">y_train_high</span><span class="p">,</span> <span class="n">y_test_high</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_high_pca</span><span class="p">,</span> <span class="n">y_high</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Define Models and Parameter Grids</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;logistic&quot;</span><span class="p">:</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;ridge&quot;</span><span class="p">:</span> <span class="n">RidgeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;rf&quot;</span><span class="p">:</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;xgb&quot;</span><span class="p">:</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;mlogloss&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">param_grids</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;logistic&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]},</span>
    <span class="s2">&quot;ridge&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]},</span>
    <span class="s2">&quot;rf&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">None</span><span class="p">]},</span>
    <span class="s2">&quot;xgb&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]}</span>
<span class="p">}</span>

<span class="c1"># Train and Log Models for Low and High BMI</span>
<span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">train_and_log_model</span><span class="p">(</span>
        <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
        <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grids</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span>
        <span class="n">X_train</span><span class="o">=</span><span class="n">X_train_low</span><span class="p">,</span>
        <span class="n">y_train</span><span class="o">=</span><span class="n">y_train_low</span><span class="p">,</span>
        <span class="n">X_test</span><span class="o">=</span><span class="n">X_test_low</span><span class="p">,</span>
        <span class="n">y_test</span><span class="o">=</span><span class="n">y_test_low</span><span class="p">,</span>
        <span class="n">group_name</span><span class="o">=</span><span class="s2">&quot;Low&quot;</span><span class="p">,</span>
        <span class="n">pca</span><span class="o">=</span><span class="n">pca_low</span>
    <span class="p">)</span>
    <span class="n">train_and_log_model</span><span class="p">(</span>
        <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
        <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grids</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span>
        <span class="n">X_train</span><span class="o">=</span><span class="n">X_train_high</span><span class="p">,</span>
        <span class="n">y_train</span><span class="o">=</span><span class="n">y_train_high</span><span class="p">,</span>
        <span class="n">X_test</span><span class="o">=</span><span class="n">X_test_high</span><span class="p">,</span>
        <span class="n">y_test</span><span class="o">=</span><span class="n">y_test_high</span><span class="p">,</span>
        <span class="n">group_name</span><span class="o">=</span><span class="s2">&quot;High&quot;</span><span class="p">,</span>
        <span class="n">pca</span><span class="o">=</span><span class="n">pca_high</span>
    <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">PCA and Model Training Complete. Results logged to MLflow.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Applying PCA for Low BMI Dataset ===

Standardizing features...
Applying PCA...
</pre></div>
</div>
<img alt="../../_images/24b0467c57ad4d0d9b8a4e53211bf9cb6f1cc27e986c46784ebed355541a753f.png" src="../../_images/24b0467c57ad4d0d9b8a4e53211bf9cb6f1cc27e986c46784ebed355541a753f.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Explained Variance Ratio:
 [0.15352448 0.09042747 0.065724   0.0560373  0.0552391  0.05229949
 0.04798951 0.04587507 0.04303686 0.0414889 ]

=== Applying PCA for High BMI Dataset ===

Standardizing features...
Applying PCA...
</pre></div>
</div>
<img alt="../../_images/3181e109e84d9c3fb9809a64f8b7b15a70c66004bcc12f0fc18202671e2aa2f4.png" src="../../_images/3181e109e84d9c3fb9809a64f8b7b15a70c66004bcc12f0fc18202671e2aa2f4.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Explained Variance Ratio:
 [0.15136745 0.09043389 0.06523808 0.05831097 0.05624468 0.05000908
 0.04741677 0.04529349 0.04454757 0.04250414]

Training logistic for Low BMI...
Fitting 3 folds for each of 4 candidates, totalling 12 fits
F1 Score: 0.5139
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 01:29:51 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>logistic logged successfully for Low BMI!
🏃 View run PCA tuned logistic_Low_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/f8e45b5319234ab79142d50e0b505c8b
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training logistic for High BMI...
Fitting 3 folds for each of 4 candidates, totalling 12 fits
F1 Score: 0.5025
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 01:30:03 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>logistic logged successfully for High BMI!
🏃 View run PCA tuned logistic_High_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/227f49beb32c4aeaaed7968f662ea87b
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training ridge for Low BMI...
Fitting 3 folds for each of 3 candidates, totalling 9 fits
F1 Score: 0.5142
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 01:30:20 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ridge logged successfully for Low BMI!
🏃 View run PCA tuned ridge_Low_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/5aa4346326bb4637ae305a19cc93df1e
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training ridge for High BMI...
Fitting 3 folds for each of 3 candidates, totalling 9 fits
F1 Score: 0.5027
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 01:30:37 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ridge logged successfully for High BMI!
🏃 View run PCA tuned ridge_High_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/c41cb43e021e483b99375d4e75d58ae2
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training rf for Low BMI...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
F1 Score: 0.5097
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 01:34:12 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rf logged successfully for Low BMI!
🏃 View run PCA tuned rf_Low_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/4f7d045785c54242ae9c1b7760dd9147
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training rf for High BMI...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
F1 Score: 0.5112
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 01:38:23 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rf logged successfully for High BMI!
🏃 View run PCA tuned rf_High_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/0e5fee0809bf4d81969fa376d448ce52
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training xgb for Low BMI...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
F1 Score: 0.5074
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 01:38:36 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>xgb logged successfully for Low BMI!
🏃 View run PCA tuned xgb_Low_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/30c905e51083475592949f469425d2dd
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training xgb for High BMI...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
F1 Score: 0.5020
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 01:38:53 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>xgb logged successfully for High BMI!
🏃 View run PCA tuned xgb_High_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/31e8e38501284144a4c90c74424275f4
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

PCA and Model Training Complete. Results logged to MLflow.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span><span class="p">,</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PolynomialFeatures</span><span class="p">,</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span><span class="p">,</span> <span class="n">make_column_selector</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">RidgeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>

<span class="c1"># --- MLflow Setup ---</span>
<span class="n">MLFLOW_TRACKING_URI</span> <span class="o">=</span> <span class="s2">&quot;https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mpadmavathi026&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;9b42720fee5e34c7387ebe0714d3496686fb1d8a&quot;</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="n">MLFLOW_TRACKING_URI</span><span class="p">)</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;bmi_diabetes_prediction&quot;</span><span class="p">)</span>
<span class="c1"># --- 1. Polynomial Preprocessing Pipeline ---</span>
<span class="k">def</span> <span class="nf">custom_experiment6_pipeline</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">ColumnTransformer</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;poly&#39;</span><span class="p">,</span> <span class="n">make_pipeline</span><span class="p">(</span>
            <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">include_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="n">StandardScaler</span><span class="p">()</span>
        <span class="p">),</span> <span class="p">[</span><span class="s1">&#39;BMI&#39;</span><span class="p">,</span> <span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="s1">&#39;PhysActivity&#39;</span><span class="p">]),</span>  <span class="c1"># Polynomial Transformation for selected features</span>
        <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">make_column_selector</span><span class="p">(</span><span class="n">dtype_include</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">))</span>  <span class="c1"># Scaling other numerical features</span>
    <span class="p">],</span> <span class="n">remainder</span><span class="o">=</span><span class="s1">&#39;passthrough&#39;</span><span class="p">)</span>

<span class="c1"># --- 2. Model Training and Logging ---</span>
<span class="k">def</span> <span class="nf">train_and_log_experiment</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">):</span>
    <span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;logistic&quot;</span><span class="p">:</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
        <span class="s2">&quot;ridge&quot;</span><span class="p">:</span> <span class="n">RidgeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
        <span class="s2">&quot;rf&quot;</span><span class="p">:</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
        <span class="s2">&quot;xgb&quot;</span><span class="p">:</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;mlogloss&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">param_grids</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;logistic&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]},</span>
        <span class="s2">&quot;ridge&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]},</span>
        <span class="s2">&quot;rf&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">None</span><span class="p">]},</span>
        <span class="s2">&quot;xgb&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]}</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Training </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">experiment_name</span><span class="si">}</span><span class="s2">)...&quot;</span><span class="p">)</span>
        <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">param_grids</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1_weighted&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

        <span class="c1"># Best model and evaluation</span>
        <span class="n">best_model</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

        <span class="c1"># Log metrics</span>
        <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">experiment_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1 Score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cm</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Positives&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
                <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Negatives&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
                <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Positives&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
                <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Negatives&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">best_model</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">_experiment6_model&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model logged successfully: </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># --- 3. Main Workflow ---</span>
<span class="c1"># Ensure DataFrames</span>
<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;BMI&quot;</span><span class="p">,</span> <span class="s2">&quot;Age&quot;</span><span class="p">,</span> <span class="s2">&quot;PhysActivity&quot;</span><span class="p">,</span> <span class="s2">&quot;MentHlth&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Feature_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X_train_low</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)]</span>
<span class="n">X_train_low</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_train_low</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="n">X_test_low</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_test_low</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="n">X_train_high</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_train_high</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="n">X_test_high</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_test_high</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

<span class="c1"># Process Low BMI Dataset</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Experiment #6: Processing Low BMI Dataset ===&quot;</span><span class="p">)</span>
<span class="n">preprocessing_pipeline6</span> <span class="o">=</span> <span class="n">custom_experiment6_pipeline</span><span class="p">()</span>
<span class="n">X_train_low_preprocessed</span> <span class="o">=</span> <span class="n">preprocessing_pipeline6</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train_low</span><span class="p">)</span>
<span class="n">X_test_low_preprocessed</span> <span class="o">=</span> <span class="n">preprocessing_pipeline6</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_low</span><span class="p">)</span>

<span class="c1"># Process High BMI Dataset</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Experiment #6: Processing High BMI Dataset ===&quot;</span><span class="p">)</span>
<span class="n">X_train_high_preprocessed</span> <span class="o">=</span> <span class="n">preprocessing_pipeline6</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train_high</span><span class="p">)</span>
<span class="n">X_test_high_preprocessed</span> <span class="o">=</span> <span class="n">preprocessing_pipeline6</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_high</span><span class="p">)</span>

<span class="c1"># Train and Log Models for Low and High BMI</span>
<span class="n">train_and_log_experiment</span><span class="p">(</span><span class="n">X_train_low_preprocessed</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">,</span> <span class="n">X_test_low_preprocessed</span><span class="p">,</span> <span class="n">y_test_low</span><span class="p">,</span> <span class="s2">&quot;Low BMI&quot;</span><span class="p">,</span> <span class="s2">&quot;experiment_6&quot;</span><span class="p">)</span>
<span class="n">train_and_log_experiment</span><span class="p">(</span><span class="n">X_train_high_preprocessed</span><span class="p">,</span> <span class="n">y_train_high</span><span class="p">,</span> <span class="n">X_test_high_preprocessed</span><span class="p">,</span> <span class="n">y_test_high</span><span class="p">,</span> <span class="s2">&quot;High BMI&quot;</span><span class="p">,</span> <span class="s2">&quot;experiment_6&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Experiment #6 Complete. Results logged to MLflow.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Experiment #6: Processing Low BMI Dataset ===

=== Experiment #6: Processing High BMI Dataset ===

Training logistic for Low BMI (experiment_6)...
Fitting 3 folds for each of 4 candidates, totalling 12 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 02:22:27 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model logged successfully: logistic for Low BMI
🏃 View run experiment_6_logistic_Low BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/69b1131176d0488fb119192a131575f9
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training ridge for Low BMI (experiment_6)...
Fitting 3 folds for each of 3 candidates, totalling 9 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 02:22:38 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model logged successfully: ridge for Low BMI
🏃 View run experiment_6_ridge_Low BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/ad67997e258844fe9fa5436986fa6c5b
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training rf for Low BMI (experiment_6)...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 02:27:19 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model logged successfully: rf for Low BMI
🏃 View run experiment_6_rf_Low BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/67fd25c1687d4a97aabf8a23ab784582
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training xgb for Low BMI (experiment_6)...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 02:27:29 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model logged successfully: xgb for Low BMI
🏃 View run experiment_6_xgb_Low BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/de43bc0d6bb44e27b7f3af7fbddb6d80
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training logistic for High BMI (experiment_6)...
Fitting 3 folds for each of 4 candidates, totalling 12 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 02:27:45 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model logged successfully: logistic for High BMI
🏃 View run experiment_6_logistic_High BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/0b6482f50e30445ca7e3b5b80f3b6ac1
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training ridge for High BMI (experiment_6)...
Fitting 3 folds for each of 3 candidates, totalling 9 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 02:28:01 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model logged successfully: ridge for High BMI
🏃 View run experiment_6_ridge_High BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/3e07ae0457f74f2084accc9a77d29cad
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training rf for High BMI (experiment_6)...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 02:32:09 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model logged successfully: rf for High BMI
🏃 View run experiment_6_rf_High BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/a5fc655957844a11b3e0d83824a422bd
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training xgb for High BMI (experiment_6)...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 02:32:20 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model logged successfully: xgb for High BMI
🏃 View run experiment_6_xgb_High BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/be28c258549546509a12c281809a1db4
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Experiment #6 Complete. Results logged to MLflow.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">mutual_info_classif</span><span class="p">,</span> <span class="n">SelectKBest</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">TruncatedSVD</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span><span class="p">,</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">PolynomialFeatures</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">RidgeClassifier</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>

<span class="c1"># --- 1. Mutual Information Feature Selection ---</span>
<span class="k">def</span> <span class="nf">mutual_info_selection</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Select top k features using mutual information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">selector</span> <span class="o">=</span> <span class="n">SelectKBest</span><span class="p">(</span><span class="n">score_func</span><span class="o">=</span><span class="n">mutual_info_classif</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    <span class="n">X_selected</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">selected_features</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selected Features based on Mutual Information: </span><span class="si">{</span><span class="n">selected_features</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_selected</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">selected_features</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="c1"># --- 2. Preprocessing Pipeline ---</span>
<span class="k">def</span> <span class="nf">preprocessing_pipeline</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">k_features</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_svd</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply preprocessing steps: feature interaction, mutual information, and dimensionality reduction.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generating Feature Interaction Terms...&quot;</span><span class="p">)</span>
    <span class="n">poly</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">interaction_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">X_interacted</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">feature_names</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">X_interacted_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_interacted</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shape after Feature Interaction: </span><span class="si">{</span><span class="n">X_interacted_df</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Selecting Top Features using Mutual Information...&quot;</span><span class="p">)</span>
    <span class="n">X_selected</span> <span class="o">=</span> <span class="n">mutual_info_selection</span><span class="p">(</span><span class="n">X_interacted_df</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k_features</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Applying Truncated SVD for Dimensionality Reduction...&quot;</span><span class="p">)</span>
    <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
    <span class="n">X_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_selected</span><span class="p">)</span>
    <span class="n">svd</span> <span class="o">=</span> <span class="n">TruncatedSVD</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_svd</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">X_reduced</span> <span class="o">=</span> <span class="n">svd</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shape after Truncated SVD: </span><span class="si">{</span><span class="n">X_reduced</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_reduced</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="c1"># --- 3. Train and Log Models ---</span>
<span class="k">def</span> <span class="nf">train_and_log_experiment</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Train models, evaluate, and log results to MLflow.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;logistic&quot;</span><span class="p">:</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
        <span class="s2">&quot;ridge&quot;</span><span class="p">:</span> <span class="n">RidgeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
        <span class="s2">&quot;rf&quot;</span><span class="p">:</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
        <span class="s2">&quot;xgb&quot;</span><span class="p">:</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;mlogloss&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">param_grids</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;logistic&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]},</span>
        <span class="s2">&quot;ridge&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]},</span>
        <span class="s2">&quot;rf&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">None</span><span class="p">]},</span>
        <span class="s2">&quot;xgb&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]}</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Training </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">experiment_name</span><span class="si">}</span><span class="s2">)...&quot;</span><span class="p">)</span>
        <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">param_grids</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1_weighted&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

        <span class="c1"># Best model and evaluation</span>
        <span class="n">best_model</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

        <span class="c1"># Log metrics</span>
        <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">experiment_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1 Score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cm</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Positives&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
                <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Negatives&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
                <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Positives&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
                <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Negatives&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">best_model</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">_experiment7_model&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model logged successfully: </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># --- 4. Main Workflow ---</span>
<span class="n">MLFLOW_TRACKING_URI</span> <span class="o">=</span> <span class="s2">&quot;https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mpadmavathi026&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;9b42720fee5e34c7387ebe0714d3496686fb1d8a&quot;</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="n">MLFLOW_TRACKING_URI</span><span class="p">)</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;bmi_diabetes_prediction&quot;</span><span class="p">)</span>

<span class="c1"># Process Low BMI Dataset</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Experiment #7: Processing Low BMI Dataset ===&quot;</span><span class="p">)</span>
<span class="n">X_train_low_preprocessed</span> <span class="o">=</span> <span class="n">preprocessing_pipeline</span><span class="p">(</span><span class="n">X_train_low</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">,</span> <span class="n">k_features</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_svd</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">X_test_low_preprocessed</span> <span class="o">=</span> <span class="n">preprocessing_pipeline</span><span class="p">(</span><span class="n">X_test_low</span><span class="p">,</span> <span class="n">y_test_low</span><span class="p">,</span> <span class="n">k_features</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_svd</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Process High BMI Dataset</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Experiment #7: Processing High BMI Dataset ===&quot;</span><span class="p">)</span>
<span class="n">X_train_high_preprocessed</span> <span class="o">=</span> <span class="n">preprocessing_pipeline</span><span class="p">(</span><span class="n">X_train_high</span><span class="p">,</span> <span class="n">y_train_high</span><span class="p">,</span> <span class="n">k_features</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_svd</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">X_test_high_preprocessed</span> <span class="o">=</span> <span class="n">preprocessing_pipeline</span><span class="p">(</span><span class="n">X_test_high</span><span class="p">,</span> <span class="n">y_test_high</span><span class="p">,</span> <span class="n">k_features</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_svd</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Train and Log Models for Low and High BMI</span>
<span class="n">train_and_log_experiment</span><span class="p">(</span><span class="n">X_train_low_preprocessed</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">,</span> <span class="n">X_test_low_preprocessed</span><span class="p">,</span> <span class="n">y_test_low</span><span class="p">,</span> <span class="s2">&quot;Low BMI&quot;</span><span class="p">,</span> <span class="s2">&quot;experiment_7&quot;</span><span class="p">)</span>
<span class="n">train_and_log_experiment</span><span class="p">(</span><span class="n">X_train_high_preprocessed</span><span class="p">,</span> <span class="n">y_train_high</span><span class="p">,</span> <span class="n">X_test_high_preprocessed</span><span class="p">,</span> <span class="n">y_test_high</span><span class="p">,</span> <span class="s2">&quot;High BMI&quot;</span><span class="p">,</span> <span class="s2">&quot;experiment_7&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Experiment #7 Complete. Results logged to MLflow.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Experiment #7: Processing Low BMI Dataset ===

Generating Feature Interaction Terms...
Shape after Feature Interaction: (103915, 55)

Selecting Top Features using Mutual Information...
Selected Features based on Mutual Information: [&#39;BMI&#39; &#39;PhysActivity&#39; &#39;BMI Feature_1&#39; &#39;BMI Feature_4&#39; &#39;Age Feature_4&#39;
 &#39;PhysActivity Feature_0&#39; &#39;PhysActivity Feature_1&#39; &#39;MentHlth Feature_1&#39;
 &#39;Feature_0 Feature_2&#39; &#39;Feature_0 Feature_5&#39;]

Applying Truncated SVD for Dimensionality Reduction...
Shape after Truncated SVD: (103915, 5)

Generating Feature Interaction Terms...
Shape after Feature Interaction: (25979, 55)

Selecting Top Features using Mutual Information...
Selected Features based on Mutual Information: [&#39;MentHlth&#39; &#39;Feature_5&#39; &#39;BMI Age&#39; &#39;BMI PhysActivity&#39; &#39;BMI Feature_0&#39;
 &#39;BMI Feature_3&#39; &#39;Age Feature_3&#39; &#39;Feature_0 Feature_4&#39;
 &#39;Feature_2 Feature_4&#39; &#39;Feature_4 Feature_5&#39;]

Applying Truncated SVD for Dimensionality Reduction...
Shape after Truncated SVD: (25979, 5)

=== Experiment #7: Processing High BMI Dataset ===

Generating Feature Interaction Terms...
Shape after Feature Interaction: (85187, 55)

Selecting Top Features using Mutual Information...
Selected Features based on Mutual Information: [&#39;Feature_1&#39; &#39;BMI Age&#39; &#39;BMI Feature_1&#39; &#39;Age Feature_5&#39;
 &#39;PhysActivity Feature_2&#39; &#39;PhysActivity Feature_4&#39; &#39;MentHlth Feature_0&#39;
 &#39;Feature_0 Feature_5&#39; &#39;Feature_1 Feature_2&#39; &#39;Feature_2 Feature_4&#39;]

Applying Truncated SVD for Dimensionality Reduction...
Shape after Truncated SVD: (85187, 5)

Generating Feature Interaction Terms...
Shape after Feature Interaction: (21297, 55)

Selecting Top Features using Mutual Information...
Selected Features based on Mutual Information: [&#39;Feature_4&#39; &#39;Feature_5&#39; &#39;BMI Feature_3&#39; &#39;Age Feature_2&#39;
 &#39;PhysActivity Feature_5&#39; &#39;MentHlth Feature_3&#39; &#39;Feature_0 Feature_4&#39;
 &#39;Feature_1 Feature_2&#39; &#39;Feature_2 Feature_3&#39; &#39;Feature_3 Feature_5&#39;]

Applying Truncated SVD for Dimensionality Reduction...
Shape after Truncated SVD: (21297, 5)

Training logistic for Low BMI (experiment_7)...
Fitting 3 folds for each of 4 candidates, totalling 12 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 02:35:10 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model logged successfully: logistic for Low BMI
🏃 View run experiment_7_logistic_Low BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/8dc523b8575040d69cff6a1bb10a050a
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training ridge for Low BMI (experiment_7)...
Fitting 3 folds for each of 3 candidates, totalling 9 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 02:35:20 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model logged successfully: ridge for Low BMI
🏃 View run experiment_7_ridge_Low BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/0ff8bc57d1974ca7bafedf5e198d9dd2
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training rf for Low BMI (experiment_7)...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 02:38:14 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model logged successfully: rf for Low BMI
🏃 View run experiment_7_rf_Low BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/b29f035b145045098dbf91c29f6f6083
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training xgb for Low BMI (experiment_7)...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 02:38:24 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model logged successfully: xgb for Low BMI
🏃 View run experiment_7_xgb_Low BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/9b7f772930f849a780fb96b41ef1ed04
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training logistic for High BMI (experiment_7)...
Fitting 3 folds for each of 4 candidates, totalling 12 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 02:38:53 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model logged successfully: logistic for High BMI
🏃 View run experiment_7_logistic_High BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/47eb06e767b04d50a7b981d6413d3985
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training ridge for High BMI (experiment_7)...
Fitting 3 folds for each of 3 candidates, totalling 9 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 02:39:04 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model logged successfully: ridge for High BMI
🏃 View run experiment_7_ridge_High BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/7d2366c7657b470f8cec7922abab28e4
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training rf for High BMI (experiment_7)...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 02:41:37 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model logged successfully: rf for High BMI
🏃 View run experiment_7_rf_High BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/c70d94514bc74fd19270a150511673c9
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Training xgb for High BMI (experiment_7)...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/17 02:41:47 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model logged successfully: xgb for High BMI
🏃 View run experiment_7_xgb_High BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/86c1a052987f40c284da3ebf3daaa802
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0

Experiment #7 Complete. Results logged to MLflow.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Transform Test Data</span>
<span class="n">X_test_low_prepared</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_low</span><span class="p">)</span>
<span class="n">X_test_low_prepared_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">X_test_low_prepared</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">(),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">X_test_low</span><span class="o">.</span><span class="n">index</span>
<span class="p">)</span>

<span class="n">X_test_high_prepared</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_high</span><span class="p">)</span>
<span class="n">X_test_high_prepared_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">X_test_high_prepared</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">(),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">X_test_high</span><span class="o">.</span><span class="n">index</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_low_prepared</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">X_low_prepared</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(236378, 34)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessing</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;pipeline-1__ratio&#39;, &#39;pipeline-2__BMI&#39;, &#39;pipeline-2__PhysActivity&#39;,
       &#39;pipeline-2__MentHlth&#39;, &#39;clustersimilarity__Cluster_0_similarity&#39;,
       &#39;clustersimilarity__Cluster_1_similarity&#39;,
       &#39;clustersimilarity__Cluster_2_similarity&#39;,
       &#39;clustersimilarity__Cluster_3_similarity&#39;,
       &#39;clustersimilarity__Cluster_4_similarity&#39;,
       &#39;clustersimilarity__Cluster_5_similarity&#39;,
       &#39;clustersimilarity__Cluster_6_similarity&#39;,
       &#39;clustersimilarity__Cluster_7_similarity&#39;,
       &#39;clustersimilarity__Cluster_8_similarity&#39;,
       &#39;clustersimilarity__Cluster_9_similarity&#39;, &#39;passthrough__HighBP&#39;,
       &#39;passthrough__CholCheck&#39;, &#39;passthrough__PhysActivity&#39;,
       &#39;passthrough__Fruits&#39;, &#39;passthrough__Veggies&#39;,
       &#39;passthrough__HvyAlcoholConsump&#39;, &#39;passthrough__AnyHealthcare&#39;,
       &#39;passthrough__Sex&#39;, &#39;passthrough__Age&#39;, &#39;remainder__Diabetes_012&#39;,
       &#39;remainder__HighChol&#39;, &#39;remainder__Smoker&#39;, &#39;remainder__Stroke&#39;,
       &#39;remainder__HeartDiseaseorAttack&#39;, &#39;remainder__NoDocbcCost&#39;,
       &#39;remainder__GenHlth&#39;, &#39;remainder__PhysHlth&#39;, &#39;remainder__DiffWalk&#39;,
       &#39;remainder__Education&#39;, &#39;remainder__Income&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span><span class="p">,</span><span class="n">RidgeClassifier</span>
<span class="n">X_train_low</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X_train_high</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">X_train_low</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X_train_high</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">lr_low</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessing</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;multinomial&#39;</span><span class="p">,</span><span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
<span class="p">])</span>

<span class="n">lr_high</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessing</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;multinomial&#39;</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Fit pipelines</span>
<span class="n">lr_low</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_low</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">)</span>
<span class="n">y_pred_low</span> <span class="o">=</span> <span class="n">lr_low</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_low</span><span class="p">)</span>

<span class="n">lr_high</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_high</span><span class="p">,</span> <span class="n">y_train_high</span><span class="p">)</span>
<span class="n">y_pred_high</span> <span class="o">=</span> <span class="n">lr_high</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_high</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unique values in Low BMI target variable:&quot;</span><span class="p">,</span> <span class="n">y_train_low</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unique values in High BMI target variable:&quot;</span><span class="p">,</span> <span class="n">y_train_high</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="n">y_pred_low_rounded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">y_pred_low</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rounded Predictions for Low BMI:&quot;</span><span class="p">,</span> <span class="n">y_pred_low_rounded</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>

<span class="n">y_pred_high_rounded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">y_pred_high</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rounded Predictions for High BMI:&quot;</span><span class="p">,</span> <span class="n">y_pred_high_rounded</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Actual values for Low BMI Test Set:&quot;</span><span class="p">,</span> <span class="n">y_test_low</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Predicted values for Low BMI Test Set:&quot;</span><span class="p">,</span> <span class="n">y_pred_low_rounded</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unique values in Low BMI target variable: [0. 2. 1.]
Unique values in High BMI target variable: [0. 2. 1.]
Rounded Predictions for Low BMI: [2. 2. 1. 0. 1.]
Rounded Predictions for High BMI: [1. 0. 0. 1. 2.]
Actual values for Low BMI Test Set: [0. 2. 0. 0. 0.]
Predicted values for Low BMI Test Set: [2. 2. 1. 0. 1.]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 7: Error Ratios Calculation with Division by Zero Handling</span>

<span class="c1"># Step 7: Error Calculation (Handle Zero Safely)</span>

<span class="c1"># Low BMI Absolute Error</span>
<span class="n">error_ratios_low</span> <span class="o">=</span> <span class="n">y_pred_low</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_test_low</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># Absolute error</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Low BMI Absolute Errors:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">error</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">error_ratios_low</span><span class="p">]))</span>

<span class="c1"># High BMI Absolute Error</span>
<span class="n">error_ratios_high</span> <span class="o">=</span> <span class="n">y_pred_high</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_test_high</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># Absolute error</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">High BMI Absolute Errors:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">error</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">error_ratios_high</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Low BMI Absolute Errors:
2.0, 0.0, 1.0, 0.0, 1.0

High BMI Absolute Errors:
1.0, 0.0, 0.0, 1.0, 2.0
</pre></div>
</div>
</div>
</div>
<p>Low BMI Absolute Errors:
[2.0, 0.0, 1.0, 1.0, 1.0]
2.0: The predicted value was 2 while the actual was 0.
0.0: The predicted value perfectly matched the actual value.
1.0: The predicted value was off by 1 unit compared to the actual.
High BMI Absolute Errors:
[1.0, 0.0, 0.0, 1.0, 2.0]
1.0: The prediction deviated by 1 unit from the actual value.
2.0: The prediction was 2 while the actual was 0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">precision_score</span>
<span class="c1"># Evaluate Results</span>
<span class="n">acc_low</span><span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test_low</span><span class="p">,</span> <span class="n">y_pred_low</span><span class="p">)</span>
<span class="n">acc_high</span><span class="o">=</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test_high</span><span class="p">,</span> <span class="n">y_pred_high</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy (Low BMI):&quot;</span><span class="p">,</span> <span class="n">acc_low</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy (High BMI):&quot;</span><span class="p">,</span> <span class="n">acc_high</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Accuracy (Low BMI): 0.6375534085222679
Accuracy (High BMI): 0.6048739259050571
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span>
<span class="n">cv_scores_lr_low</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">lr_low</span><span class="p">,</span> <span class="n">X_train_low</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
<span class="n">cv_scores_lr_high</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">lr_high</span><span class="p">,</span> <span class="n">X_train_high</span><span class="p">,</span> <span class="n">y_train_high</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cross-Validation Scores for Logistic (Low BMI):&quot;</span><span class="p">,</span> <span class="n">cv_scores_lr_low</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean CV Score (Low BMI):&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_scores_lr_low</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cross-Validation Scores for Logistic (High BMI):&quot;</span><span class="p">,</span> <span class="n">cv_scores_lr_high</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean CV Score (High BMI):&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_scores_lr_high</span><span class="p">))</span>

<span class="c1"># Step 8: Compute Metrics</span>
<span class="k">def</span> <span class="nf">log_metrics</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">if</span> <span class="n">cm</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f1</span><span class="p">,</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span>

<span class="n">f1_low</span><span class="p">,</span> <span class="n">tn_low</span><span class="p">,</span> <span class="n">fp_low</span><span class="p">,</span> <span class="n">fn_low</span><span class="p">,</span> <span class="n">tp_low</span> <span class="o">=</span> <span class="n">log_metrics</span><span class="p">(</span><span class="n">y_test_low</span><span class="p">,</span> <span class="n">y_pred_low_rounded</span><span class="p">)</span>
<span class="n">f1_high</span><span class="p">,</span> <span class="n">tn_high</span><span class="p">,</span> <span class="n">fp_high</span><span class="p">,</span> <span class="n">fn_high</span><span class="p">,</span> <span class="n">tp_high</span> <span class="o">=</span> <span class="n">log_metrics</span><span class="p">(</span><span class="n">y_test_high</span><span class="p">,</span> <span class="n">y_pred_high_rounded</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f1_low</span><span class="p">,</span> <span class="n">tn_low</span><span class="p">,</span> <span class="n">fp_low</span><span class="p">,</span> <span class="n">fn_low</span><span class="p">,</span> <span class="n">tp_low</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cross-Validation Scores for Logistic (Low BMI): [0.63375674 0.6360662  0.6301963  0.64135874 0.63423788 0.64478876
 0.6347801  0.63449139 0.62717737 0.63314407]
Mean CV Score (Low BMI): 0.6349997534803353
Cross-Validation Scores for Logistic (High BMI): [0.6087569  0.59126658 0.59619674 0.59596197 0.60065735 0.60042258
 0.59854443 0.58628786 0.60072787 0.60835877]
Mean CV Score (High BMI): 0.5987181051121148
0.7247920529842846 0 0 0 0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">lr_low</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_params</span><span class="p">())</span>  <span class="c1"># For the entire pipeline</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;C&#39;: 1.0, &#39;class_weight&#39;: &#39;balanced&#39;, &#39;dual&#39;: False, &#39;fit_intercept&#39;: True, &#39;intercept_scaling&#39;: 1, &#39;l1_ratio&#39;: None, &#39;max_iter&#39;: 500, &#39;multi_class&#39;: &#39;multinomial&#39;, &#39;n_jobs&#39;: None, &#39;penalty&#39;: &#39;l2&#39;, &#39;random_state&#39;: 42, &#39;solver&#39;: &#39;lbfgs&#39;, &#39;tol&#39;: 0.0001, &#39;verbose&#39;: 0, &#39;warm_start&#39;: False}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">pip</span> install dagshub mlflow
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: dagshub in /opt/anaconda3/lib/python3.12/site-packages (0.3.47)
Requirement already satisfied: mlflow in /opt/anaconda3/lib/python3.12/site-packages (2.19.0)
Requirement already satisfied: PyYAML&gt;=5 in /opt/anaconda3/lib/python3.12/site-packages (from dagshub) (6.0.1)
Requirement already satisfied: appdirs&gt;=1.4.4 in /opt/anaconda3/lib/python3.12/site-packages (from dagshub) (1.4.4)
Requirement already satisfied: click&gt;=8.0.4 in /opt/anaconda3/lib/python3.12/site-packages (from dagshub) (8.1.7)
Requirement already satisfied: httpx&gt;=0.23.0 in /opt/anaconda3/lib/python3.12/site-packages (from dagshub) (0.27.0)
Requirement already satisfied: GitPython&gt;=3.1.29 in /opt/anaconda3/lib/python3.12/site-packages (from dagshub) (3.1.37)
Requirement already satisfied: rich&gt;=13.1.0 in /opt/anaconda3/lib/python3.12/site-packages (from dagshub) (13.3.5)
Requirement already satisfied: dacite~=1.6.0 in /opt/anaconda3/lib/python3.12/site-packages (from dagshub) (1.6.0)
Requirement already satisfied: tenacity&gt;=8.2.2 in /opt/anaconda3/lib/python3.12/site-packages (from dagshub) (8.2.2)
Requirement already satisfied: gql[requests] in /opt/anaconda3/lib/python3.12/site-packages (from dagshub) (3.5.0)
Requirement already satisfied: dataclasses-json in /opt/anaconda3/lib/python3.12/site-packages (from dagshub) (0.6.7)
Requirement already satisfied: pandas in /opt/anaconda3/lib/python3.12/site-packages (from dagshub) (2.2.2)
Requirement already satisfied: treelib&gt;=1.6.4 in /opt/anaconda3/lib/python3.12/site-packages (from dagshub) (1.7.0)
Requirement already satisfied: pathvalidate&gt;=3.0.0 in /opt/anaconda3/lib/python3.12/site-packages (from dagshub) (3.2.1)
Requirement already satisfied: python-dateutil in /opt/anaconda3/lib/python3.12/site-packages (from dagshub) (2.9.0.post0)
Requirement already satisfied: boto3 in /opt/anaconda3/lib/python3.12/site-packages (from dagshub) (1.35.81)
Requirement already satisfied: dagshub-annotation-converter&gt;=0.1.0 in /opt/anaconda3/lib/python3.12/site-packages (from dagshub) (0.1.2)
Requirement already satisfied: mlflow-skinny==2.19.0 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow) (2.19.0)
Requirement already satisfied: Flask&lt;4 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow) (3.0.3)
Requirement already satisfied: Jinja2&lt;4,&gt;=2.11 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow) (3.1.4)
Requirement already satisfied: alembic!=1.10.0,&lt;2 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow) (1.14.0)
Requirement already satisfied: docker&lt;8,&gt;=4.0.0 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow) (7.1.0)
Requirement already satisfied: graphene&lt;4 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow) (3.4.3)
Requirement already satisfied: gunicorn&lt;24 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow) (23.0.0)
Requirement already satisfied: markdown&lt;4,&gt;=3.3 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow) (3.4.1)
Requirement already satisfied: matplotlib&lt;4 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow) (3.8.4)
Requirement already satisfied: numpy&lt;3 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow) (1.26.4)
Requirement already satisfied: pyarrow&lt;19,&gt;=4.0.0 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow) (14.0.2)
Requirement already satisfied: scikit-learn&lt;2 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow) (1.4.2)
Requirement already satisfied: scipy&lt;2 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow) (1.13.1)
Requirement already satisfied: sqlalchemy&lt;3,&gt;=1.4.0 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow) (2.0.30)
Requirement already satisfied: cachetools&lt;6,&gt;=5.0.0 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (5.3.3)
Requirement already satisfied: cloudpickle&lt;4 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (2.2.1)
Requirement already satisfied: databricks-sdk&lt;1,&gt;=0.20.0 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (0.39.0)
Requirement already satisfied: importlib_metadata!=4.7.0,&lt;9,&gt;=3.7.0 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (7.0.1)
Requirement already satisfied: opentelemetry-api&lt;3,&gt;=1.9.0 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (1.29.0)
Requirement already satisfied: opentelemetry-sdk&lt;3,&gt;=1.9.0 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (1.29.0)
Requirement already satisfied: packaging&lt;25 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (23.2)
Requirement already satisfied: protobuf&lt;6,&gt;=3.12.0 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (5.28.3)
Requirement already satisfied: requests&lt;3,&gt;=2.17.3 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (2.32.2)
Requirement already satisfied: sqlparse&lt;1,&gt;=0.4.0 in /opt/anaconda3/lib/python3.12/site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (0.5.3)
Requirement already satisfied: Mako in /opt/anaconda3/lib/python3.12/site-packages (from alembic!=1.10.0,&lt;2-&gt;mlflow) (1.3.8)
Requirement already satisfied: typing-extensions&gt;=4 in /opt/anaconda3/lib/python3.12/site-packages (from alembic!=1.10.0,&lt;2-&gt;mlflow) (4.11.0)
Requirement already satisfied: lxml in /opt/anaconda3/lib/python3.12/site-packages (from dagshub-annotation-converter&gt;=0.1.0-&gt;dagshub) (5.2.1)
Requirement already satisfied: pillow in /opt/anaconda3/lib/python3.12/site-packages (from dagshub-annotation-converter&gt;=0.1.0-&gt;dagshub) (10.3.0)
Requirement already satisfied: pydantic&gt;=2.0.0 in /opt/anaconda3/lib/python3.12/site-packages (from dagshub-annotation-converter&gt;=0.1.0-&gt;dagshub) (2.5.3)
Requirement already satisfied: urllib3&gt;=1.26.0 in /opt/anaconda3/lib/python3.12/site-packages (from docker&lt;8,&gt;=4.0.0-&gt;mlflow) (2.2.2)
Requirement already satisfied: Werkzeug&gt;=3.0.0 in /opt/anaconda3/lib/python3.12/site-packages (from Flask&lt;4-&gt;mlflow) (3.0.3)
Requirement already satisfied: itsdangerous&gt;=2.1.2 in /opt/anaconda3/lib/python3.12/site-packages (from Flask&lt;4-&gt;mlflow) (2.2.0)
Requirement already satisfied: blinker&gt;=1.6.2 in /opt/anaconda3/lib/python3.12/site-packages (from Flask&lt;4-&gt;mlflow) (1.6.2)
Requirement already satisfied: gitdb&lt;5,&gt;=4.0.1 in /opt/anaconda3/lib/python3.12/site-packages (from GitPython&gt;=3.1.29-&gt;dagshub) (4.0.7)
Requirement already satisfied: graphql-core&lt;3.3,&gt;=3.1 in /opt/anaconda3/lib/python3.12/site-packages (from graphene&lt;4-&gt;mlflow) (3.2.5)
Requirement already satisfied: graphql-relay&lt;3.3,&gt;=3.1 in /opt/anaconda3/lib/python3.12/site-packages (from graphene&lt;4-&gt;mlflow) (3.2.0)
Requirement already satisfied: anyio in /opt/anaconda3/lib/python3.12/site-packages (from httpx&gt;=0.23.0-&gt;dagshub) (4.2.0)
Requirement already satisfied: certifi in /opt/anaconda3/lib/python3.12/site-packages (from httpx&gt;=0.23.0-&gt;dagshub) (2024.7.4)
Requirement already satisfied: httpcore==1.* in /opt/anaconda3/lib/python3.12/site-packages (from httpx&gt;=0.23.0-&gt;dagshub) (1.0.2)
Requirement already satisfied: idna in /opt/anaconda3/lib/python3.12/site-packages (from httpx&gt;=0.23.0-&gt;dagshub) (3.7)
Requirement already satisfied: sniffio in /opt/anaconda3/lib/python3.12/site-packages (from httpx&gt;=0.23.0-&gt;dagshub) (1.3.0)
Requirement already satisfied: h11&lt;0.15,&gt;=0.13 in /opt/anaconda3/lib/python3.12/site-packages (from httpcore==1.*-&gt;httpx&gt;=0.23.0-&gt;dagshub) (0.14.0)
Requirement already satisfied: MarkupSafe&gt;=2.0 in /opt/anaconda3/lib/python3.12/site-packages (from Jinja2&lt;4,&gt;=2.11-&gt;mlflow) (2.1.3)
Requirement already satisfied: contourpy&gt;=1.0.1 in /opt/anaconda3/lib/python3.12/site-packages (from matplotlib&lt;4-&gt;mlflow) (1.2.0)
Requirement already satisfied: cycler&gt;=0.10 in /opt/anaconda3/lib/python3.12/site-packages (from matplotlib&lt;4-&gt;mlflow) (0.11.0)
Requirement already satisfied: fonttools&gt;=4.22.0 in /opt/anaconda3/lib/python3.12/site-packages (from matplotlib&lt;4-&gt;mlflow) (4.51.0)
Requirement already satisfied: kiwisolver&gt;=1.3.1 in /opt/anaconda3/lib/python3.12/site-packages (from matplotlib&lt;4-&gt;mlflow) (1.4.4)
Requirement already satisfied: pyparsing&gt;=2.3.1 in /opt/anaconda3/lib/python3.12/site-packages (from matplotlib&lt;4-&gt;mlflow) (3.0.9)
Requirement already satisfied: pytz&gt;=2020.1 in /opt/anaconda3/lib/python3.12/site-packages (from pandas-&gt;dagshub) (2024.1)
Requirement already satisfied: tzdata&gt;=2022.7 in /opt/anaconda3/lib/python3.12/site-packages (from pandas-&gt;dagshub) (2023.3)
Requirement already satisfied: six&gt;=1.5 in /opt/anaconda3/lib/python3.12/site-packages (from python-dateutil-&gt;dagshub) (1.16.0)
Requirement already satisfied: markdown-it-py&lt;3.0.0,&gt;=2.2.0 in /opt/anaconda3/lib/python3.12/site-packages (from rich&gt;=13.1.0-&gt;dagshub) (2.2.0)
Requirement already satisfied: pygments&lt;3.0.0,&gt;=2.13.0 in /opt/anaconda3/lib/python3.12/site-packages (from rich&gt;=13.1.0-&gt;dagshub) (2.15.1)
Requirement already satisfied: joblib&gt;=1.2.0 in /opt/anaconda3/lib/python3.12/site-packages (from scikit-learn&lt;2-&gt;mlflow) (1.4.2)
Requirement already satisfied: threadpoolctl&gt;=2.0.0 in /opt/anaconda3/lib/python3.12/site-packages (from scikit-learn&lt;2-&gt;mlflow) (2.2.0)
Requirement already satisfied: botocore&lt;1.36.0,&gt;=1.35.81 in /opt/anaconda3/lib/python3.12/site-packages (from boto3-&gt;dagshub) (1.35.81)
Requirement already satisfied: jmespath&lt;2.0.0,&gt;=0.7.1 in /opt/anaconda3/lib/python3.12/site-packages (from boto3-&gt;dagshub) (1.0.1)
Requirement already satisfied: s3transfer&lt;0.11.0,&gt;=0.10.0 in /opt/anaconda3/lib/python3.12/site-packages (from boto3-&gt;dagshub) (0.10.4)
Requirement already satisfied: marshmallow&lt;4.0.0,&gt;=3.18.0 in /opt/anaconda3/lib/python3.12/site-packages (from dataclasses-json-&gt;dagshub) (3.23.1)
Requirement already satisfied: typing-inspect&lt;1,&gt;=0.4.0 in /opt/anaconda3/lib/python3.12/site-packages (from dataclasses-json-&gt;dagshub) (0.9.0)
Requirement already satisfied: yarl&lt;2.0,&gt;=1.6 in /opt/anaconda3/lib/python3.12/site-packages (from gql[requests]-&gt;dagshub) (1.9.3)
Requirement already satisfied: backoff&lt;3.0,&gt;=1.11.1 in /opt/anaconda3/lib/python3.12/site-packages (from gql[requests]-&gt;dagshub) (2.2.1)
Requirement already satisfied: requests-toolbelt&lt;2,&gt;=1.0.0 in /opt/anaconda3/lib/python3.12/site-packages (from gql[requests]-&gt;dagshub) (1.0.0)
Requirement already satisfied: google-auth~=2.0 in /opt/anaconda3/lib/python3.12/site-packages (from databricks-sdk&lt;1,&gt;=0.20.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (2.37.0)
Requirement already satisfied: smmap&lt;5,&gt;=3.0.1 in /opt/anaconda3/lib/python3.12/site-packages (from gitdb&lt;5,&gt;=4.0.1-&gt;GitPython&gt;=3.1.29-&gt;dagshub) (4.0.0)
Requirement already satisfied: zipp&gt;=0.5 in /opt/anaconda3/lib/python3.12/site-packages (from importlib_metadata!=4.7.0,&lt;9,&gt;=3.7.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (3.17.0)
Requirement already satisfied: mdurl~=0.1 in /opt/anaconda3/lib/python3.12/site-packages (from markdown-it-py&lt;3.0.0,&gt;=2.2.0-&gt;rich&gt;=13.1.0-&gt;dagshub) (0.1.0)
Requirement already satisfied: deprecated&gt;=1.2.6 in /opt/anaconda3/lib/python3.12/site-packages (from opentelemetry-api&lt;3,&gt;=1.9.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (1.2.15)
Requirement already satisfied: opentelemetry-semantic-conventions==0.50b0 in /opt/anaconda3/lib/python3.12/site-packages (from opentelemetry-sdk&lt;3,&gt;=1.9.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (0.50b0)
Requirement already satisfied: annotated-types&gt;=0.4.0 in /opt/anaconda3/lib/python3.12/site-packages (from pydantic&gt;=2.0.0-&gt;dagshub-annotation-converter&gt;=0.1.0-&gt;dagshub) (0.6.0)
Requirement already satisfied: pydantic-core==2.14.6 in /opt/anaconda3/lib/python3.12/site-packages (from pydantic&gt;=2.0.0-&gt;dagshub-annotation-converter&gt;=0.1.0-&gt;dagshub) (2.14.6)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in /opt/anaconda3/lib/python3.12/site-packages (from requests&lt;3,&gt;=2.17.3-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (2.0.4)
Requirement already satisfied: mypy-extensions&gt;=0.3.0 in /opt/anaconda3/lib/python3.12/site-packages (from typing-inspect&lt;1,&gt;=0.4.0-&gt;dataclasses-json-&gt;dagshub) (1.0.0)
Requirement already satisfied: multidict&gt;=4.0 in /opt/anaconda3/lib/python3.12/site-packages (from yarl&lt;2.0,&gt;=1.6-&gt;gql[requests]-&gt;dagshub) (6.0.4)
Requirement already satisfied: wrapt&lt;2,&gt;=1.10 in /opt/anaconda3/lib/python3.12/site-packages (from deprecated&gt;=1.2.6-&gt;opentelemetry-api&lt;3,&gt;=1.9.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (1.14.1)
Requirement already satisfied: pyasn1-modules&gt;=0.2.1 in /opt/anaconda3/lib/python3.12/site-packages (from google-auth~=2.0-&gt;databricks-sdk&lt;1,&gt;=0.20.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (0.2.8)
Requirement already satisfied: rsa&lt;5,&gt;=3.1.4 in /opt/anaconda3/lib/python3.12/site-packages (from google-auth~=2.0-&gt;databricks-sdk&lt;1,&gt;=0.20.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (4.9)
Requirement already satisfied: pyasn1&lt;0.5.0,&gt;=0.4.6 in /opt/anaconda3/lib/python3.12/site-packages (from pyasn1-modules&gt;=0.2.1-&gt;google-auth~=2.0-&gt;databricks-sdk&lt;1,&gt;=0.20.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (0.4.8)
Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">9</span><span class="n">b42720fee5e34c7387ebe0714d3496686fb1d8a</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">infer_signature</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># MLflow configuration</span>
<span class="n">MLFLOW_TRACKING_URI</span> <span class="o">=</span> <span class="s2">&quot;https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mpadmavathi026&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;9b42720fee5e34c7387ebe0714d3496686fb1d8a&quot;</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="n">MLFLOW_TRACKING_URI</span><span class="p">)</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;bmi_diabetes_prediction&quot;</span><span class="p">)</span>

<span class="c1"># Prepare `df` without the target column</span>
<span class="n">df_low_features</span> <span class="o">=</span> <span class="n">X_test_low</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_high_features</span> <span class="o">=</span> <span class="n">X_test_high</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">score_low</span> <span class="o">=</span> <span class="n">acc_low</span>
<span class="n">score_high</span> <span class="o">=</span> <span class="n">acc_high</span>
<span class="n">param_low</span> <span class="o">=</span> <span class="n">lr_low</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
<span class="n">param_high</span> <span class="o">=</span> <span class="n">lr_high</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;LR_Low_BMI_Model&quot;</span><span class="p">):</span>
    <span class="c1"># Log parameters</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">({</span><span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Logistic Regression&quot;</span><span class="p">,</span> <span class="s2">&quot;bmi_group&quot;</span><span class="p">:</span> <span class="s2">&quot;Low&quot;</span><span class="p">})</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">param_low</span><span class="p">)</span>

    <span class="c1"># Log metrics</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;accuracy_low&quot;</span><span class="p">,</span> <span class="n">score_low</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_score&quot;</span><span class="p">,</span> <span class="n">f1_low</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Positives&quot;</span><span class="p">,</span> <span class="n">tp_low</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Negatives&quot;</span><span class="p">,</span> <span class="n">tn_low</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Positives&quot;</span><span class="p">,</span> <span class="n">fp_low</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Negatives&quot;</span><span class="p">,</span> <span class="n">fn_low</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;CV_Mean_F1&quot;</span><span class="p">,</span> <span class="n">cv_scores_lr_low</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;CV_Std_F1&quot;</span><span class="p">,</span> <span class="n">cv_scores_lr_low</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    


    <span class="c1"># Infer signature and log the model</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">df_low_features</span><span class="p">,</span> <span class="n">lr_low</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_low_features</span><span class="p">))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">sk_model</span><span class="o">=</span><span class="n">lr_low</span><span class="p">,</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;Diabetes_model_low&quot;</span><span class="p">,</span>
        <span class="n">signature</span><span class="o">=</span><span class="n">signature</span><span class="p">,</span>
        <span class="n">input_example</span><span class="o">=</span><span class="n">df_low_features</span><span class="p">,</span>
        <span class="n">registered_model_name</span><span class="o">=</span><span class="s2">&quot;Low_BMI_Logistic_Regression&quot;</span>
    <span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;LR_High_BMI_Model&quot;</span><span class="p">):</span>
    <span class="c1"># Log parameters</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">({</span><span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Logistic Regression&quot;</span><span class="p">,</span> <span class="s2">&quot;bmi_group&quot;</span><span class="p">:</span> <span class="s2">&quot;High&quot;</span><span class="p">})</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">param_high</span><span class="p">)</span>
    <span class="c1"># Log metrics</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;accuracy_high&quot;</span><span class="p">,</span> <span class="n">score_high</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_score&quot;</span><span class="p">,</span> <span class="n">f1_high</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Positives&quot;</span><span class="p">,</span> <span class="n">tp_high</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Negatives&quot;</span><span class="p">,</span> <span class="n">tn_high</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Positives&quot;</span><span class="p">,</span> <span class="n">fp_high</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Negatives&quot;</span><span class="p">,</span> <span class="n">fn_high</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;CV_Mean_F1&quot;</span><span class="p">,</span> <span class="n">cv_scores_lr_high</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;CV_Std_F1&quot;</span><span class="p">,</span> <span class="n">cv_scores_lr_high</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>

    <span class="c1"># Infer signature and log the model</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">df_high_features</span><span class="p">,</span><span class="n">lr_high</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_high_features</span><span class="p">))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">sk_model</span><span class="o">=</span><span class="n">lr_high</span><span class="p">,</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;Diabetes_model_high&quot;</span><span class="p">,</span>
        <span class="n">signature</span><span class="o">=</span><span class="n">signature</span><span class="p">,</span>
        <span class="n">input_example</span><span class="o">=</span><span class="n">df_high_features</span><span class="p">,</span>
        <span class="n">registered_model_name</span><span class="o">=</span><span class="s2">&quot;High_BMI_Logistic_Regression&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Registered model &#39;Low_BMI_Logistic_Regression&#39; already exists. Creating a new version of this model...
2024/12/15 23:21:37 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: Low_BMI_Logistic_Regression, version 15
Created version &#39;15&#39; of model &#39;Low_BMI_Logistic_Regression&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run LR_Low_BMI_Model at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/e3675436d1864fe3a5763c5a00d8da71
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Registered model &#39;High_BMI_Logistic_Regression&#39; already exists. Creating a new version of this model...
2024/12/15 23:21:58 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: High_BMI_Logistic_Regression, version 11
Created version &#39;11&#39; of model &#39;High_BMI_Logistic_Regression&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run LR_High_BMI_Model at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/eac74724ed994ff9930e886296831ae2
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>

<span class="n">param_grid_lr</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;classifier__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>  <span class="c1"># Regularization strength</span>
    <span class="s1">&#39;classifier__solver&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">],</span>  <span class="c1"># Solvers</span>
    <span class="s1">&#39;classifier__penalty&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;l2&#39;</span><span class="p">],</span>  <span class="c1"># Penalty type</span>
<span class="p">}</span>

<span class="c1"># Perform GridSearchCV for Logistic Regression (Low BMI)</span>
<span class="n">grid_search_lr_low</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">lr_low</span><span class="p">,</span> <span class="n">param_grid_lr</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">grid_search_lr_low</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_low</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">)</span>

<span class="c1"># Perform GridSearchCV for Logistic Regression (High BMI)</span>
<span class="n">grid_search_lr_high</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">lr_high</span><span class="p">,</span> <span class="n">param_grid_lr</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">grid_search_lr_high</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_high</span><span class="p">,</span> <span class="n">y_train_high</span><span class="p">)</span>

<span class="c1"># Evaluate Best Logistic Regression Models</span>
<span class="n">best_lr_low</span> <span class="o">=</span> <span class="n">grid_search_lr_low</span><span class="o">.</span><span class="n">best_estimator_</span>
<span class="n">best_lr_high</span> <span class="o">=</span> <span class="n">grid_search_lr_high</span><span class="o">.</span><span class="n">best_estimator_</span>

<span class="n">y_pred_lr_low</span> <span class="o">=</span> <span class="n">best_lr_low</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_low</span><span class="p">)</span>
<span class="n">y_pred_lr_high</span> <span class="o">=</span> <span class="n">best_lr_high</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_high</span><span class="p">)</span>

<span class="n">accuracy_lr_low</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test_low</span><span class="p">,</span> <span class="n">y_pred_lr_low</span><span class="p">)</span>
<span class="n">accuracy_lr_high</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test_high</span><span class="p">,</span> <span class="n">y_pred_lr_high</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fitting 3 folds for each of 4 candidates, totalling 12 fits
Fitting 3 folds for each of 4 candidates, totalling 12 fits
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Predict and compute metrics for Low BMI</span>
<span class="n">y_pred_lr_low</span> <span class="o">=</span> <span class="n">best_lr_low</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_low</span><span class="p">)</span>
<span class="n">f1_low</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test_low</span><span class="p">,</span> <span class="n">y_pred_lr_low</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
<span class="n">cm_low</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test_low</span><span class="p">,</span> <span class="n">y_pred_lr_low</span><span class="p">)</span>
<span class="n">tn_low</span><span class="p">,</span> <span class="n">fp_low</span><span class="p">,</span> <span class="n">fn_low</span><span class="p">,</span> <span class="n">tp_low</span> <span class="o">=</span> <span class="n">cm_low</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">if</span> <span class="n">cm_low</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Predict and compute metrics for High BMI</span>
<span class="n">y_pred_lr_high</span> <span class="o">=</span> <span class="n">best_lr_high</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_high</span><span class="p">)</span>
<span class="n">f1_high</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test_high</span><span class="p">,</span> <span class="n">y_pred_lr_high</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
<span class="n">cm_high</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test_high</span><span class="p">,</span> <span class="n">y_pred_lr_high</span><span class="p">)</span>
<span class="n">tn_high</span><span class="p">,</span> <span class="n">fp_high</span><span class="p">,</span> <span class="n">fn_high</span><span class="p">,</span> <span class="n">tp_high</span> <span class="o">=</span> <span class="n">cm_high</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">if</span> <span class="n">cm_high</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Cross-validation scores</span>
<span class="n">cv_scores_low</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">best_lr_low</span><span class="p">,</span> <span class="n">X_train_low</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1_weighted&#39;</span><span class="p">)</span>
<span class="n">cv_scores_high</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">best_lr_high</span><span class="p">,</span> <span class="n">X_train_high</span><span class="p">,</span> <span class="n">y_train_high</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1_weighted&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># MLflow configuration</span>
<span class="n">MLFLOW_TRACKING_URI</span> <span class="o">=</span> <span class="s2">&quot;https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mpadmavathi026&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;9b42720fee5e34c7387ebe0714d3496686fb1d8a&quot;</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="n">MLFLOW_TRACKING_URI</span><span class="p">)</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;bmi_diabetes_prediction&quot;</span><span class="p">)</span>

<span class="c1"># Prepare `df` without the target column</span>
<span class="n">df_low_features</span> <span class="o">=</span> <span class="n">X_test_low</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_high_features</span> <span class="o">=</span> <span class="n">X_test_high</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">score_low</span> <span class="o">=</span> <span class="n">acc_low</span>
<span class="n">score_high</span> <span class="o">=</span> <span class="n">acc_high</span>
<span class="n">param_low</span> <span class="o">=</span> <span class="n">lr_low</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
<span class="n">param_high</span> <span class="o">=</span> <span class="n">lr_high</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;Tuned_Logistic_Regression_Low_BMI&quot;</span><span class="p">):</span>
    <span class="c1"># Log parameters</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">({</span><span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Logistic Regression&quot;</span><span class="p">,</span> <span class="s2">&quot;bmi_group&quot;</span><span class="p">:</span> <span class="s2">&quot;Low&quot;</span><span class="p">})</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">param_low</span><span class="p">)</span>

    <span class="c1"># Log metrics</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;accuracy_low&quot;</span><span class="p">,</span> <span class="n">score_low</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">grid_search_lr_low</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_score&quot;</span><span class="p">,</span> <span class="n">f1_low</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Positives&quot;</span><span class="p">,</span> <span class="n">tp_low</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Negatives&quot;</span><span class="p">,</span> <span class="n">tn_low</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Positives&quot;</span><span class="p">,</span> <span class="n">fp_low</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Negatives&quot;</span><span class="p">,</span> <span class="n">fn_low</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;CV_Mean_F1&quot;</span><span class="p">,</span> <span class="n">cv_scores_low</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;CV_Std_F1&quot;</span><span class="p">,</span> <span class="n">cv_scores_low</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">best_lr_low</span><span class="p">,</span> <span class="s2">&quot;tuned_logistic_regression_low_bmi&quot;</span><span class="p">)</span>

    

    <span class="c1"># Infer signature and log the model</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">df_low_features</span><span class="p">,</span> <span class="n">lr_low</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_low_features</span><span class="p">))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">sk_model</span><span class="o">=</span><span class="n">lr_low</span><span class="p">,</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;Diabetes_model_low&quot;</span><span class="p">,</span>
        <span class="n">signature</span><span class="o">=</span><span class="n">signature</span><span class="p">,</span>
        <span class="n">input_example</span><span class="o">=</span><span class="n">df_low_features</span><span class="p">,</span>
        <span class="n">registered_model_name</span><span class="o">=</span><span class="s2">&quot;Low_BMI_Logistic_Regression&quot;</span>
    <span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;Tuned_Logistic_Regression_High_BMI&quot;</span><span class="p">):</span>
    <span class="c1"># Log parameters</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">({</span><span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Logistic Regression&quot;</span><span class="p">,</span> <span class="s2">&quot;bmi_group&quot;</span><span class="p">:</span> <span class="s2">&quot;High&quot;</span><span class="p">})</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">param_high</span><span class="p">)</span>
    <span class="c1"># Log metrics</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;accuracy_high&quot;</span><span class="p">,</span> <span class="n">score_high</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">grid_search_lr_high</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_score&quot;</span><span class="p">,</span> <span class="n">f1_high</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Positives&quot;</span><span class="p">,</span> <span class="n">tp_high</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Negatives&quot;</span><span class="p">,</span> <span class="n">tn_high</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Positives&quot;</span><span class="p">,</span> <span class="n">fp_high</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Negatives&quot;</span><span class="p">,</span> <span class="n">fn_high</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;CV_Mean_F1&quot;</span><span class="p">,</span> <span class="n">cv_scores_high</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;CV_Std_F1&quot;</span><span class="p">,</span> <span class="n">cv_scores_high</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">best_lr_high</span><span class="p">,</span> <span class="s2">&quot;tuned_logistic_regression_high_bmi&quot;</span><span class="p">)</span>


    <span class="c1"># Infer signature and log the model</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">df_high_features</span><span class="p">,</span><span class="n">lr_high</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_high_features</span><span class="p">))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">sk_model</span><span class="o">=</span><span class="n">lr_high</span><span class="p">,</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;Diabetes_model_high&quot;</span><span class="p">,</span>
        <span class="n">signature</span><span class="o">=</span><span class="n">signature</span><span class="p">,</span>
        <span class="n">input_example</span><span class="o">=</span><span class="n">df_high_features</span><span class="p">,</span>
        <span class="n">registered_model_name</span><span class="o">=</span><span class="s2">&quot;High_BMI_Logistic_Regression&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/15 23:27:22 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
Registered model &#39;Low_BMI_Logistic_Regression&#39; already exists. Creating a new version of this model...
2024/12/15 23:27:38 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: Low_BMI_Logistic_Regression, version 16
Created version &#39;16&#39; of model &#39;Low_BMI_Logistic_Regression&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run Tuned_Logistic_Regression_Low_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/185cd6106c424c748f452ee405c41e8a
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/15 23:27:51 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
Registered model &#39;High_BMI_Logistic_Regression&#39; already exists. Creating a new version of this model...
2024/12/15 23:28:09 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: High_BMI_Logistic_Regression, version 12
Created version &#39;12&#39; of model &#39;High_BMI_Logistic_Regression&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run Tuned_Logistic_Regression_High_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/512c9b84f5034c53b96b649b034c8e66
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="c1"># Step 4: Define Pipelines and Parameter Grids</span>
<span class="n">pipelines</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;logistic&quot;</span><span class="p">:</span> <span class="n">Pipeline</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessing</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
    <span class="p">]),</span>
    <span class="s2">&quot;ridge&quot;</span><span class="p">:</span> <span class="n">Pipeline</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessing</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">RidgeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
    <span class="p">]),</span>
    <span class="s2">&quot;rf&quot;</span><span class="p">:</span> <span class="n">Pipeline</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessing</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
    <span class="p">]),</span>
    <span class="s2">&quot;xgb&quot;</span><span class="p">:</span> <span class="n">Pipeline</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessing</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;mlogloss&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
    <span class="p">])</span>
<span class="p">}</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="c1"># MLflow configuration</span>
<span class="n">MLFLOW_TRACKING_URI</span> <span class="o">=</span> <span class="s2">&quot;https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mpadmavathi026&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;9b42720fee5e34c7387ebe0714d3496686fb1d8a&quot;</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="n">MLFLOW_TRACKING_URI</span><span class="p">)</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;bmi_diabetes_prediction&quot;</span><span class="p">)</span>


<span class="c1"># Define models and hyperparameters</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>

<span class="n">param_grids</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;logistic&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;classifier__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="s1">&#39;classifier__solver&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="s1">&#39;lbfgs&#39;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;ridge&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;classifier__alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;rf&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;classifier__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="s1">&#39;classifier__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;xgb&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;classifier__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="s1">&#39;classifier__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">train_and_log_models</span><span class="p">(</span><span class="n">group_name</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training models for </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2"> BMI&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">pipeline</span> <span class="ow">in</span> <span class="n">pipelines</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        
        <span class="c1"># Perform GridSearchCV</span>
        <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grids</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1_weighted&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        
        <span class="c1"># Best Model</span>
        <span class="n">best_model</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
        <span class="n">best_params</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span>
        <span class="n">best_score</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span>
        
        <span class="c1"># Predictions and Metrics</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">if</span> <span class="n">cm</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
        <span class="c1"># Log to MLflow</span>
        <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Basic Tuned</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">_BMI&quot;</span><span class="p">):</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">best_params</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Best CV Score&quot;</span><span class="p">,</span> <span class="n">best_score</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1 Score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Positives&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Negatives&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Positives&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Negatives&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
            
            <span class="c1"># Log Model</span>
            <span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
                <span class="n">sk_model</span><span class="o">=</span><span class="n">best_model</span><span class="p">,</span>
                <span class="n">artifact_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">_bmi_model&quot;</span><span class="p">,</span>
                <span class="n">signature</span><span class="o">=</span><span class="n">signature</span><span class="p">,</span>
                <span class="n">input_example</span><span class="o">=</span><span class="n">X_test</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span>
                <span class="n">registered_model_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">_BMI_</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> logged successfully for </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2"> BMI.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Train and Log for Low and High BMI</span>
<span class="n">train_and_log_models</span><span class="p">(</span><span class="s2">&quot;Low&quot;</span><span class="p">,</span> <span class="n">X_train_low</span><span class="p">,</span> <span class="n">X_test_low</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">,</span> <span class="n">y_test_low</span><span class="p">)</span>
<span class="n">train_and_log_models</span><span class="p">(</span><span class="s2">&quot;High&quot;</span><span class="p">,</span> <span class="n">X_train_high</span><span class="p">,</span> <span class="n">X_test_high</span><span class="p">,</span> <span class="n">y_train_high</span><span class="p">,</span> <span class="n">y_test_high</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training models for Low BMI
Training logistic...
Fitting 3 folds for each of 8 candidates, totalling 24 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>python(76217) MallocStackLogging: can&#39;t turn off malloc stack logging because it was not enabled.
Registered model &#39;Low_BMI_logistic&#39; already exists. Creating a new version of this model...
2024/12/18 11:26:43 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: Low_BMI_logistic, version 7
Created version &#39;7&#39; of model &#39;Low_BMI_logistic&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run Basic Tunedlogistic_Low_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/5bc9796e302d4088948cc27303668096
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
Model logistic logged successfully for Low BMI.

Training ridge...
Fitting 3 folds for each of 3 candidates, totalling 9 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>python(76219) MallocStackLogging: can&#39;t turn off malloc stack logging because it was not enabled.
Registered model &#39;Low_BMI_ridge&#39; already exists. Creating a new version of this model...
2024/12/18 11:27:03 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: Low_BMI_ridge, version 7
Created version &#39;7&#39; of model &#39;Low_BMI_ridge&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run Basic Tunedridge_Low_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/4f33412b0ccd418980eee649df4bd3a9
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
Model ridge logged successfully for Low BMI.

Training rf...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>python(76233) MallocStackLogging: can&#39;t turn off malloc stack logging because it was not enabled.
Registered model &#39;Low_BMI_rf&#39; already exists. Creating a new version of this model...
2024/12/18 11:29:58 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: Low_BMI_rf, version 7
Created version &#39;7&#39; of model &#39;Low_BMI_rf&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run Basic Tunedrf_Low_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/d18aca24ccb2417893e1a2dec55e753d
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
Model rf logged successfully for Low BMI.

Training xgb...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>python(76280) MallocStackLogging: can&#39;t turn off malloc stack logging because it was not enabled.
Registered model &#39;Low_BMI_xgb&#39; already exists. Creating a new version of this model...
2024/12/18 11:30:24 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: Low_BMI_xgb, version 7
Created version &#39;7&#39; of model &#39;Low_BMI_xgb&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run Basic Tunedxgb_Low_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/94c7becde4584235afd6f313f683e117
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
Model xgb logged successfully for Low BMI.

Training models for High BMI
Training logistic...
Fitting 3 folds for each of 8 candidates, totalling 24 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>python(76281) MallocStackLogging: can&#39;t turn off malloc stack logging because it was not enabled.
Registered model &#39;High_BMI_logistic&#39; already exists. Creating a new version of this model...
2024/12/18 11:30:50 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: High_BMI_logistic, version 7
Created version &#39;7&#39; of model &#39;High_BMI_logistic&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run Basic Tunedlogistic_High_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/a1a3258ff7de4d108e489dc43c325520
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
Model logistic logged successfully for High BMI.

Training ridge...
Fitting 3 folds for each of 3 candidates, totalling 9 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>python(76282) MallocStackLogging: can&#39;t turn off malloc stack logging because it was not enabled.
Registered model &#39;High_BMI_ridge&#39; already exists. Creating a new version of this model...
2024/12/18 11:31:12 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: High_BMI_ridge, version 7
Created version &#39;7&#39; of model &#39;High_BMI_ridge&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run Basic Tunedridge_High_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/ec8315d305cf4a589d16591f394386a3
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
Model ridge logged successfully for High BMI.

Training rf...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>python(76284) MallocStackLogging: can&#39;t turn off malloc stack logging because it was not enabled.
Registered model &#39;High_BMI_rf&#39; already exists. Creating a new version of this model...
2024/12/18 11:38:29 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: High_BMI_rf, version 7
Created version &#39;7&#39; of model &#39;High_BMI_rf&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run Basic Tunedrf_High_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/179cae9214274db089d299e50ef2ed29
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
Model rf logged successfully for High BMI.

Training xgb...
Fitting 3 folds for each of 6 candidates, totalling 18 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>python(76324) MallocStackLogging: can&#39;t turn off malloc stack logging because it was not enabled.
Registered model &#39;High_BMI_xgb&#39; already exists. Creating a new version of this model...
2024/12/18 11:38:51 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: High_BMI_xgb, version 7
Created version &#39;7&#39; of model &#39;High_BMI_xgb&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run Basic Tunedxgb_High_BMI at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/fc33897176db42b2b1376992a9ee3f7f
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
Model xgb logged successfully for High BMI.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 5: Define Pipelines for Random Forest</span>
<span class="n">pipeline_rf_low</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessing</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
<span class="p">])</span>

<span class="n">pipeline_rf_high</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessing</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Train Random Forest Pipelines</span>
<span class="n">pipeline_rf_low</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_low</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">)</span>
<span class="n">y_pred_rf_low</span> <span class="o">=</span> <span class="n">pipeline_rf_low</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_low</span><span class="p">)</span>
<span class="n">accuracy_rf_low</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test_low</span><span class="p">,</span> <span class="n">y_pred_rf_low</span><span class="p">)</span>

<span class="n">pipeline_rf_high</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_high</span><span class="p">,</span> <span class="n">y_train_high</span><span class="p">)</span>
<span class="n">y_pred_rf_high</span> <span class="o">=</span> <span class="n">pipeline_rf_high</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_high</span><span class="p">)</span>
<span class="n">accuracy_rf_high</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test_high</span><span class="p">,</span> <span class="n">y_pred_rf_high</span><span class="p">)</span>

<span class="c1"># Cross-validation scores for Random Forest Pipelines</span>
<span class="n">cv_scores_rf_low</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">pipeline_rf_low</span><span class="p">,</span> <span class="n">X_train_low</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
<span class="n">cv_scores_rf_high</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">pipeline_rf_high</span><span class="p">,</span> <span class="n">X_train_high</span><span class="p">,</span> <span class="n">y_train_high</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cross-Validation Scores for Random Forest (Low BMI):&quot;</span><span class="p">,</span> <span class="n">cv_scores_rf_low</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean CV Score (Low BMI):&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_scores_rf_low</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cross-Validation Scores for Random Forest (High BMI):&quot;</span><span class="p">,</span> <span class="n">cv_scores_rf_high</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean CV Score (High BMI):&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_scores_rf_high</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cross-Validation Scores for Random Forest (Low BMI): [0.88702848 0.88837567 0.8884719  0.88510393 0.88924172 0.88615148
 0.88951978 0.88826869 0.88923107 0.885959  ]
Mean CV Score (Low BMI): 0.887735172536724
Cross-Validation Scores for Random Forest (High BMI): [0.76288297 0.75537035 0.7611222  0.76077004 0.75994835 0.76123958
 0.76077004 0.75722    0.7574548  0.76226814]
Mean CV Score (High BMI): 0.7599046477631689
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Predict and compute metrics for Low BMI</span>
<span class="n">y_pred_lr_low</span> <span class="o">=</span> <span class="n">pipeline_rf_low</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_low</span><span class="p">)</span>
<span class="n">f1_low</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test_low</span><span class="p">,</span> <span class="n">y_pred_lr_low</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
<span class="n">cm_low</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test_low</span><span class="p">,</span> <span class="n">y_pred_lr_low</span><span class="p">)</span>
<span class="n">tn_low</span><span class="p">,</span> <span class="n">fp_low</span><span class="p">,</span> <span class="n">fn_low</span><span class="p">,</span> <span class="n">tp_low</span> <span class="o">=</span> <span class="n">cm_low</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">if</span> <span class="n">cm_low</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Predict and compute metrics for High BMI</span>
<span class="n">y_pred_lr_high</span> <span class="o">=</span> <span class="n">pipeline_rf_high</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_high</span><span class="p">)</span>
<span class="n">f1_high</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test_high</span><span class="p">,</span> <span class="n">y_pred_lr_high</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
<span class="n">cm_high</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test_high</span><span class="p">,</span> <span class="n">y_pred_lr_high</span><span class="p">)</span>
<span class="n">tn_high</span><span class="p">,</span> <span class="n">fp_high</span><span class="p">,</span> <span class="n">fn_high</span><span class="p">,</span> <span class="n">tp_high</span> <span class="o">=</span> <span class="n">cm_high</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">if</span> <span class="n">cm_high</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">cv_scores_rf_low</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    10.000000
mean      0.887735
std       0.001564
min       0.885104
25%       0.886371
50%       0.888322
75%       0.889041
max       0.889520
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">cv_scores_rf_high</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    10.000000
mean      0.759905
std       0.002426
min       0.755370
25%       0.758078
50%       0.760770
75%       0.761210
max       0.762883
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># MLflow configuration</span>
<span class="n">MLFLOW_TRACKING_URI</span> <span class="o">=</span> <span class="s2">&quot;https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mpadmavathi026&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;9b42720fee5e34c7387ebe0714d3496686fb1d8a&quot;</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="n">MLFLOW_TRACKING_URI</span><span class="p">)</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;bmi_diabetes_prediction&quot;</span><span class="p">)</span>

<span class="c1"># Prepare `df` without the target column</span>
<span class="n">df_low_features</span> <span class="o">=</span> <span class="n">X_test_low</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_high_features</span> <span class="o">=</span> <span class="n">X_test_high</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">score_low</span> <span class="o">=</span> <span class="n">cv_scores_rf_low</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">score_high</span> <span class="o">=</span> <span class="n">cv_scores_rf_high</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">params_low</span> <span class="o">=</span> <span class="n">pipeline_rf_low</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
<span class="n">params_high</span> <span class="o">=</span> <span class="n">pipeline_rf_high</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;RandomForest_Low_BMI_Model&quot;</span><span class="p">):</span>
    <span class="c1"># Log parameters</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">({</span><span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Random Forest&quot;</span><span class="p">,</span> <span class="s2">&quot;bmi_group&quot;</span><span class="p">:</span> <span class="s2">&quot;Low&quot;</span><span class="p">})</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">params_low</span><span class="p">)</span>
  
    <span class="c1"># Log metrics</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;accuracy_low&quot;</span><span class="p">,</span> <span class="n">score_low</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_score&quot;</span><span class="p">,</span> <span class="n">f1_low</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Positives&quot;</span><span class="p">,</span> <span class="n">tp_low</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Negatives&quot;</span><span class="p">,</span> <span class="n">tn_low</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Positives&quot;</span><span class="p">,</span> <span class="n">fp_low</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Negatives&quot;</span><span class="p">,</span> <span class="n">fn_low</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;CV_Mean_F1&quot;</span><span class="p">,</span> <span class="n">cv_scores_low</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;CV_Std_F1&quot;</span><span class="p">,</span> <span class="n">cv_scores_low</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>


    <span class="c1"># Infer signature and log the model</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">df_low_features</span><span class="p">,</span> <span class="n">pipeline_rf_low</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_low_features</span><span class="p">))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">sk_model</span><span class="o">=</span><span class="n">pipeline_rf_low</span><span class="p">,</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;Diabetes_model_low&quot;</span><span class="p">,</span>
        <span class="n">signature</span><span class="o">=</span><span class="n">signature</span><span class="p">,</span>
        <span class="n">input_example</span><span class="o">=</span><span class="n">df_low_features</span><span class="p">,</span>
        <span class="n">registered_model_name</span><span class="o">=</span><span class="s2">&quot;Low_BMI_Random_Forest&quot;</span>
    <span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;RandomForest_High_BMI_Model&quot;</span><span class="p">):</span>
    <span class="c1"># Log parameters</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">({</span><span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Random Forest&quot;</span><span class="p">,</span> <span class="s2">&quot;bmi_group&quot;</span><span class="p">:</span> <span class="s2">&quot;High&quot;</span><span class="p">})</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">params_high</span><span class="p">)</span>
    <span class="c1"># Log metrics</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;accuracy_high&quot;</span><span class="p">,</span> <span class="n">score_high</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_score&quot;</span><span class="p">,</span> <span class="n">f1_high</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Positives&quot;</span><span class="p">,</span> <span class="n">tp_high</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Negatives&quot;</span><span class="p">,</span> <span class="n">tn_high</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Positives&quot;</span><span class="p">,</span> <span class="n">fp_high</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Negatives&quot;</span><span class="p">,</span> <span class="n">fn_high</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;CV_Mean_F1&quot;</span><span class="p">,</span> <span class="n">cv_scores_high</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;CV_Std_F1&quot;</span><span class="p">,</span> <span class="n">cv_scores_high</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>

    <span class="c1"># Infer signature and log the model</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">df_high_features</span><span class="p">,</span><span class="n">pipeline_rf_high</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_high_features</span><span class="p">))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">sk_model</span><span class="o">=</span><span class="n">pipeline_rf_high</span><span class="p">,</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;Diabetes_model_high&quot;</span><span class="p">,</span>
        <span class="n">signature</span><span class="o">=</span><span class="n">signature</span><span class="p">,</span>
        <span class="n">input_example</span><span class="o">=</span><span class="n">df_high_features</span><span class="p">,</span>
        <span class="n">registered_model_name</span><span class="o">=</span><span class="s2">&quot;High_BMI_Random_Forest&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Registered model &#39;Low_BMI_Random_Forest&#39; already exists. Creating a new version of this model...
2024/12/15 20:54:33 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: Low_BMI_Random_Forest, version 3
Created version &#39;3&#39; of model &#39;Low_BMI_Random_Forest&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run RandomForest_Low_BMI_Model at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/0fb892d949fd46c3b29e4224e6583324
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Registered model &#39;High_BMI_Random_Forest&#39; already exists. Creating a new version of this model...
2024/12/15 21:05:23 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: High_BMI_Random_Forest, version 3
Created version &#39;3&#39; of model &#39;High_BMI_Random_Forest&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run RandomForest_High_BMI_Model at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/e8bad503d31049bdbd37ed68079fcc4a
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>xgboost
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting xgboost
  Downloading xgboost-2.1.3-py3-none-macosx_12_0_arm64.whl.metadata (2.1 kB)
Requirement already satisfied: numpy in /opt/anaconda3/lib/python3.12/site-packages (from xgboost) (1.26.4)
Requirement already satisfied: scipy in /opt/anaconda3/lib/python3.12/site-packages (from xgboost) (1.13.1)
Downloading xgboost-2.1.3-py3-none-macosx_12_0_arm64.whl (1.9 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">1.9/1.9 MB</span> <span class=" -Color -Color-Red">5.4 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>a <span class=" -Color -Color-Cyan">0:00:01</span>
?25hInstalling collected packages: xgboost
Successfully installed xgboost-2.1.3
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="n">pipeline_xgb_low</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessing</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;logloss&#39;</span><span class="p">))</span>
<span class="p">])</span>

<span class="n">pipeline_xgb_high</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessing</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;logloss&#39;</span><span class="p">))</span>
<span class="p">])</span>

<span class="n">pipeline_ridge_low</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessing</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">RidgeClassifier</span><span class="p">())</span>
<span class="p">])</span>

<span class="n">pipeline_ridge_high</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessing</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">RidgeClassifier</span><span class="p">())</span>
<span class="p">])</span>
<span class="c1"># Train XGB Pipelines</span>
<span class="n">pipeline_xgb_low</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_low</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">)</span>
<span class="n">y_pred_xgb_low</span> <span class="o">=</span> <span class="n">pipeline_rf_low</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_low</span><span class="p">)</span>
<span class="n">accuracy_xgb_low</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test_low</span><span class="p">,</span> <span class="n">y_pred_xgb_low</span><span class="p">)</span>

<span class="n">pipeline_xgb_high</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_high</span><span class="p">,</span> <span class="n">y_train_high</span><span class="p">)</span>
<span class="n">y_pred_xgb_high</span> <span class="o">=</span> <span class="n">pipeline_rf_high</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_high</span><span class="p">)</span>
<span class="n">accuracy_xgb_high</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test_high</span><span class="p">,</span> <span class="n">y_pred_xgb_high</span><span class="p">)</span>

<span class="c1"># Cross-validation scores for Random Forest Pipelines</span>
<span class="n">cv_scores_xgb_low</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">pipeline_xgb_low</span><span class="p">,</span> <span class="n">X_train_low</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
<span class="n">cv_scores_xgb_high</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">pipeline_xgb_high</span><span class="p">,</span> <span class="n">X_train_high</span><span class="p">,</span> <span class="n">y_train_high</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cross-Validation Scores for XGB (Low BMI):&quot;</span><span class="p">,</span> <span class="n">cv_scores_xgb_low</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean CV Score (Low BMI):&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_scores_xgb_low</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cross-Validation Scores for XGB (High BMI):&quot;</span><span class="p">,</span> <span class="n">cv_scores_xgb_high</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean CV Score (High BMI):&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_scores_xgb_high</span><span class="p">))</span>

<span class="c1"># Train RIDGE Pipelines</span>
<span class="n">pipeline_ridge_low</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_low</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">)</span>
<span class="n">y_pred_ridge_low</span> <span class="o">=</span> <span class="n">pipeline_rf_low</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_low</span><span class="p">)</span>
<span class="n">accuracy_ridge_low</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test_low</span><span class="p">,</span> <span class="n">y_pred_ridge_low</span><span class="p">)</span>

<span class="n">pipeline_ridge_high</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_high</span><span class="p">,</span> <span class="n">y_train_high</span><span class="p">)</span>
<span class="n">y_pred_ridge_high</span> <span class="o">=</span> <span class="n">pipeline_rf_high</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_high</span><span class="p">)</span>
<span class="n">accuracy_ridge_high</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test_high</span><span class="p">,</span> <span class="n">y_pred_ridge_high</span><span class="p">)</span>

<span class="c1"># Cross-validation scores for Random Forest Pipelines</span>
<span class="n">cv_scores_ridge_low</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">pipeline_ridge_low</span><span class="p">,</span> <span class="n">X_train_low</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
<span class="n">cv_scores_ridge_high</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">pipeline_ridge_high</span><span class="p">,</span> <span class="n">X_train_high</span><span class="p">,</span> <span class="n">y_train_high</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cross-Validation Scores for Ridge (Low BMI):&quot;</span><span class="p">,</span> <span class="n">cv_scores_ridge_low</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean CV Score (Low BMI):&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_scores_ridge_low</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cross-Validation Scores for Ridge (High BMI):&quot;</span><span class="p">,</span> <span class="n">cv_scores_ridge_high</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean CV Score (High BMI):&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_scores_ridge_high</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cross-Validation Scores for XGB (Low BMI): [0.8950154  0.89520785 0.89482294 0.89405312 0.89357198 0.89452411
 0.89500529 0.89413916 0.89625638 0.89221442]
Mean CV Score (Low BMI): 0.8944810636966066
Cross-Validation Scores for XGB (High BMI): [0.77509097 0.76746097 0.77145205 0.77016082 0.7687522  0.77344759
 0.76804789 0.77377319 0.77353839 0.77471237]
Mean CV Score (High BMI): 0.771643643901271
Cross-Validation Scores for Ridge (Low BMI): [0.89530408 0.89540031 0.89540031 0.89530408 0.89530408 0.89548648
 0.895294   0.89548648 0.89539024 0.89548648]
Mean CV Score (Low BMI): 0.895385653807564
Cross-Validation Scores for Ridge (High BMI): [0.77438667 0.77168682 0.77379974 0.77603005 0.77192159 0.77532574
 0.77145205 0.77436018 0.76802066 0.77001644]
Mean CV Score (High BMI): 0.7726999929249485
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cv_scores_lr_low</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">lr_low</span><span class="p">,</span> <span class="n">X_train_low</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
<span class="n">cv_scores_lr_high</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">lr_high</span><span class="p">,</span> <span class="n">X_train_high</span><span class="p">,</span> <span class="n">y_train_high</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cross-Validation Scores for Logistic (Low BMI):&quot;</span><span class="p">,</span> <span class="n">cv_scores_lr_low</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean CV Score (Low BMI):&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_scores_rf_low</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cross-Validation Scores for Logistic (High BMI):&quot;</span><span class="p">,</span> <span class="n">cv_scores_lr_high</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean CV Score (High BMI):&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_scores_lr_high</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cross-Validation Scores for Logistic (Low BMI): [0.63375674 0.6360662  0.6301963  0.64135874 0.63423788 0.64478876
 0.6347801  0.63449139 0.62717737 0.63314407]
Mean CV Score (Low BMI): 0.887735172536724
Cross-Validation Scores for Logistic (High BMI): [0.6087569  0.59126658 0.59619674 0.59596197 0.60065735 0.60042258
 0.59854443 0.58628786 0.60072787 0.60835877]
Mean CV Score (High BMI): 0.5987181051121148
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">cv_scores_xgb_low</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    10.000000
mean      0.894481
std       0.001086
min       0.892214
25%       0.894075
50%       0.894674
75%       0.895013
max       0.896256
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">cv_scores_xgb_high</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    10.000000
mean      0.771644
std       0.002862
min       0.767461
25%       0.769104
50%       0.772450
75%       0.773714
max       0.775091
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">cv_scores_ridge_low</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    10.000000
mean      0.895386
std       0.000081
min       0.895294
25%       0.895304
50%       0.895395
75%       0.895465
max       0.895486
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">cv_scores_ridge_high</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    10.000000
mean      0.772700
std       0.002518
min       0.768021
25%       0.771511
50%       0.772861
75%       0.774380
max       0.776030
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">cv_scores_lr_low</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    10.000000
mean      0.635000
std       0.005028
min       0.627177
25%       0.633297
50%       0.634365
75%       0.635745
max       0.644789
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">cv_scores_lr_high</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    10.000000
mean      0.598718
std       0.006900
min       0.586288
25%       0.596021
50%       0.599484
75%       0.600710
max       0.608757
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">pipeline_xgb_low</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_params</span><span class="p">())</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;objective&#39;: &#39;multi:softprob&#39;, &#39;base_score&#39;: None, &#39;booster&#39;: None, &#39;callbacks&#39;: None, &#39;colsample_bylevel&#39;: None, &#39;colsample_bynode&#39;: None, &#39;colsample_bytree&#39;: None, &#39;device&#39;: None, &#39;early_stopping_rounds&#39;: None, &#39;enable_categorical&#39;: False, &#39;eval_metric&#39;: &#39;logloss&#39;, &#39;feature_types&#39;: None, &#39;gamma&#39;: None, &#39;grow_policy&#39;: None, &#39;importance_type&#39;: None, &#39;interaction_constraints&#39;: None, &#39;learning_rate&#39;: None, &#39;max_bin&#39;: None, &#39;max_cat_threshold&#39;: None, &#39;max_cat_to_onehot&#39;: None, &#39;max_delta_step&#39;: None, &#39;max_depth&#39;: None, &#39;max_leaves&#39;: None, &#39;min_child_weight&#39;: None, &#39;missing&#39;: nan, &#39;monotone_constraints&#39;: None, &#39;multi_strategy&#39;: None, &#39;n_estimators&#39;: None, &#39;n_jobs&#39;: None, &#39;num_parallel_tree&#39;: None, &#39;random_state&#39;: 42, &#39;reg_alpha&#39;: None, &#39;reg_lambda&#39;: None, &#39;sampling_method&#39;: None, &#39;scale_pos_weight&#39;: None, &#39;subsample&#39;: None, &#39;tree_method&#39;: None, &#39;validate_parameters&#39;: None, &#39;verbosity&#39;: None}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">pipeline_ridge_low</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_params</span><span class="p">())</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;alpha&#39;: 1.0, &#39;class_weight&#39;: None, &#39;copy_X&#39;: True, &#39;fit_intercept&#39;: True, &#39;max_iter&#39;: None, &#39;positive&#39;: False, &#39;random_state&#39;: None, &#39;solver&#39;: &#39;auto&#39;, &#39;tol&#39;: 0.0001}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">pipeline_rf_low</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_params</span><span class="p">())</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;bootstrap&#39;: True, &#39;ccp_alpha&#39;: 0.0, &#39;class_weight&#39;: None, &#39;criterion&#39;: &#39;gini&#39;, &#39;max_depth&#39;: None, &#39;max_features&#39;: &#39;sqrt&#39;, &#39;max_leaf_nodes&#39;: None, &#39;max_samples&#39;: None, &#39;min_impurity_decrease&#39;: 0.0, &#39;min_samples_leaf&#39;: 1, &#39;min_samples_split&#39;: 2, &#39;min_weight_fraction_leaf&#39;: 0.0, &#39;monotonic_cst&#39;: None, &#39;n_estimators&#39;: 100, &#39;n_jobs&#39;: None, &#39;oob_score&#39;: False, &#39;random_state&#39;: 42, &#39;verbose&#39;: 0, &#39;warm_start&#39;: False}
</pre></div>
</div>
</div>
</div>
<p>These are the hyperparameters</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># MLflow configuration</span>
<span class="n">MLFLOW_TRACKING_URI</span> <span class="o">=</span> <span class="s2">&quot;https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mpadmavathi026&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;9b42720fee5e34c7387ebe0714d3496686fb1d8a&quot;</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="n">MLFLOW_TRACKING_URI</span><span class="p">)</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;bmi_diabetes_prediction&quot;</span><span class="p">)</span>

<span class="c1"># Prepare `df` without the target column</span>
<span class="n">df_low_features</span> <span class="o">=</span> <span class="n">X_test_low</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_high_features</span> <span class="o">=</span> <span class="n">X_test_high</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">score_low</span> <span class="o">=</span> <span class="n">cv_scores_rf_low</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">score_high</span> <span class="o">=</span> <span class="n">cv_scores_rf_high</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">params_low</span> <span class="o">=</span> <span class="n">pipeline_rf_low</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
<span class="n">params_high</span> <span class="o">=</span> <span class="n">pipeline_rf_high</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;RandomForest_Low_BMI_Model&quot;</span><span class="p">):</span>
    <span class="c1"># Log parameters</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">({</span><span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Random Forest&quot;</span><span class="p">,</span> <span class="s2">&quot;bmi_group&quot;</span><span class="p">:</span> <span class="s2">&quot;Low&quot;</span><span class="p">})</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">params_low</span><span class="p">)</span>

    <span class="c1"># Log metrics</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;accuracy_low&quot;</span><span class="p">,</span> <span class="n">score_low</span><span class="p">)</span>

    <span class="c1"># Infer signature and log the model</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">df_low_features</span><span class="p">,</span> <span class="n">pipeline_rf_low</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_low_features</span><span class="p">))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">sk_model</span><span class="o">=</span><span class="n">pipeline_rf_low</span><span class="p">,</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;Diabetes_model_low&quot;</span><span class="p">,</span>
        <span class="n">signature</span><span class="o">=</span><span class="n">signature</span><span class="p">,</span>
        <span class="n">input_example</span><span class="o">=</span><span class="n">df_low_features</span><span class="p">,</span>
        <span class="n">registered_model_name</span><span class="o">=</span><span class="s2">&quot;Low_BMI_Random_Forest&quot;</span>
    <span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;RandomForest_High_BMI_Model&quot;</span><span class="p">):</span>
    <span class="c1"># Log parameters</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">({</span><span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Random Forest&quot;</span><span class="p">,</span> <span class="s2">&quot;bmi_group&quot;</span><span class="p">:</span> <span class="s2">&quot;High&quot;</span><span class="p">})</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">params_high</span><span class="p">)</span>
    <span class="c1"># Log metrics</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;accuracy_high&quot;</span><span class="p">,</span> <span class="n">score_high</span><span class="p">)</span>

    <span class="c1"># Infer signature and log the model</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">df_high_features</span><span class="p">,</span><span class="n">pipeline_rf_high</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_high_features</span><span class="p">))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">sk_model</span><span class="o">=</span><span class="n">pipeline_rf_high</span><span class="p">,</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;Diabetes_model_high&quot;</span><span class="p">,</span>
        <span class="n">signature</span><span class="o">=</span><span class="n">signature</span><span class="p">,</span>
        <span class="n">input_example</span><span class="o">=</span><span class="n">df_high_features</span><span class="p">,</span>
        <span class="n">registered_model_name</span><span class="o">=</span><span class="s2">&quot;High_BMI_Random_Forest&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Registered model &#39;Low_BMI_Random_Forest&#39; already exists. Creating a new version of this model...
2024/12/15 16:42:59 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: Low_BMI_Random_Forest, version 2
Created version &#39;2&#39; of model &#39;Low_BMI_Random_Forest&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run RandomForest_Low_BMI_Model at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/e17b937220c046dcbcb316cdf50ba842
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Registered model &#39;High_BMI_Random_Forest&#39; already exists. Creating a new version of this model...
2024/12/15 16:48:17 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: High_BMI_Random_Forest, version 2
Created version &#39;2&#39; of model &#39;High_BMI_Random_Forest&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run RandomForest_High_BMI_Model at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0/runs/84743f01615543fb859b664614edfaa4
🧪 View experiment at: https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="n">param_grid_rf</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;classifier__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>
    <span class="s1">&#39;classifier__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="s1">&#39;classifier__min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="s1">&#39;classifier__min_samples_leaf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="p">}</span>
<span class="c1"># Perform GridSearchCV for Low BMI</span>
<span class="n">grid_search_rf_low</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline_rf_low</span><span class="p">,</span> <span class="n">param_grid_rf</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
<span class="n">grid_search_rf_low</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_low</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">)</span>

<span class="c1"># Perform GridSearchCV for High BMI</span>
<span class="n">grid_search_rf_high</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline_rf_high</span><span class="p">,</span> <span class="n">param_grid_rf</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
<span class="n">grid_search_rf_high</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_high</span><span class="p">,</span> <span class="n">y_train_high</span><span class="p">)</span>

<span class="c1"># Evaluate Best Models for Random Forest</span>
<span class="n">best_rf_low</span> <span class="o">=</span> <span class="n">grid_search_rf_low</span><span class="o">.</span><span class="n">best_estimator_</span>
<span class="n">best_rf_high</span> <span class="o">=</span> <span class="n">grid_search_rf_high</span><span class="o">.</span><span class="n">best_estimator_</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best Parameters for Low BMI Random Forest:&quot;</span><span class="p">,</span> <span class="n">grid_search_rf_low</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best Parameters for High BMI Random Forest:&quot;</span><span class="p">,</span> <span class="n">grid_search_rf_high</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>

<span class="c1"># Evaluate and Log Best Models for Random Forest</span>
<span class="n">y_pred_rf_low</span> <span class="o">=</span> <span class="n">best_rf_low</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_low</span><span class="p">)</span>
<span class="n">y_pred_rf_high</span> <span class="o">=</span> <span class="n">best_rf_high</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_high</span><span class="p">)</span>

<span class="n">accuracy_rf_low</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test_low</span><span class="p">,</span> <span class="n">y_pred_rf_low</span><span class="p">)</span>
<span class="n">accuracy_rf_high</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test_high</span><span class="p">,</span> <span class="n">y_pred_rf_high</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best Parameters for Low BMI Random Forest: {&#39;classifier__max_depth&#39;: 10, &#39;classifier__min_samples_leaf&#39;: 1, &#39;classifier__min_samples_split&#39;: 2, &#39;classifier__n_estimators&#39;: 100}
Best Parameters for High BMI Random Forest: {&#39;classifier__max_depth&#39;: 10, &#39;classifier__min_samples_leaf&#39;: 2, &#39;classifier__min_samples_split&#39;: 2, &#39;classifier__n_estimators&#39;: 100}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create DataFrame for Grid Search Results</span>
<span class="n">cv_res_low</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">grid_search_rf_low</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span>
<span class="n">cv_res_high</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">grid_search_rf_high</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span>

<span class="c1"># Sort and clean GridSearch results</span>
<span class="n">cv_res_low</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;mean_test_score&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">cv_res_high</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;mean_test_score&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">cv_res_low</span> <span class="o">=</span> <span class="n">cv_res_low</span><span class="p">[[</span><span class="s2">&quot;param_classifier__n_estimators&quot;</span><span class="p">,</span> <span class="s2">&quot;param_classifier__max_depth&quot;</span><span class="p">,</span> <span class="s2">&quot;param_classifier__min_samples_split&quot;</span><span class="p">,</span> <span class="s2">&quot;param_classifier__min_samples_leaf&quot;</span><span class="p">,</span> <span class="s2">&quot;split0_test_score&quot;</span><span class="p">,</span> <span class="s2">&quot;split1_test_score&quot;</span><span class="p">,</span> <span class="s2">&quot;split2_test_score&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_test_score&quot;</span><span class="p">]]</span>
<span class="n">cv_res_high</span> <span class="o">=</span> <span class="n">cv_res_high</span><span class="p">[[</span><span class="s2">&quot;param_classifier__n_estimators&quot;</span><span class="p">,</span> <span class="s2">&quot;param_classifier__max_depth&quot;</span><span class="p">,</span> <span class="s2">&quot;param_classifier__min_samples_split&quot;</span><span class="p">,</span> <span class="s2">&quot;param_classifier__min_samples_leaf&quot;</span><span class="p">,</span> <span class="s2">&quot;split0_test_score&quot;</span><span class="p">,</span> <span class="s2">&quot;split1_test_score&quot;</span><span class="p">,</span> <span class="s2">&quot;split2_test_score&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_test_score&quot;</span><span class="p">]]</span>

<span class="n">cv_res_low</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;n_estimators&quot;</span><span class="p">,</span> <span class="s2">&quot;max_depth&quot;</span><span class="p">,</span> <span class="s2">&quot;min_samples_split&quot;</span><span class="p">,</span> <span class="s2">&quot;min_samples_leaf&quot;</span><span class="p">,</span> <span class="s2">&quot;split0&quot;</span><span class="p">,</span> <span class="s2">&quot;split1&quot;</span><span class="p">,</span> <span class="s2">&quot;split2&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_test_score&quot;</span><span class="p">]</span>
<span class="n">cv_res_high</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;n_estimators&quot;</span><span class="p">,</span> <span class="s2">&quot;max_depth&quot;</span><span class="p">,</span> <span class="s2">&quot;min_samples_split&quot;</span><span class="p">,</span> <span class="s2">&quot;min_samples_leaf&quot;</span><span class="p">,</span> <span class="s2">&quot;split0&quot;</span><span class="p">,</span> <span class="s2">&quot;split1&quot;</span><span class="p">,</span> <span class="s2">&quot;split2&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_test_score&quot;</span><span class="p">]</span>

<span class="c1"># Round scores for readability</span>
<span class="n">score_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;split0&quot;</span><span class="p">,</span> <span class="s2">&quot;split1&quot;</span><span class="p">,</span> <span class="s2">&quot;split2&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_test_score&quot;</span><span class="p">]</span>
<span class="n">cv_res_low</span><span class="p">[</span><span class="n">score_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv_res_low</span><span class="p">[</span><span class="n">score_cols</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">cv_res_high</span><span class="p">[</span><span class="n">score_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv_res_high</span><span class="p">[</span><span class="n">score_cols</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># Display top results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Low BMI Grid Search Results:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cv_res_low</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;High BMI Grid Search Results:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cv_res_high</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Low BMI Grid Search Results:
  n_estimators max_depth min_samples_split min_samples_leaf  split0  split1  \
0          100        10                 2                1  0.8954  0.8957   
1          200        10                 2                1  0.8955  0.8955   
7          200        10                 5                2  0.8956  0.8955   
2          100        10                 5                1  0.8954  0.8955   
6          100        10                 5                2  0.8955  0.8955   

   split2  mean_test_score  
0  0.8955           0.8955  
1  0.8955           0.8955  
7  0.8954           0.8955  
2  0.8955           0.8955  
6  0.8953           0.8954  
High BMI Grid Search Results:
  n_estimators max_depth min_samples_split min_samples_leaf  split0  split1  \
4          100        10                 2                2  0.7739  0.7735   
5          200        10                 2                2  0.7736  0.7733   
3          200        10                 5                1  0.7733  0.7735   
2          100        10                 5                1  0.7738  0.7736   
7          200        10                 5                2  0.7741  0.7730   

   split2  mean_test_score  
4  0.7728           0.7734  
5  0.7730           0.7733  
3  0.7725           0.7731  
2  0.7719           0.7731  
7  0.7721           0.7731  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.tracking</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">re</span>  <span class="c1"># Import regex to extract model name</span>

<span class="c1"># --- Step 1: Set MLflow Tracking URI ---</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="s2">&quot;https://dagshub.com/mpadmavathi026/Fall2024_diabetes_model.mlflow&quot;</span><span class="p">)</span>  <span class="c1"># Replace with your tracking URI</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">tracking</span><span class="o">.</span><span class="n">MlflowClient</span><span class="p">()</span>

<span class="c1"># --- Step 2: Extract Experiment Data from MLflow ---</span>
<span class="k">def</span> <span class="nf">get_f1_scores_from_mlflow</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves F1-scores and related information from MLflow experiments.</span>
<span class="sd">    Extracts the model name directly from the run name if not explicitly logged.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f1_scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">experiments</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">search_experiments</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">experiments</span><span class="p">:</span>
        <span class="n">experiment_id</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">experiment_id</span>
        <span class="n">runs</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">search_runs</span><span class="p">(</span><span class="n">experiment_ids</span><span class="o">=</span><span class="n">experiment_id</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">:</span>
            <span class="n">run_name</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mlflow.runName&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
            <span class="n">f1_score</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;F1 Score&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="c1"># Extract model name from the run name using regex</span>
            <span class="n">model_name_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(logistic|ridge|rf|xgb)&quot;</span><span class="p">,</span> <span class="n">run_name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="n">model_name</span> <span class="o">=</span> <span class="n">model_name_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">if</span> <span class="n">model_name_match</span> <span class="k">else</span> <span class="s2">&quot;Unknown Model&quot;</span>
            
            <span class="k">if</span> <span class="n">f1_score</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">f1_scores</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;Experiment&quot;</span><span class="p">:</span> <span class="n">exp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="s2">&quot;Run Name&quot;</span><span class="p">:</span> <span class="n">run_name</span><span class="p">,</span>
                    <span class="s2">&quot;Model&quot;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
                    <span class="s2">&quot;F1 Score&quot;</span><span class="p">:</span> <span class="n">f1_score</span>
                <span class="p">})</span>
    
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f1_scores</span><span class="p">)</span>

<span class="c1"># --- Step 3: Retrieve F1-Scores and Prepare Data ---</span>
<span class="n">f1_score_df</span> <span class="o">=</span> <span class="n">get_f1_scores_from_mlflow</span><span class="p">()</span>

<span class="k">if</span> <span class="n">f1_score_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No F1-score data found in MLflow experiments.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;F1-Score Data Retrieved Successfully:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f1_score_df</span><span class="p">)</span>

    <span class="c1"># Save Data to CSV (optional)</span>
    <span class="n">f1_score_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;f1_scores_comparison.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># --- Step 4: Plot F1-Score Comparison ---</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">experiment</span> <span class="ow">in</span> <span class="n">f1_score_df</span><span class="p">[</span><span class="s1">&#39;Experiment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="n">exp_data</span> <span class="o">=</span> <span class="n">f1_score_df</span><span class="p">[</span><span class="n">f1_score_df</span><span class="p">[</span><span class="s1">&#39;Experiment&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">experiment</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">exp_data</span><span class="p">[</span><span class="s1">&#39;Run Name&#39;</span><span class="p">],</span> <span class="n">exp_data</span><span class="p">[</span><span class="s1">&#39;F1 Score&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">experiment</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;F1-Score Comparison Across Experiments&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Run Names (Models)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;F1 Score&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Experiments&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="c1"># Save the plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;f1_score_comparison.png&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># --- Step 5: Find and Print Best Model ---</span>
    <span class="n">best_model</span> <span class="o">=</span> <span class="n">f1_score_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">f1_score_df</span><span class="p">[</span><span class="s1">&#39;F1 Score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Best Model Based on F1-Score:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">best_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F1-Score Data Retrieved Successfully:
                 Experiment                        Run Name     Model  \
0   bmi_diabetes_prediction       experiment_7_xgb_High BMI       XGB   
1   bmi_diabetes_prediction        experiment_7_rf_High BMI        RF   
2   bmi_diabetes_prediction     experiment_7_ridge_High BMI     RIDGE   
3   bmi_diabetes_prediction  experiment_7_logistic_High BMI  LOGISTIC   
4   bmi_diabetes_prediction        experiment_7_xgb_Low BMI       XGB   
5   bmi_diabetes_prediction         experiment_7_rf_Low BMI        RF   
6   bmi_diabetes_prediction      experiment_7_ridge_Low BMI     RIDGE   
7   bmi_diabetes_prediction   experiment_7_logistic_Low BMI  LOGISTIC   
8   bmi_diabetes_prediction       experiment_6_xgb_High BMI       XGB   
9   bmi_diabetes_prediction        experiment_6_rf_High BMI        RF   
10  bmi_diabetes_prediction     experiment_6_ridge_High BMI     RIDGE   
11  bmi_diabetes_prediction  experiment_6_logistic_High BMI  LOGISTIC   
12  bmi_diabetes_prediction        experiment_6_xgb_Low BMI       XGB   
13  bmi_diabetes_prediction         experiment_6_rf_Low BMI        RF   
14  bmi_diabetes_prediction      experiment_6_ridge_Low BMI     RIDGE   
15  bmi_diabetes_prediction   experiment_6_logistic_Low BMI  LOGISTIC   
16  bmi_diabetes_prediction          PCA tuned xgb_High_BMI       XGB   
17  bmi_diabetes_prediction           PCA tuned xgb_Low_BMI       XGB   
18  bmi_diabetes_prediction           PCA tuned rf_High_BMI        RF   
19  bmi_diabetes_prediction            PCA tuned rf_Low_BMI        RF   
20  bmi_diabetes_prediction        PCA tuned ridge_High_BMI     RIDGE   
21  bmi_diabetes_prediction         PCA tuned ridge_Low_BMI     RIDGE   
22  bmi_diabetes_prediction     PCA tuned logistic_High_BMI  LOGISTIC   
23  bmi_diabetes_prediction      PCA tuned logistic_Low_BMI  LOGISTIC   
24  bmi_diabetes_prediction           FS Tuned xgb_High_BMI       XGB   
25  bmi_diabetes_prediction            FS Tuned xgb_Low_BMI       XGB   
26  bmi_diabetes_prediction            FS Tuned rf_High_BMI        RF   
27  bmi_diabetes_prediction             FS Tuned rf_Low_BMI        RF   
28  bmi_diabetes_prediction         FS Tuned ridge_High_BMI     RIDGE   
29  bmi_diabetes_prediction          FS Tuned ridge_Low_BMI     RIDGE   
30  bmi_diabetes_prediction      FS Tuned logistic_High_BMI  LOGISTIC   
31  bmi_diabetes_prediction       FS Tuned logistic_Low_BMI  LOGISTIC   
32  bmi_diabetes_prediction            FE Tunedxgb_High_BMI       XGB   
33  bmi_diabetes_prediction             FE Tunedrf_High_BMI        RF   
34  bmi_diabetes_prediction          FE Tunedridge_High_BMI     RIDGE   
35  bmi_diabetes_prediction       FE Tunedlogistic_High_BMI  LOGISTIC   
36  bmi_diabetes_prediction             FE Tunedxgb_Low_BMI       XGB   
37  bmi_diabetes_prediction              FE Tunedrf_Low_BMI        RF   
38  bmi_diabetes_prediction           FE Tunedridge_Low_BMI     RIDGE   
39  bmi_diabetes_prediction        FE Tunedlogistic_Low_BMI  LOGISTIC   
40  bmi_diabetes_prediction         Basic Tunedxgb_High_BMI       XGB   
41  bmi_diabetes_prediction          Basic Tunedrf_High_BMI        RF   
42  bmi_diabetes_prediction       Basic Tunedridge_High_BMI     RIDGE   
43  bmi_diabetes_prediction          Basic Tunedxgb_Low_BMI       XGB   
44  bmi_diabetes_prediction           Basic Tunedrf_Low_BMI        RF   
45  bmi_diabetes_prediction        Basic Tunedridge_Low_BMI     RIDGE   

    F1 Score  
0   0.497265  
1   0.500097  
2   0.425514  
3   0.424877  
4   0.496305  
5   0.500945  
6   0.496222  
7   0.496524  
8   0.504313  
9   0.509902  
10  0.504576  
11  0.504402  
12  0.503931  
13  0.507100  
14  0.510602  
15  0.510686  
16  0.502031  
17  0.507437  
18  0.511157  
19  0.509727  
20  0.502681  
21  0.514223  
22  0.502493  
23  0.513877  
24  0.508449  
25  0.511026  
26  0.510351  
27  0.512674  
28  0.506134  
29  0.514495  
30  0.506242  
31  0.514489  
32  0.708382  
33  0.709076  
34  0.668017  
35  0.677662  
36  0.847770  
37  0.849452  
38  0.845898  
39  0.845898  
40  0.731712  
41  0.719657  
42  0.712254  
43  0.855723  
44  0.850851  
45  0.846180  
</pre></div>
</div>
<img alt="../../_images/b745bdf039672f60b2820edd0c0a60bfec3369c752f00e31338a49bfefc52c85.png" src="../../_images/b745bdf039672f60b2820edd0c0a60bfec3369c752f00e31338a49bfefc52c85.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best Model Based on F1-Score:
Experiment    bmi_diabetes_prediction
Run Name       Basic Tunedxgb_Low_BMI
Model                             XGB
F1 Score                     0.855723
Name: 43, dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xgboost</span> <span class="k">as</span> <span class="nn">xgb</span>
<span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Define the tuned XGBoost model with hyperparameters</span>
<span class="n">tuned_xgb_model</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span>
    <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>  <span class="c1"># Use the correct hyperparameter names</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">7</span>
<span class="p">)</span>

<span class="c1"># Ensure the model is trained (replace with your dataset variables)</span>
<span class="c1"># Example placeholders for training data</span>
<span class="c1"># Replace X_train_low and y_train_low with actual datasets</span>
<span class="n">tuned_xgb_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_low</span><span class="p">,</span> <span class="n">y_train_low</span><span class="p">)</span>

<span class="c1"># Define the directory and path to save the model</span>
<span class="n">save_dir</span> <span class="o">=</span> <span class="s2">&quot;/Users/padmavathimoorthy/Downloads/diabetes_app/saved_models&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Create the directory if it doesn&#39;t exist</span>
<span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="s2">&quot;tuned_xgb_low_bmi.pkl&quot;</span><span class="p">)</span>

<span class="c1"># Save the tuned model using joblib</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">tuned_xgb_model</span><span class="p">,</span> <span class="n">model_path</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tuned XGBoost Model saved successfully to: </span><span class="si">{</span><span class="n">model_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tuned XGBoost Model saved successfully to: /Users/padmavathimoorthy/Downloads/diabetes_app/saved_models/tuned_xgb_low_bmi.pkl
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">confusion_matrix</span>

<span class="c1"># Load X_test and y_test</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;X_test.csv&quot;</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;y_test.csv&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Convert to pandas Series</span>

<span class="c1"># Load the saved XGB model</span>
<span class="n">model_path</span> <span class="o">=</span> <span class="s2">&quot;saved_models/tuned_xgb_low_bmi.pkl&quot;</span>
<span class="n">final_model_loaded</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loaded model type:&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">final_model_loaded</span><span class="p">))</span>  <span class="c1"># Should be xgboost.XGBClassifier</span>

<span class="c1"># Make predictions</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">final_model_loaded</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Evaluate the model</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">conf_matrix</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="c1"># Display evaluation results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Model Evaluation Results ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1 Score: </span><span class="si">{</span><span class="n">f1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy: </span><span class="si">{</span><span class="n">accuracy</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Confusion Matrix:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">conf_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loaded model type: &lt;class &#39;xgboost.sklearn.XGBClassifier&#39;&gt;

=== Model Evaluation Results ===
F1 Score: 0.8543
Accuracy: 0.8950
Confusion Matrix:
[[23125     0   135]
 [  418     0    11]
 [ 2163     1   126]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="c1"># Dynamically install fastapi and uvicorn</span>
<span class="o">!{</span>sys.executable<span class="o">}</span><span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>fastapi<span class="w"> </span>uvicorn
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: fastapi in /opt/anaconda3/lib/python3.12/site-packages (0.115.6)
Requirement already satisfied: uvicorn in /opt/anaconda3/lib/python3.12/site-packages (0.34.0)
Requirement already satisfied: starlette&lt;0.42.0,&gt;=0.40.0 in /opt/anaconda3/lib/python3.12/site-packages (from fastapi) (0.41.3)
Requirement already satisfied: pydantic!=1.8,!=1.8.1,!=2.0.0,!=2.0.1,!=2.1.0,&lt;3.0.0,&gt;=1.7.4 in /opt/anaconda3/lib/python3.12/site-packages (from fastapi) (2.5.3)
Requirement already satisfied: typing-extensions&gt;=4.8.0 in /opt/anaconda3/lib/python3.12/site-packages (from fastapi) (4.11.0)
Requirement already satisfied: click&gt;=7.0 in /opt/anaconda3/lib/python3.12/site-packages (from uvicorn) (8.1.7)
Requirement already satisfied: h11&gt;=0.8 in /opt/anaconda3/lib/python3.12/site-packages (from uvicorn) (0.14.0)
Requirement already satisfied: annotated-types&gt;=0.4.0 in /opt/anaconda3/lib/python3.12/site-packages (from pydantic!=1.8,!=1.8.1,!=2.0.0,!=2.0.1,!=2.1.0,&lt;3.0.0,&gt;=1.7.4-&gt;fastapi) (0.6.0)
Requirement already satisfied: pydantic-core==2.14.6 in /opt/anaconda3/lib/python3.12/site-packages (from pydantic!=1.8,!=1.8.1,!=2.0.0,!=2.0.1,!=2.1.0,&lt;3.0.0,&gt;=1.7.4-&gt;fastapi) (2.14.6)
Requirement already satisfied: anyio&lt;5,&gt;=3.4.0 in /opt/anaconda3/lib/python3.12/site-packages (from starlette&lt;0.42.0,&gt;=0.40.0-&gt;fastapi) (4.2.0)
Requirement already satisfied: idna&gt;=2.8 in /opt/anaconda3/lib/python3.12/site-packages (from anyio&lt;5,&gt;=3.4.0-&gt;starlette&lt;0.42.0,&gt;=0.40.0-&gt;fastapi) (3.7)
Requirement already satisfied: sniffio&gt;=1.1 in /opt/anaconda3/lib/python3.12/site-packages (from anyio&lt;5,&gt;=3.4.0-&gt;starlette&lt;0.42.0,&gt;=0.40.0-&gt;fastapi) (1.3.0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Load the tuned XGBoost model</span>
<span class="n">model_path</span> <span class="o">=</span> <span class="s2">&quot;saved_models/tuned_xgb_low_bmi.pkl&quot;</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>

<span class="c1"># Initialize FastAPI</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Diabetes Prediction API&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Predict diabetes using a tuned XGBoost Model&quot;</span><span class="p">)</span>

<span class="c1"># Input data format</span>
<span class="k">class</span> <span class="nc">InputData</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">features</span><span class="p">:</span> <span class="nb">list</span>  <span class="c1"># Example input: [5.0, 0.0, 3.0, 2.0, 25.0, 1.0, ...]</span>

<span class="c1"># Root endpoint</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">root</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Welcome to the Tuned XGBoost Diabetes Prediction API!&quot;</span><span class="p">}</span>

<span class="c1"># Prediction endpoint</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/predict/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">InputData</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">input_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">features</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_features</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;prediction&quot;</span><span class="p">:</span> <span class="n">prediction</span><span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a_row</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">a_row</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">a</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;Diabetes_012&#39;: 2.0,
 &#39;HighBP&#39;: 0.0,
 &#39;HighChol&#39;: 1.0,
 &#39;CholCheck&#39;: 1.0,
 &#39;BMI&#39;: 29.0,
 &#39;Smoker&#39;: 0.0,
 &#39;Stroke&#39;: 1.0,
 &#39;HeartDiseaseorAttack&#39;: 1.0,
 &#39;PhysActivity&#39;: 1.0,
 &#39;Fruits&#39;: 1.0,
 &#39;Veggies&#39;: 1.0,
 &#39;HvyAlcoholConsump&#39;: 0.0,
 &#39;AnyHealthcare&#39;: 1.0,
 &#39;NoDocbcCost&#39;: 0.0,
 &#39;GenHlth&#39;: 5.0,
 &#39;MentHlth&#39;: 0.0,
 &#39;PhysHlth&#39;: 30.0,
 &#39;DiffWalk&#39;: 1.0,
 &#39;Sex&#39;: 1.0,
 &#39;Age&#39;: 12.0,
 &#39;Education&#39;: 3.0,
 &#39;Income&#39;: 4.0}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
  &quot;Diabetes_012&quot;: 2.0,
  &quot;HighBP&quot;: 0.0,
  &quot;HighChol&quot;: 1.0,
  &quot;CholCheck&quot;: 1.0,
  &quot;BMI&quot;: 29.0,
  &quot;Smoker&quot;: 0.0,
  &quot;Stroke&quot;: 1.0,
  &quot;HeartDiseaseorAttack&quot;: 1.0,
  &quot;PhysActivity&quot;: 1.0,
  &quot;Fruits&quot;: 1.0,
  &quot;Veggies&quot;: 1.0,
  &quot;HvyAlcoholConsump&quot;: 0.0,
  &quot;AnyHealthcare&quot;: 1.0,
  &quot;NoDocbcCost&quot;: 0.0,
  &quot;GenHlth&quot;: 5.0,
  &quot;MentHlth&quot;: 0.0,
  &quot;PhysHlth&quot;: 30.0,
  &quot;DiffWalk&quot;: 1.0,
  &quot;Sex&quot;: 1.0,
  &quot;Age&quot;: 12.0,
  &quot;Education&quot;: 3.0,
  &quot;Income&quot;: 4.0
}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;Diabetes_012&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
  <span class="s2">&quot;HighBP&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
  <span class="s2">&quot;HighChol&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
  <span class="s2">&quot;CholCheck&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
  <span class="s2">&quot;BMI&quot;</span><span class="p">:</span> <span class="mf">29.0</span><span class="p">,</span>
  <span class="s2">&quot;Smoker&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
  <span class="s2">&quot;Stroke&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
  <span class="s2">&quot;HeartDiseaseorAttack&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
  <span class="s2">&quot;PhysActivity&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
  <span class="s2">&quot;Fruits&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
  <span class="s2">&quot;Veggies&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
  <span class="s2">&quot;HvyAlcoholConsump&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
  <span class="s2">&quot;AnyHealthcare&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
  <span class="s2">&quot;NoDocbcCost&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
  <span class="s2">&quot;GenHlth&quot;</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span>
  <span class="s2">&quot;MentHlth&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
  <span class="s2">&quot;PhysHlth&quot;</span><span class="p">:</span> <span class="mf">30.0</span><span class="p">,</span>
  <span class="s2">&quot;DiffWalk&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
  <span class="s2">&quot;Sex&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
  <span class="s2">&quot;Age&quot;</span><span class="p">:</span> <span class="mf">12.0</span><span class="p">,</span>
  <span class="s2">&quot;Education&quot;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
  <span class="s2">&quot;Income&quot;</span><span class="p">:</span> <span class="mf">4.0</span>
<span class="p">}</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://127.0.0.1:8000/predict&#39;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
  &quot;Diabetes_012&quot;: 2.0,
  &quot;HighBP&quot;: 0.0,
  &quot;HighChol&quot;: 1.0,
  &quot;CholCheck&quot;: 1.0,
  &quot;BMI&quot;: 29.0,
  &quot;Smoker&quot;: 0.0,
  &quot;Stroke&quot;: 1.0,
  &quot;HeartDiseaseorAttack&quot;: 1.0,
  &quot;PhysActivity&quot;: 1.0,
  &quot;Fruits&quot;: 1.0,
  &quot;Veggies&quot;: 1.0,
  &quot;HvyAlcoholConsump&quot;: 0.0,
  &quot;AnyHealthcare&quot;: 1.0,
  &quot;NoDocbcCost&quot;: 0.0,
  &quot;GenHlth&quot;: 5.0,
  &quot;MentHlth&quot;: 0.0,
  &quot;PhysHlth&quot;: 30.0,
  &quot;DiffWalk&quot;: 1.0,
  &quot;Sex&quot;: 1.0,
  &quot;Age&quot;: 12.0,
  &quot;Education&quot;: 3.0,
  &quot;Income&quot;: 4.0
}
{&#39;prediction&#39;: 2}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>

<span class="n">df_original</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;/Users/padmavathimoorthy/Downloads/diabetes_app/diabetes_012_health_indicators_BRFSS2021.csv&quot;</span><span class="p">)</span>
<span class="n">slider_fields</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;BMI&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Income&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PhysHlth&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Age&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GenHlth&quot;</span><span class="p">]</span>

<span class="n">single_select_fields</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;HighBP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HighChol&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CholCheck&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Smoker&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Stroke&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HeartDiseaseorAttack&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PhysActivity&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Fruits&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Veggies&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HvyAlcoholConsump&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AnyHealthcare&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NoDocbcCost&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DiffWalk&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Sex&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Education&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MentHlth&quot;</span>
<span class="p">]</span> 
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="n">streamlit_field_data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

<span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">slider_fields</span><span class="p">:</span>
    <span class="n">streamlit_field_data</span><span class="p">[</span><span class="s2">&quot;slider_fields&quot;</span><span class="p">][</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">df_original</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">df_original</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())]</span>


<span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">single_select_fields</span><span class="p">:</span>
    <span class="n">streamlit_field_data</span><span class="p">[</span><span class="s2">&quot;single_select_fields&quot;</span><span class="p">][</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_original</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>


<span class="kn">import</span> <span class="nn">json</span>
<span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">streamlit_field_data</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;streamlit_options.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">),</span> <span class="n">indent</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">sorted</span><span class="p">(</span><span class="n">df_original</span><span class="p">[</span><span class="s2">&quot;Smoker&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.0, 1.0]
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters/eas503"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="eas503.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">1. </span>EAS503</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">1.1. Cleanup Tasks:</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#remove-duplicates">1.2. Remove Duplicates:</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#correct-data-types">1.3. Correct Data Types:</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#outlier-detection-and-handling">1.4. Outlier Detection and Handling:</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#categorical-variable-encoding">1.5. Categorical Variable Encoding:</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#normalization-scaling">1.6. Normalization/Scaling:</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#document-changes">1.7. Document Changes:</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>